(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 9.0' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       157,          7]
NotebookDataLength[    137482,       3203]
NotebookOptionsPosition[    134698,       3117]
NotebookOutlinePosition[    135041,       3132]
CellTagsIndexPosition[    134998,       3129]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{

Cell[CellGroupData[{
Cell[BoxData[{
 RowBox[{"p1", "=", 
  RowBox[{"RandomReal", "[", 
   RowBox[{"50", ",", 
    RowBox[{"{", "10", "}"}]}], "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"m", "=", 
   RowBox[{"Compile", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"{", 
       RowBox[{"x", ",", "_Real", ",", "1"}], "}"}], "}"}], ",", 
     RowBox[{"Min", "[", "x", "]"}], ",", 
     RowBox[{"RuntimeAttributes", "\[Rule]", 
      RowBox[{"{", "Listable", "}"}]}], ",", 
     RowBox[{"Parallelization", "\[Rule]", "True"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{"m", "[", "p1", "]"}], "\[IndentingNewLine]"}], "Input",
 CellChangeTimes->{{3.613137228901193*^9, 3.6131373367902517`*^9}, {
  3.613137738735708*^9, 3.613137756579623*^9}}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
  "34.31397727163085`", ",", "7.574689844843007`", ",", "41.2780258417672`", 
   ",", "20.17310445280131`", ",", "46.05349206306376`", ",", 
   "47.0727789592233`", ",", "26.318793369364712`", ",", "35.12940939394399`",
    ",", "11.558374673506087`", ",", "30.94965272686325`"}], "}"}]], "Output",
 CellChangeTimes->{{3.6131372725143166`*^9, 3.613137339453025*^9}, {
  3.6131377411082973`*^9, 3.613137757627322*^9}}],

Cell[BoxData["7.574689844843007`"], "Output",
 CellChangeTimes->{{3.6131372725143166`*^9, 3.613137339453025*^9}, {
  3.6131377411082973`*^9, 3.613137757630327*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{"Needs", "[", "\"\<CompiledFunctionTools`\>\"", 
  "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"a", "=", "1"}], ";", 
  RowBox[{"Vf", "=", "100"}], ";", 
  RowBox[{"cap", "=", "2500"}], ";", 
  RowBox[{"p1", "=", 
   RowBox[{"RandomReal", "[", 
    RowBox[{"50", ",", 
     RowBox[{"{", 
      RowBox[{"10", "^", "8"}], "}"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"p2", "=", 
    RowBox[{"RandomReal", "[", 
     RowBox[{"2000", ",", 
      RowBox[{"{", 
       RowBox[{"10", "^", "8"}], "}"}]}], "]"}]}], ";"}], 
  "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{"m1", " ", "=", " ", 
        RowBox[{"Compile", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"{", 
            RowBox[{"p1", ",", "_Real", ",", "1"}], "}"}], "}"}], ",", 
          RowBox[{"Min", "[", "p1", "]"}], ",", 
          RowBox[{"Parallelization", "\[Rule]", "True"}], ",", 
          RowBox[{"RuntimeAttributes", "\[Rule]", 
           RowBox[{"{", "Listable", "}"}]}], ",", 
          RowBox[{"CompilationOptions", "\[Rule]", 
           RowBox[{"{", 
            RowBox[{"\"\<InlineExternalDefinitions\>\"", "\[Rule]", "True"}], 
            "}"}]}]}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"m2", "[", "p_", "]"}], ":=", 
        RowBox[{"Min", "/@", "p"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"m1", "[", "p1", "]"}], ";"}], "//", 
      RowBox[{"Timing", "\[IndentingNewLine]", 
       RowBox[{"m2", "[", "p1", "]"}]}]}], ";"}], "//", "Timing"}], 
   "*)"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"d", "[", 
     RowBox[{"x1_", ",", "x2_", ",", "x3_"}], "]"}], ":=", 
    RowBox[{"Clip", "[", 
     RowBox[{
      RowBox[{"(", 
       RowBox[{
        RowBox[{"Clip", "[", 
         RowBox[{
          RowBox[{"x2", " ", "Vf"}], ",", 
          RowBox[{"{", 
           RowBox[{"0", ",", 
            RowBox[{"x1", " ", "cap"}]}], "}"}]}], "]"}], "-", "x3"}], ")"}], 
      ",", 
      RowBox[{"{", 
       RowBox[{"0", ",", 
        RowBox[{"x1", " ", "cap"}]}], "}"}]}], "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"clipC", "=", 
    RowBox[{"Compile", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"x", ",", "_Real", ",", "1"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"bounds", ",", "_Real", ",", "1"}], "}"}]}], "}"}], ",", 
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{"Max", "[", 
         RowBox[{
          RowBox[{"Min", "[", 
           RowBox[{"i", ",", 
            RowBox[{"bounds", "[", 
             RowBox[{"[", "2", "]"}], "]"}]}], "]"}], ",", 
          RowBox[{"bounds", "[", 
           RowBox[{"[", "1", "]"}], "]"}]}], "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", "x"}], "}"}]}], "]"}]}], "]"}]}], ";"}], 
  "\n"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"demC", "=", 
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"clip", "=", "clipC"}], ",", 
       RowBox[{"Vf", "=", "100"}], ",", 
       RowBox[{"cap", "=", "2500"}]}], "}"}], ",", 
     RowBox[{"Compile", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"a", ",", "_Real", ",", "0"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"p1", ",", "_Real", ",", "1"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"p2", ",", "_Real", ",", "1"}], "}"}]}], "}"}], ",", 
       RowBox[{"clip", "[", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{
           RowBox[{"clip", "[", 
            RowBox[{
             RowBox[{"p1", " ", "Vf"}], ",", 
             RowBox[{"{", 
              RowBox[{"0", ",", 
               RowBox[{"a", " ", "cap"}]}], "}"}]}], "]"}], "-", "p2"}], 
          ")"}], ",", 
         RowBox[{"{", 
          RowBox[{"0", ",", 
           RowBox[{"a", " ", "cap"}]}], "}"}]}], "]"}], ",", 
       RowBox[{"Parallelization", "\[Rule]", "True"}], ",", 
       RowBox[{"RuntimeAttributes", "\[Rule]", 
        RowBox[{"{", "Listable", "}"}]}], ",", 
       RowBox[{"CompilationOptions", "\[Rule]", 
        RowBox[{"{", 
         RowBox[{"\"\<InlineCompiledFunctions\>\"", "\[Rule]", "True"}], 
         "}"}]}]}], "]"}]}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"demM", "=", 
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"clip", "=", "clipC"}], ",", 
       RowBox[{"Vf", "=", "100"}], ",", 
       RowBox[{"cap", "=", "2500"}]}], "}"}], ",", 
     RowBox[{"Compile", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"a", ",", "_Real", ",", "0"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"p1", ",", "_Real", ",", "1"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"p2", ",", "_Real", ",", "1"}], "}"}]}], "}"}], ",", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{"Max", "[", 
          RowBox[{
           RowBox[{"Min", "[", 
            RowBox[{"i", ",", 
             RowBox[{"a", " ", "cap"}]}], "]"}], ",", "0"}], "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"Table", "[", 
              RowBox[{
               RowBox[{"Max", "[", 
                RowBox[{
                 RowBox[{"Min", "[", 
                  RowBox[{"j", ",", 
                   RowBox[{"a", " ", "cap"}]}], "]"}], ",", "0"}], "]"}], ",", 
               RowBox[{"{", 
                RowBox[{"j", ",", 
                 RowBox[{"p1", " ", "Vf"}]}], "}"}]}], "]"}], "-", "p2"}], 
            ")"}]}], "}"}]}], "]"}], "\[IndentingNewLine]", ",", 
       RowBox[{"Parallelization", "\[Rule]", "True"}], ",", 
       RowBox[{"RuntimeAttributes", "\[Rule]", 
        RowBox[{"{", "Listable", "}"}]}], ",", 
       RowBox[{"CompilationOptions", "\[Rule]", 
        RowBox[{"{", 
         RowBox[{"\"\<InlineCompiledFunctions\>\"", "\[Rule]", "True"}], 
         "}"}]}]}], "]"}]}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"demMod", "=", 
   RowBox[{"Compile", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"aa", ",", "_Real", ",", "0"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"pp1", ",", "_Real", ",", "0"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"pp2", ",", "_Real", ",", "0"}], "}"}]}], "}"}], ",", 
     RowBox[{"Max", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Min", "[", 
         RowBox[{
          RowBox[{"pp1", " ", "Vf"}], ",", 
          RowBox[{"aa", " ", "cap"}]}], "]"}], "-", "pp2"}], ",", "0"}], 
      "]"}], ",", 
     RowBox[{"Parallelization", "\[Rule]", "True"}], ",", 
     RowBox[{"RuntimeAttributes", "\[Rule]", 
      RowBox[{"{", "Listable", "}"}]}], ",", 
     RowBox[{"CompilationOptions", "\[Rule]", 
      RowBox[{"{", 
       RowBox[{"\"\<InlineExternalDefinitions\>\"", "\[Rule]", "True"}], 
       "}"}]}]}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"demCHa", "=", 
    RowBox[{"With", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"Vf", "=", "100"}], ",", 
        RowBox[{"cap", "=", "2500"}]}], "}"}], ",", 
      RowBox[{"Compile", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"a", ",", "_Real", ",", "0"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"p1", ",", "_Real", ",", "0"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"p2", ",", "_Real", ",", "0"}], "}"}]}], "}"}], ",", 
        RowBox[{"Min", "[", 
         RowBox[{
          RowBox[{"Max", "[", 
           RowBox[{
            RowBox[{"(", 
             RowBox[{
              RowBox[{"Min", "[", 
               RowBox[{
                RowBox[{"Max", "[", 
                 RowBox[{
                  RowBox[{"p1", " ", "Vf"}], ",", "0"}], "]"}], ",", 
                RowBox[{"a", " ", "cap"}]}], "]"}], "-", "p2"}], ")"}], ",", 
            "0"}], "]"}], ",", 
          RowBox[{"a", " ", "cap"}]}], "]"}], ",", 
        RowBox[{"Parallelization", "\[Rule]", "True"}], ",", 
        RowBox[{"RuntimeAttributes", "\[Rule]", 
         RowBox[{"{", "Listable", "}"}]}]}], "]"}]}], "]"}]}], ";"}], 
  "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"d", "[", 
          RowBox[{"a", ",", "p1", ",", "p2"}], "]"}], ";"}], "//", 
        RowBox[{"Timing", "\[IndentingNewLine]", 
         RowBox[{"demC", "[", 
          RowBox[{"a", ",", "p1", ",", "p2"}], "]"}]}]}], ";"}], "//", 
      RowBox[{"Timing", "\[IndentingNewLine]", 
       RowBox[{"demM", "[", 
        RowBox[{"a", ",", "p1", ",", "p2"}], "]"}]}]}], ";"}], "//", 
    "Timing"}], "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"demMod", "[", 
    RowBox[{"a", ",", "p1", ",", "p2"}], "]"}], ";"}], "//", 
  "Timing"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"demCHa", "[", 
    RowBox[{"a", ",", "p1", ",", "p2"}], "]"}], ";"}], "//", 
  "Timing"}]}], "Input",
 CellChangeTimes->{{3.6129296030667295`*^9, 3.612929744096346*^9}, {
   3.6129585584295254`*^9, 3.6129586377681894`*^9}, {3.612958756519019*^9, 
   3.6129588328807073`*^9}, {3.612958864922974*^9, 3.612959102046379*^9}, {
   3.6129985150728436`*^9, 3.6129986169218664`*^9}, {3.6130093281550856`*^9, 
   3.613009340629413*^9}, {3.6130094979845095`*^9, 3.6130096453389273`*^9}, {
   3.613009702165887*^9, 3.613009703705914*^9}, {3.6130782041241493`*^9, 
   3.6130782593600454`*^9}, {3.613079182546849*^9, 3.6130792367400446`*^9}, {
   3.6130813387594824`*^9, 3.613081342203785*^9}, {3.613083451305813*^9, 
   3.613083495053031*^9}, {3.613083707498925*^9, 3.613083708531613*^9}, {
   3.613083801123455*^9, 3.613083801752875*^9}, {3.6130839943104835`*^9, 
   3.6130840688842916`*^9}, {3.6130851244923286`*^9, 
   3.6130851898950124`*^9}, {3.613085246461796*^9, 3.613085382653754*^9}, {
   3.613085421868949*^9, 3.613085445753899*^9}, {3.6130855107423043`*^9, 
   3.6130855167593236`*^9}, 3.613085572272404*^9, {3.6130863586256027`*^9, 
   3.6130863800599194`*^9}, 3.613086417099659*^9, {3.61311334348477*^9, 
   3.613113374430434*^9}, {3.6131134408998327`*^9, 3.6131136033248324`*^9}, {
   3.6131136472521706`*^9, 3.613113675374954*^9}, {3.613113736505783*^9, 
   3.6131137763914227`*^9}, {3.613114020271311*^9, 3.613114151046658*^9}, {
   3.6131141831981287`*^9, 3.61311418956538*^9}, {3.6131142278779736`*^9, 
   3.6131142770888414`*^9}, {3.6131143074391117`*^9, 3.613114310706294*^9}, {
   3.613114365367799*^9, 3.6131145003439493`*^9}, {3.6131145425441394`*^9, 
   3.6131146442490644`*^9}, {3.6131147668509483`*^9, 
   3.6131148135521398`*^9}, {3.613114884775711*^9, 3.6131149769463224`*^9}, {
   3.613115013514744*^9, 3.6131150295714664`*^9}, {3.613116086078986*^9, 
   3.613116123901245*^9}, {3.613128516890604*^9, 3.613128559487054*^9}, {
   3.613128604685239*^9, 3.613128619286989*^9}, {3.613128662622937*^9, 
   3.613128701894162*^9}, {3.6131317143614397`*^9, 3.6131317171262856`*^9}, {
   3.6131317547964506`*^9, 3.6131318541056633`*^9}, {3.6131326934172163`*^9, 
   3.6131326983164873`*^9}, {3.613132818788951*^9, 3.613132876927782*^9}, {
   3.6131332902738543`*^9, 3.613133342136493*^9}, {3.613133400396406*^9, 
   3.613133431640276*^9}, {3.6131335254779477`*^9, 3.6131335694763336`*^9}, {
   3.6131336103656425`*^9, 3.6131336651432333`*^9}, {3.613133729043908*^9, 
   3.6131337943985586`*^9}, {3.6131338773559656`*^9, 3.613133884912012*^9}, {
   3.613134002101282*^9, 3.6131340629889507`*^9}, {3.6131453084569626`*^9, 
   3.613145329141776*^9}, {3.61314537297005*^9, 3.6131454315811987`*^9}, {
   3.613145465292711*^9, 3.613145492895151*^9}, {3.613145555950261*^9, 
   3.613145623799409*^9}, {3.613145663339816*^9, 3.6131457392990055`*^9}}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"0.28125`5.469692444399043", ",", "Null"}], "}"}]], "Output",
 CellChangeTimes->{{3.6131317869107823`*^9, 3.6131318561860523`*^9}, 
   3.6131333236601543`*^9, 3.6131333623960247`*^9, {3.613133413426112*^9, 
   3.6131334395775747`*^9}, 3.6131335756274424`*^9, 3.6131336942406635`*^9, 
   3.613133895291944*^9, {3.6131340139211764`*^9, 3.6131340640026283`*^9}, 
   3.61314535686329*^9, 3.613145435913088*^9, 3.6131456406916895`*^9, 
   3.6131456925990405`*^9}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"1.625`6.231453278594517", ",", "Null"}], "}"}]], "Output",
 CellChangeTimes->{{3.6131317869107823`*^9, 3.6131318561860523`*^9}, 
   3.6131333236601543`*^9, 3.6131333623960247`*^9, {3.613133413426112*^9, 
   3.6131334395775747`*^9}, 3.6131335756274424`*^9, 3.6131336942406635`*^9, 
   3.613133895291944*^9, {3.6131340139211764`*^9, 3.6131340640026283`*^9}, 
   3.61314535686329*^9, 3.613145435913088*^9, 3.6131456406916895`*^9, 
   3.613145694358215*^9}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"1.1875`6.095233531576528", ",", "Null"}], "}"}]], "Output",
 CellChangeTimes->{{3.6131317869107823`*^9, 3.6131318561860523`*^9}, 
   3.6131333236601543`*^9, 3.6131333623960247`*^9, {3.613133413426112*^9, 
   3.6131334395775747`*^9}, 3.6131335756274424`*^9, 3.6131336942406635`*^9, 
   3.613133895291944*^9, {3.6131340139211764`*^9, 3.6131340640026283`*^9}, 
   3.61314535686329*^9, 3.613145435913088*^9, 3.6131456406916895`*^9, 
   3.6131456956160536`*^9}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"0.`", ",", "Null"}], "}"}]], "Output",
 CellChangeTimes->{{3.6131317869107823`*^9, 3.6131318561860523`*^9}, 
   3.6131333236601543`*^9, 3.6131333623960247`*^9, {3.613133413426112*^9, 
   3.6131334395775747`*^9}, 3.6131335756274424`*^9, 3.6131336942406635`*^9, 
   3.613133895291944*^9, {3.6131340139211764`*^9, 3.6131340640026283`*^9}, 
   3.61314535686329*^9, 3.613145435913088*^9, 3.6131456406916895`*^9, 
   3.613145696683766*^9}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"0.`", ",", "Null"}], "}"}]], "Output",
 CellChangeTimes->{{3.6131317869107823`*^9, 3.6131318561860523`*^9}, 
   3.6131333236601543`*^9, 3.6131333623960247`*^9, {3.613133413426112*^9, 
   3.6131334395775747`*^9}, 3.6131335756274424`*^9, 3.6131336942406635`*^9, 
   3.613133895291944*^9, {3.6131340139211764`*^9, 3.6131340640026283`*^9}, 
   3.61314535686329*^9, 3.613145435913088*^9, 3.6131456406916895`*^9, 
   3.6131456979386044`*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"SetAttributes", "[", 
     RowBox[{"d", ",", "Listable"}], "]"}], ";"}], "*)"}], "\n", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{
     RowBox[{"d", "[", 
      RowBox[{"a", ",", "p1", ",", "p2"}], "]"}], ";"}], "//", "Timing"}], 
   "*)"}], "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{
     RowBox[{"MapThread", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Max", "[", 
         RowBox[{"0.", ",", 
          RowBox[{
           RowBox[{"Min", "[", 
            RowBox[{
             RowBox[{"#1", " ", "Vf"}], ",", 
             RowBox[{"a", " ", "cap"}]}], "]"}], "-", "#2"}]}], "]"}], "&"}], 
       ",", 
       RowBox[{"{", 
        RowBox[{"p1", ",", "p2"}], "}"}]}], "]"}], ";"}], "//", "Timing"}], 
   "*)"}], "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"demC", " ", "=", " ", 
     RowBox[{"Compile", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"a", ",", "_Real", ",", "0"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"p1", ",", "_Real", ",", "1"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"p2", ",", "_Real", ",", "1"}], "}"}]}], "}"}], ",", 
       RowBox[{"Clip", "[", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{
           RowBox[{"Clip", "[", 
            RowBox[{
             RowBox[{"p1", " ", "Vf"}], ",", 
             RowBox[{"{", 
              RowBox[{"0", ",", 
               RowBox[{"a", " ", "cap"}]}], "}"}]}], "]"}], "-", "p2"}], 
          ")"}], ",", 
         RowBox[{"{", 
          RowBox[{"0", ",", 
           RowBox[{"a", " ", "cap"}]}], "}"}]}], "]"}], ",", 
       RowBox[{"Parallelization", "\[Rule]", "True"}], ",", 
       RowBox[{"RuntimeAttributes", "\[Rule]", 
        RowBox[{"{", "Listable", "}"}]}], ",", 
       RowBox[{"CompilationOptions", "\[Rule]", 
        RowBox[{"{", 
         RowBox[{"\"\<InlineExternalDefinitions\>\"", "\[Rule]", "True"}], 
         "}"}]}]}], "]"}]}], ";"}], "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"demM", " ", "=", " ", 
     RowBox[{"Compile", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"a", ",", "_Real", ",", "0"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"p1", ",", "_Real", ",", "1"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"p2", ",", "_Real", ",", "1"}], "}"}]}], "}"}], ",", 
       RowBox[{"MapThread", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Max", "[", 
           RowBox[{"0.", ",", 
            RowBox[{
             RowBox[{"Min", "[", 
              RowBox[{
               RowBox[{"#1", " ", "Vf"}], ",", 
               RowBox[{"a", " ", "cap"}]}], "]"}], "-", "#2"}]}], "]"}], 
          "&"}], ",", 
         RowBox[{"{", 
          RowBox[{"p1", ",", "p2"}], "}"}]}], "]"}], ",", 
       RowBox[{"Parallelization", "\[Rule]", "True"}], ",", 
       RowBox[{"RuntimeAttributes", "\[Rule]", 
        RowBox[{"{", "Listable", "}"}]}], ",", 
       RowBox[{"CompilationOptions", "\[Rule]", 
        RowBox[{"{", 
         RowBox[{"\"\<InlineExternalDefinitions\>\"", "\[Rule]", "True"}], 
         "}"}]}]}], "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"d", "[", 
      RowBox[{"a", ",", "p1", ",", "p2"}], "]"}], ";"}], "//", "Timing"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"demM", "[", 
      RowBox[{"a", ",", "p1", ",", "p2"}], "]"}], ";"}], "//", 
    "Timing"}]}]}]], "Input",
 CellChangeTimes->{{3.6129296030667295`*^9, 3.612929744096346*^9}, {
   3.6129585584295254`*^9, 3.6129586377681894`*^9}, {3.612958756519019*^9, 
   3.6129588328807073`*^9}, {3.612958864922974*^9, 3.612959102046379*^9}, {
   3.6129985150728436`*^9, 3.6129986169218664`*^9}, {3.6130093281550856`*^9, 
   3.613009340629413*^9}, {3.6130094979845095`*^9, 3.6130096453389273`*^9}, {
   3.613009702165887*^9, 3.613009703705914*^9}, {3.6130782041241493`*^9, 
   3.6130782593600454`*^9}, {3.613079182546849*^9, 3.6130792367400446`*^9}, {
   3.6130813387594824`*^9, 3.613081342203785*^9}, {3.613083451305813*^9, 
   3.613083495053031*^9}, {3.613083707498925*^9, 3.613083708531613*^9}, {
   3.613083801123455*^9, 3.613083801752875*^9}, {3.6130839943104835`*^9, 
   3.6130840688842916`*^9}, {3.6130851244923286`*^9, 
   3.6130851898950124`*^9}, {3.613085246461796*^9, 3.613085382653754*^9}, {
   3.613085421868949*^9, 3.613085445753899*^9}, {3.6130855107423043`*^9, 
   3.6130855167593236`*^9}, 3.613085572272404*^9, {3.6130863586256027`*^9, 
   3.6130863800599194`*^9}, 3.613086417099659*^9, {3.61311334348477*^9, 
   3.613113374430434*^9}, {3.6131134408998327`*^9, 3.6131136033248324`*^9}, {
   3.6131136472521706`*^9, 3.613113675374954*^9}, {3.613113736505783*^9, 
   3.6131137763914227`*^9}, {3.613114020271311*^9, 3.613114151046658*^9}, {
   3.6131141831981287`*^9, 3.61311418956538*^9}, {3.6131142278779736`*^9, 
   3.6131142770888414`*^9}, {3.6131143074391117`*^9, 3.613114310706294*^9}, {
   3.613114365367799*^9, 3.6131145003439493`*^9}, {3.6131145425441394`*^9, 
   3.6131146442490644`*^9}, {3.6131147668509483`*^9, 
   3.6131148135521398`*^9}, {3.613114884775711*^9, 3.6131149769463224`*^9}, {
   3.613115013514744*^9, 3.6131150295714664`*^9}, {3.613116086078986*^9, 
   3.613116123901245*^9}, {3.613128516890604*^9, 3.613128559487054*^9}, {
   3.613128604685239*^9, 3.613128619286989*^9}, {3.613128662622937*^9, 
   3.613128701894162*^9}, {3.6131317143614397`*^9, 3.6131317171262856`*^9}, {
   3.6131317547964506`*^9, 3.613131756260426*^9}}],

Cell[BoxData[
 RowBox[{
  StyleBox[
   RowBox[{"Parallelize", "::", "nopar1"}], "MessageName"], 
  RowBox[{
  ":", " "}], "\<\"\[NoBreak]\\!\\(a\\)\[NoBreak] cannot be parallelized; \
proceeding with sequential evaluation. \
\\!\\(\\*ButtonBox[\\\"\[RightSkeleton]\\\", ButtonStyle->\\\"Link\\\", \
ButtonFrame->None, ButtonData:>\\\"paclet:ref/Parallelize\\\", ButtonNote -> \
\\\"Parallelize::nopar1\\\"]\\)\"\>"}]], "Message", "MSG",
 CellChangeTimes->{3.6131287112163897`*^9}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"0.359375`5.57614777531333", ",", "Null"}], "}"}]], "Output",
 CellChangeTimes->{
  3.613113782808709*^9, 3.6131141327114077`*^9, 3.6131141670483427`*^9, 
   3.613114214394964*^9, 3.6131142542025537`*^9, 3.6131142883483567`*^9, 
   3.6131143215225153`*^9, 3.613114983714841*^9, {3.6131161057020893`*^9, 
   3.6131161344622974`*^9}, {3.6131285534460135`*^9, 3.6131285690244207`*^9}, 
   3.613128621843697*^9, 3.6131286765822563`*^9, 3.61312871121739*^9}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"0.015625`4.214419939295737", ",", "Null"}], "}"}]], "Output",
 CellChangeTimes->{
  3.613113782808709*^9, 3.6131141327114077`*^9, 3.6131141670483427`*^9, 
   3.613114214394964*^9, 3.6131142542025537`*^9, 3.6131142883483567`*^9, 
   3.6131143215225153`*^9, 3.613114983714841*^9, {3.6131161057020893`*^9, 
   3.6131161344622974`*^9}, {3.6131285534460135`*^9, 3.6131285690244207`*^9}, 
   3.613128621843697*^9, 3.6131286765822563`*^9, 3.6131287112844343`*^9}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"0.125`5.11750992628768", ",", "Null"}], "}"}]], "Output",
 CellChangeTimes->{
  3.613113782808709*^9, 3.6131141327114077`*^9, 3.6131141670483427`*^9, 
   3.613114214394964*^9, 3.6131142542025537`*^9, 3.6131142883483567`*^9, 
   3.6131143215225153`*^9, 3.613114983714841*^9, {3.6131161057020893`*^9, 
   3.6131161344622974`*^9}, {3.6131285534460135`*^9, 3.6131285690244207`*^9}, 
   3.613128621843697*^9, 3.6131286765822563`*^9, 3.6131287114225264`*^9}]
}, Open  ]],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MapThread", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"Max", "[", 
       RowBox[{"0.", ",", 
        RowBox[{
         RowBox[{"Min", "[", 
          RowBox[{
           RowBox[{"#1", " ", "Vf"}], ",", 
           RowBox[{"a", " ", "cap"}]}], "]"}], "-", "#2"}]}], "]"}], "&"}], 
     ",", 
     RowBox[{"{", 
      RowBox[{"p1", ",", "p2"}], "}"}]}], "]"}], ";"}], "//", 
  "Timing"}]], "Input",
 CellChangeTimes->{{3.6129296030667295`*^9, 3.612929744096346*^9}, {
   3.6129585584295254`*^9, 3.6129586377681894`*^9}, {3.612958756519019*^9, 
   3.6129588328807073`*^9}, {3.612958864922974*^9, 3.612959102046379*^9}, {
   3.6129985150728436`*^9, 3.6129986169218664`*^9}, {3.6130093281550856`*^9, 
   3.613009340629413*^9}, {3.6130094979845095`*^9, 3.6130096453389273`*^9}, {
   3.613009702165887*^9, 3.613009703705914*^9}, {3.6130782041241493`*^9, 
   3.6130782593600454`*^9}, {3.613079182546849*^9, 3.6130792367400446`*^9}, {
   3.6130813387594824`*^9, 3.613081342203785*^9}, {3.613083451305813*^9, 
   3.613083495053031*^9}, {3.613083707498925*^9, 3.613083708531613*^9}, {
   3.613083801123455*^9, 3.613083801752875*^9}, {3.6130839943104835`*^9, 
   3.6130840688842916`*^9}, {3.6130851244923286`*^9, 
   3.6130851898950124`*^9}, {3.613085246461796*^9, 3.613085382653754*^9}, {
   3.613085421868949*^9, 3.613085445753899*^9}, {3.6130855107423043`*^9, 
   3.6130855167593236`*^9}, 3.613085572272404*^9, {3.6130863586256027`*^9, 
   3.6130863800599194`*^9}, 3.613086417099659*^9, {3.61311334348477*^9, 
   3.613113374430434*^9}, {3.6131134408998327`*^9, 3.6131136033248324`*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"demand1", "=", 
   RowBox[{"Compile", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"a", ",", "_Real", ",", "0"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"p1", ",", "_Real", ",", "1"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"p2", ",", "_Real", ",", "1"}], "}"}]}], "}"}], ",", 
     RowBox[{"Min", "/@", 
      RowBox[{"Transpose", "[", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{
          RowBox[{"p1", " ", "Vf"}], "-", "p2"}], ",", 
         RowBox[{
          RowBox[{"a", " ", "cap"}], "-", "p2"}]}], "}"}], "]"}]}], ",", 
     RowBox[{"Parallelization", "\[Rule]", "True"}], ",", 
     RowBox[{"RuntimeAttributes", "\[Rule]", 
      RowBox[{"{", "Listable", "}"}]}], ",", 
     RowBox[{"CompilationOptions", "\[Rule]", 
      RowBox[{"{", 
       RowBox[{"\"\<InlineExternalDefinitions\>\"", "\[Rule]", "True"}], 
       "}"}]}]}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"demand2", "=", 
    RowBox[{"Compile", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"a", ",", "_Real", ",", "0"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"p1", ",", "_Real", ",", "1"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"p2", ",", "_Real", ",", "1"}], "}"}]}], "}"}], ",", 
      RowBox[{"MapThread", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Max", "[", 
          RowBox[{"0.", ",", 
           RowBox[{
            RowBox[{"Min", "[", 
             RowBox[{
              RowBox[{"#1", " ", "Vf"}], ",", 
              RowBox[{"a", " ", "cap"}]}], "]"}], "-", "#2"}]}], "]"}], "&"}],
         ",", 
        RowBox[{"{", 
         RowBox[{"p1", ",", "p2"}], "}"}]}], "]"}], ",", 
      RowBox[{"Parallelization", "\[Rule]", "True"}], ",", 
      RowBox[{"RuntimeAttributes", "\[Rule]", 
       RowBox[{"{", "Listable", "}"}]}], ",", 
      RowBox[{"CompilationOptions", "\[Rule]", 
       RowBox[{"{", 
        RowBox[{"\"\<InlineExternalDefinitions\>\"", "\[Rule]", "True"}], 
        "}"}]}]}], "]"}]}], ";"}], "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{"CompilePrint", "[", "demand1", "]"}], 
   "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"demand3", "=", 
    RowBox[{"Compile", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"{", 
        RowBox[{"p1", ",", "_Real", ",", "1"}], "}"}], "}"}], ",", 
      RowBox[{"Min", "[", "p1", "]"}], ",", 
      RowBox[{"Parallelization", "\[Rule]", "False"}], ",", 
      RowBox[{"RuntimeAttributes", "\[Rule]", 
       RowBox[{"{", "Listable", "}"}]}], ",", 
      RowBox[{"CompilationOptions", "\[Rule]", 
       RowBox[{"{", 
        RowBox[{"\"\<InlineExternalDefinitions\>\"", "\[Rule]", "True"}], 
        "}"}]}]}], "]"}]}], ";"}], "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{"CompilePrint", "[", "demand1", "]"}], 
   "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"demand4", "=", 
   RowBox[{"Compile", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"a", ",", "_Real", ",", "0"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"p1", ",", "_Real", ",", "1"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"p2", ",", "_Real", ",", "1"}], "}"}]}], "}"}], ",", 
     RowBox[{"Clip", "[", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{"Clip", "[", 
          RowBox[{
           RowBox[{"p1", " ", "Vf"}], ",", 
           RowBox[{"{", 
            RowBox[{"0", ",", 
             RowBox[{"a", " ", "cap"}]}], "}"}]}], "]"}], "-", "p2"}], ")"}], 
       ",", 
       RowBox[{"{", 
        RowBox[{"0", ",", 
         RowBox[{"a", " ", "cap"}]}], "}"}]}], "]"}], ",", 
     RowBox[{"Parallelization", "\[Rule]", "True"}], ",", 
     RowBox[{"RuntimeAttributes", "\[Rule]", 
      RowBox[{"{", "Listable", "}"}]}], ",", 
     RowBox[{"CompilationOptions", "\[Rule]", 
      RowBox[{"{", 
       RowBox[{"\"\<InlineExternalDefinitions\>\"", "\[Rule]", "True"}], 
       "}"}]}]}], "]"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.6129296030667295`*^9, 3.612929744096346*^9}, {
   3.6129585584295254`*^9, 3.6129586377681894`*^9}, {3.612958756519019*^9, 
   3.6129588328807073`*^9}, {3.612958864922974*^9, 3.612959102046379*^9}, {
   3.6129985150728436`*^9, 3.6129986169218664`*^9}, {3.6130093281550856`*^9, 
   3.613009340629413*^9}, {3.6130094979845095`*^9, 3.6130096453389273`*^9}, {
   3.613009702165887*^9, 3.613009703705914*^9}, {3.6130782041241493`*^9, 
   3.6130782593600454`*^9}, {3.613079182546849*^9, 3.6130792367400446`*^9}, {
   3.6130813387594824`*^9, 3.613081342203785*^9}, {3.613083451305813*^9, 
   3.613083495053031*^9}, {3.613083707498925*^9, 3.613083708531613*^9}, {
   3.613083801123455*^9, 3.613083801752875*^9}, {3.6130839943104835`*^9, 
   3.6130840688842916`*^9}, {3.6130851244923286`*^9, 
   3.6130851898950124`*^9}, {3.613085246461796*^9, 3.613085382653754*^9}, {
   3.613085421868949*^9, 3.613085445753899*^9}, {3.6130855107423043`*^9, 
   3.6130855167593236`*^9}, 3.613085572272404*^9, {3.6130863586256027`*^9, 
   3.6130863800599194`*^9}, 3.613086417099659*^9, {3.61311334348477*^9, 
   3.613113374430434*^9}, {3.6131134408998327`*^9, 3.6131134787441072`*^9}}],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"demand1", "[", 
     RowBox[{"a", ",", "p1", ",", "p2"}], "]"}], "//", "Timing"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"demand2", "[", 
     RowBox[{"a", ",", "p1", ",", "p2"}], "]"}], "//", "Timing"}], 
   "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{"p3", "=", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{
            RowBox[{"p1", " ", "Vf"}], "-", "p2"}], ",", 
           RowBox[{
            RowBox[{"a", " ", "cap"}], "-", "p2"}]}], "}"}], 
         "\[Transpose]"}]}], ";"}], "//", 
      RowBox[{"Timing", "\[IndentingNewLine]", 
       RowBox[{"demand3", "[", "p3", "]"}]}]}], "//", "Timing"}], "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"demand4", "[", 
     RowBox[{"a", ",", "p1", ",", "p2"}], "]"}], "//", "Timing"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"demand5", "[", 
     RowBox[{"a", ",", "p1", ",", "p2"}], "]"}], "//", 
    "Timing"}]}]}]], "Input",
 CellChangeTimes->{{3.6129296030667295`*^9, 3.612929744096346*^9}, {
   3.6129585584295254`*^9, 3.6129586377681894`*^9}, {3.612958756519019*^9, 
   3.6129588328807073`*^9}, {3.612958864922974*^9, 3.612959102046379*^9}, {
   3.6129985150728436`*^9, 3.6129986169218664`*^9}, {3.6130093281550856`*^9, 
   3.613009340629413*^9}, {3.6130094979845095`*^9, 3.6130096453389273`*^9}, {
   3.613009702165887*^9, 3.613009703705914*^9}, {3.6130782041241493`*^9, 
   3.6130782593600454`*^9}, {3.613079182546849*^9, 3.6130792367400446`*^9}, {
   3.6130813387594824`*^9, 3.613081342203785*^9}, {3.613083451305813*^9, 
   3.613083495053031*^9}, {3.613083707498925*^9, 3.613083708531613*^9}, {
   3.613083801123455*^9, 3.613083801752875*^9}, {3.6130839943104835`*^9, 
   3.6130840688842916`*^9}, {3.6130851244923286`*^9, 
   3.6130851898950124`*^9}, {3.613085246461796*^9, 3.613085382653754*^9}, {
   3.613085421868949*^9, 3.613085445753899*^9}, {3.6130855107423043`*^9, 
   3.6130855167593236`*^9}, 3.613085572272404*^9, {3.6130863586256027`*^9, 
   3.6130863800599194`*^9}, {3.613086417099659*^9, 3.6130864211643734`*^9}}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"0.`", ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"-", "529.7873198318367`"}], ",", "1400.1044518093422`", ",", 
     "2298.3899366326837`", ",", 
     RowBox[{"-", "284.52213042853555`"}], ",", "771.3166471377554`", ",", 
     "1607.449861940881`", ",", "1614.1734900263496`", ",", 
     "1095.2810529712324`", ",", 
     RowBox[{"-", "438.30443199660806`"}], ",", "1265.4410480046845`"}], 
    "}"}]}], "}"}]], "Output",
 CellChangeTimes->{{3.612959070371352*^9, 3.61295909141632*^9}, {
   3.6130095422941084`*^9, 3.6130095777087564`*^9}, {3.6130096157841883`*^9, 
   3.61300964886128*^9}, 3.6130097097989807`*^9, 3.6130853961847916`*^9, 
   3.613085428616454*^9, 3.6130855406312666`*^9, 3.6130863936700087`*^9, 
   3.6131134126569653`*^9}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"0.`", ",", 
   RowBox[{"{", 
    RowBox[{
    "0.`", ",", "1400.1044518093422`", ",", "2298.3899366326837`", ",", "0.`",
      ",", "771.3166471377554`", ",", "1607.449861940881`", ",", 
     "1614.1734900263496`", ",", "1095.2810529712324`", ",", "0.`", ",", 
     "1265.4410480046845`"}], "}"}]}], "}"}]], "Output",
 CellChangeTimes->{{3.612959070371352*^9, 3.61295909141632*^9}, {
   3.6130095422941084`*^9, 3.6130095777087564`*^9}, {3.6130096157841883`*^9, 
   3.61300964886128*^9}, 3.6130097097989807`*^9, 3.6130853961847916`*^9, 
   3.613085428616454*^9, 3.6130855406312666`*^9, 3.6130863936700087`*^9, 
   3.6131134126599665`*^9}],

Cell[BoxData[
 RowBox[{
  StyleBox[
   RowBox[{"CompiledFunction", "::", "cfse"}], "MessageName"], 
  RowBox[{
  ":", " "}], "\<\"Compiled expression \[NoBreak]\\!\\({0.`, \
1400.1044518093422`, 2298.3899366326837`, 0.`, 771.3166471377554`, \
1607.449861940881`, 1614.1734900263496`, 1095.2810529712324`, 0.`, \
1265.4410480046845`}\\)\[NoBreak] should be a \
\[NoBreak]\\!\\(\\\"machine-size integer\\\"\\)\[NoBreak]. \
\\!\\(\\*ButtonBox[\\\"\[RightSkeleton]\\\", ButtonStyle->\\\"Link\\\", \
ButtonFrame->None, ButtonData:>\\\"paclet:ref/message/CompiledFunction/cfse\\\
\", ButtonNote -> \\\"CompiledFunction::cfse\\\"]\\)\"\>"}]], "Message", "MSG",
 CellChangeTimes->{3.613085396323886*^9, 3.6130854286474733`*^9, 
  3.613085540717326*^9, 3.613086393754065*^9, 3.6131134127240095`*^9}],

Cell[BoxData[
 RowBox[{
  StyleBox[
   RowBox[{"CompiledFunction", "::", "cfex"}], "MessageName"], 
  RowBox[{
  ":", " "}], "\<\"Could not complete external evaluation at instruction \
\[NoBreak]\\!\\(1\\)\[NoBreak]; proceeding with uncompiled evaluation. \\!\\(\
\\*ButtonBox[\\\"\[RightSkeleton]\\\", ButtonStyle->\\\"Link\\\", \
ButtonFrame->None, ButtonData:>\\\"paclet:ref/message/CompiledFunction/cfex\\\
\", ButtonNote -> \\\"CompiledFunction::cfex\\\"]\\)\"\>"}]], "Message", "MSG",
 CellChangeTimes->{3.613085396323886*^9, 3.6130854286474733`*^9, 
  3.613085540717326*^9, 3.613086393754065*^9, 3.613113412748026*^9}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"0.046875`4.691541194015399", ",", 
   RowBox[{"{", 
    RowBox[{
    "0.`", ",", "1400.1044518093422`", ",", "2298.3899366326837`", ",", "0.`",
      ",", "771.3166471377554`", ",", "1607.449861940881`", ",", 
     "1614.1734900263496`", ",", "1095.2810529712324`", ",", "0.`", ",", 
     "1265.4410480046845`"}], "}"}]}], "}"}]], "Output",
 CellChangeTimes->{{3.612959070371352*^9, 3.61295909141632*^9}, {
   3.6130095422941084`*^9, 3.6130095777087564`*^9}, {3.6130096157841883`*^9, 
   3.61300964886128*^9}, 3.6130097097989807`*^9, 3.6130853961847916`*^9, 
   3.613085428616454*^9, 3.6130855406312666`*^9, 3.6130863936700087`*^9, 
   3.6131134127500277`*^9}],

Cell[BoxData[
 RowBox[{
  StyleBox[
   RowBox[{"CompiledFunction", "::", "cfse"}], "MessageName"], 
  RowBox[{
  ":", " "}], "\<\"Compiled expression \[NoBreak]\\!\\({0.`, \
1400.1044518093422`, 2298.3899366326837`, 0.`, 771.3166471377554`, \
1607.449861940881`, 1614.1734900263496`, 1095.2810529712324`, 0.`, \
1265.4410480046845`}\\)\[NoBreak] should be a \
\[NoBreak]\\!\\(\\\"machine-size integer\\\"\\)\[NoBreak]. \
\\!\\(\\*ButtonBox[\\\"\[RightSkeleton]\\\", ButtonStyle->\\\"Link\\\", \
ButtonFrame->None, ButtonData:>\\\"paclet:ref/message/CompiledFunction/cfse\\\
\", ButtonNote -> \\\"CompiledFunction::cfse\\\"]\\)\"\>"}]], "Message", "MSG",
 CellChangeTimes->{3.613085396323886*^9, 3.6130854286474733`*^9, 
  3.613085540717326*^9, 3.613086393754065*^9, 3.6131134127760468`*^9}],

Cell[BoxData[
 RowBox[{
  StyleBox[
   RowBox[{"CompiledFunction", "::", "cfex"}], "MessageName"], 
  RowBox[{
  ":", " "}], "\<\"Could not complete external evaluation at instruction \
\[NoBreak]\\!\\(1\\)\[NoBreak]; proceeding with uncompiled evaluation. \\!\\(\
\\*ButtonBox[\\\"\[RightSkeleton]\\\", ButtonStyle->\\\"Link\\\", \
ButtonFrame->None, ButtonData:>\\\"paclet:ref/message/CompiledFunction/cfex\\\
\", ButtonNote -> \\\"CompiledFunction::cfex\\\"]\\)\"\>"}]], "Message", "MSG",
 CellChangeTimes->{3.613085396323886*^9, 3.6130854286474733`*^9, 
  3.613085540717326*^9, 3.613086393754065*^9, 3.6131134128010664`*^9}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"0.046875`4.691541194015399", ",", 
   RowBox[{"{", 
    RowBox[{
    "0.`", ",", "1400.1044518093422`", ",", "2298.3899366326837`", ",", "0.`",
      ",", "771.3166471377554`", ",", "1607.449861940881`", ",", 
     "1614.1734900263496`", ",", "1095.2810529712324`", ",", "0.`", ",", 
     "1265.4410480046845`"}], "}"}]}], "}"}]], "Output",
 CellChangeTimes->{{3.612959070371352*^9, 3.61295909141632*^9}, {
   3.6130095422941084`*^9, 3.6130095777087564`*^9}, {3.6130096157841883`*^9, 
   3.61300964886128*^9}, 3.6130097097989807`*^9, 3.6130853961847916`*^9, 
   3.613085428616454*^9, 3.6130855406312666`*^9, 3.6130863936700087`*^9, 
   3.613113412803062*^9}]
}, Open  ]],

Cell[BoxData[{
 RowBox[{"p1", "=", 
  RowBox[{"RandomReal", "[", 
   RowBox[{"10", ",", 
    RowBox[{"{", "10", "}"}]}], "]"}]}], "\[IndentingNewLine]", 
 RowBox[{"p2", "=", 
  RowBox[{"RandomReal", "[", 
   RowBox[{"10", ",", 
    RowBox[{"{", "10", "}"}]}], "]"}]}], "\[IndentingNewLine]", 
 RowBox[{"Join", "[", 
  RowBox[{
   RowBox[{"List", "/@", "p1"}], ",", 
   RowBox[{"List", "/@", "p2"}], ",", "2"}], "]"}], "\[IndentingNewLine]", 
 RowBox[{"Transpose", "[", 
  RowBox[{"{", 
   RowBox[{"p1", ",", "p2"}], "}"}], "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"mappedmin", "=", 
   RowBox[{"Compile", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"x", ",", "_Real", ",", "1"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"y", ",", "_Real", ",", "1"}], "}"}]}], "}"}], ",", 
     RowBox[{"Min", "[", 
      RowBox[{"Join", "[", 
       RowBox[{
        RowBox[{"List", "/@", "p1"}], ",", 
        RowBox[{"List", "/@", "p2"}], ",", "2"}], "]"}], "]"}], ",", 
     RowBox[{"RuntimeAttributes", "\[Rule]", 
      RowBox[{"{", "Listable", "}"}]}], ",", 
     RowBox[{"Parallelization", "\[Rule]", "True"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{"mappedmin", "[", 
  RowBox[{"p1", ",", "p2"}], "]"}]}], "Input",
 CellChangeTimes->{{3.612929110692255*^9, 3.612929302485562*^9}, {
  3.6129293423896923`*^9, 3.61292940578277*^9}}],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"a", "=", "1"}], ";", 
  RowBox[{"Vf", "=", "100"}], ";", 
  RowBox[{"cap", "=", "2500"}], ";", 
  RowBox[{"p1", "=", 
   RowBox[{"RandomReal", "[", 
    RowBox[{"10", ",", 
     RowBox[{"{", "10", "}"}]}], "]"}]}], ";", 
  RowBox[{"p2", "=", 
   RowBox[{"RandomReal", "[", 
    RowBox[{"10", ",", 
     RowBox[{"{", "10", "}"}]}], "]"}]}], ";", 
  RowBox[{"demand1", "=", 
   RowBox[{"Compile", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"a", ",", "_Real", ",", "0"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"p1", ",", "_Real", ",", "1"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"p2", ",", "_Real", ",", "1"}], "}"}]}], "}"}], ",", 
     RowBox[{"Min", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"p1", " ", "Vf"}], "-", "p2"}], ",", 
       RowBox[{
        RowBox[{"a", " ", "cap"}], "-", "p2"}]}], "]"}], ",", 
     RowBox[{"Parallelization", "\[Rule]", "True"}], ",", 
     RowBox[{"RuntimeAttributes", "\[Rule]", 
      RowBox[{"{", "Listable", "}"}]}], ",", 
     RowBox[{"CompilationOptions", "\[Rule]", 
      RowBox[{"{", 
       RowBox[{"\"\<InlineExternalDefinitions\>\"", "\[Rule]", "True"}], 
       "}"}]}]}], "]"}]}], ";", 
  RowBox[{"demand1", "[", 
   RowBox[{"a", ",", "p1", ",", "p2"}], "]"}]}]], "Input",
 CellChangeTimes->{{3.612899802361724*^9, 3.6128998023687277`*^9}, {
  3.6128998449690037`*^9, 3.6128998489206266`*^9}}],

Cell[BoxData["127.45137825967151`"], "Output",
 CellChangeTimes->{
  3.6128998144907804`*^9, {3.612899854809558*^9, 3.6128998712284346`*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{"Needs", "[", "\"\<CompiledFunctionTools`\>\"", 
  "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"a", "=", "1"}], ";", 
  RowBox[{"Vf", "=", "100"}], ";", 
  RowBox[{"cap", "=", "2500"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{"p1", "=", 
  RowBox[{"RandomReal", "[", 
   RowBox[{"10", ",", 
    RowBox[{"{", "10", "}"}]}], "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"p2", "=", 
   RowBox[{"RandomReal", "[", 
    RowBox[{"10", ",", 
     RowBox[{"{", "10", "}"}]}], "]"}]}], "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{"Min", "[", 
    RowBox[{"Join", "[", 
     RowBox[{
      RowBox[{"List", "/@", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"p1", " ", "Vf"}], "-", "p2"}], ")"}]}], ",", 
      RowBox[{"List", "/@", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"a", " ", "cap"}], "-", "p2"}], ")"}]}], ",", "2"}], "]"}], 
    "]"}], "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{"Min", "[", 
  RowBox[{"Evaluate", "@", 
   RowBox[{"Join", "[", 
    RowBox[{
     RowBox[{"List", "/@", 
      RowBox[{"(", "p1", ")"}]}], ",", 
     RowBox[{"List", "/@", 
      RowBox[{"(", "p2", ")"}]}], ",", "2"}], "]"}]}], "]"}]}], "Input",
 CellChangeTimes->{{3.612874383733766*^9, 3.612874391564966*^9}, {
   3.6128746252771063`*^9, 3.6128746592876773`*^9}, {3.612874901050157*^9, 
   3.61287492200107*^9}, {3.6128751599970455`*^9, 3.6128751688098993`*^9}, {
   3.6128759100668097`*^9, 3.6128759153873453`*^9}, 3.6128760468366027`*^9, {
   3.6128761090277376`*^9, 3.6128761133315935`*^9}, {3.6128800798461075`*^9, 
   3.61288009408356*^9}, {3.6128861332539167`*^9, 3.612886140068437*^9}, {
   3.612886176496622*^9, 3.6128863434864645`*^9}, {3.6128863790050416`*^9, 
   3.612886387171867*^9}, 3.6128866224340315`*^9, {3.612886677468563*^9, 
   3.612886792214736*^9}, {3.6128868335781937`*^9, 3.6128868355024695`*^9}, {
   3.6128871515762753`*^9, 3.6128872333255377`*^9}, {3.612887287713641*^9, 
   3.612887350420268*^9}, {3.612887384251726*^9, 3.612887484426223*^9}, {
   3.6128875370351443`*^9, 3.6128875835910425`*^9}, {3.612887986462187*^9, 
   3.612888115303713*^9}, {3.612890818280584*^9, 3.6128908209433517`*^9}, {
   3.612892396621668*^9, 3.612892525928506*^9}, {3.612892557807662*^9, 
   3.6128926925491076`*^9}, {3.612892767080576*^9, 3.6128928379015875`*^9}, {
   3.6128929942213545`*^9, 3.612893011566866*^9}, {3.612893073995309*^9, 
   3.612893095294443*^9}, {3.612893286762538*^9, 3.6128932891321115`*^9}, {
   3.6128933898459644`*^9, 3.6128934499038305`*^9}, {3.6128934981592846`*^9, 
   3.6128935804469085`*^9}, {3.61289361424234*^9, 3.6128936169281282`*^9}, {
   3.6128936752788563`*^9, 3.6128936778475657`*^9}, {3.612894787176318*^9, 
   3.6128948034170957`*^9}, {3.612894962875945*^9, 3.6128949658559227`*^9}, {
   3.612895003938202*^9, 3.612895034098221*^9}, {3.6128951241880274`*^9, 
   3.6128952225544853`*^9}}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
  "1.2124138975625947`", ",", "9.858494647352938`", ",", "8.301994913235465`",
    ",", "8.469113966142082`", ",", "2.9487131751396856`", ",", 
   "6.742827660104517`", ",", "8.15243827814037`", ",", "2.013615907569882`", 
   ",", "0.4119472072066337`", ",", "5.4346687994269`"}], "}"}]], "Output",
 CellChangeTimes->{{3.6128935657451487`*^9, 3.612893582654372*^9}, 
   3.6128936200832176`*^9, 3.6128936807054577`*^9, {3.6128947968477373`*^9, 
   3.6128948062119527`*^9}, 3.6128949684206266`*^9, 3.612895035481139*^9, 
   3.612895137466838*^9, {3.612895188033403*^9, 3.612895223859353*^9}}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
  "7.246082840988791`", ",", "0.19902676315586376`", ",", "1.74830621154209`",
    ",", "6.600715361953085`", ",", "8.883718588948124`", ",", 
   "1.3273660480814158`", ",", "1.383135899196402`", ",", 
   "2.2508332814304683`", ",", "2.9251604073608046`", ",", 
   "7.54242447369705`"}], "}"}]], "Output",
 CellChangeTimes->{{3.6128935657451487`*^9, 3.612893582654372*^9}, 
   3.6128936200832176`*^9, 3.6128936807054577`*^9, {3.6128947968477373`*^9, 
   3.6128948062119527`*^9}, 3.6128949684206266`*^9, 3.612895035481139*^9, 
   3.612895137466838*^9, {3.612895188033403*^9, 3.612895223864353*^9}}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{"1.2124138975625947`", ",", "7.246082840988791`"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"9.858494647352938`", ",", "0.19902676315586376`"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"8.301994913235465`", ",", "1.74830621154209`"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"8.469113966142082`", ",", "6.600715361953085`"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"2.9487131751396856`", ",", "8.883718588948124`"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"6.742827660104517`", ",", "1.3273660480814158`"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"8.15243827814037`", ",", "1.383135899196402`"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"2.013615907569882`", ",", "2.2508332814304683`"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"0.4119472072066337`", ",", "2.9251604073608046`"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"5.4346687994269`", ",", "7.54242447369705`"}], "}"}]}], 
  "}"}]], "Output",
 CellChangeTimes->{{3.6128935657451487`*^9, 3.612893582654372*^9}, 
   3.6128936200832176`*^9, 3.6128936807054577`*^9, {3.6128947968477373`*^9, 
   3.6128948062119527`*^9}, 3.6128949684206266`*^9, 3.612895035481139*^9, 
   3.612895137466838*^9, {3.612895188033403*^9, 3.6128952238673563`*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{"t", "=", 
    RowBox[{
     RowBox[{"Transpose", "[", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{
         RowBox[{"p1", " ", "Vf"}], "-", "p2"}], ",", 
        RowBox[{
         RowBox[{"a", " ", "cap"}], "-", "p2"}]}], "}"}], "]"}], "//", 
     RowBox[{"MatrixForm", "\[IndentingNewLine]", 
      RowBox[{"SetAttributes", "[", 
       RowBox[{"Min", ",", "Listable"}], "]"}], "\[IndentingNewLine]", 
      RowBox[{"Min", "[", 
       RowBox[{"t", "[", 
        RowBox[{"[", "1", "]"}], "]"}], "]"}]}]}]}], "\[IndentingNewLine]", 
   "*)"}], "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{"Min", "[", 
    RowBox[{"Transpose", "[", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{
        RowBox[{"p1", " ", "Vf"}], "-", "p2"}], ",", 
       RowBox[{
        RowBox[{"a", " ", "cap"}], "-", "p2"}]}], "}"}], "]"}], "]"}], "*)"}],
   "\n", 
  RowBox[{"(*", 
   RowBox[{"Max", "[", 
    RowBox[{"Transpose", "[", 
     RowBox[{"{", 
      RowBox[{"0.", ",", 
       RowBox[{"Min", "[", 
        RowBox[{"Transpose", "[", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{
            RowBox[{"p1", " ", "Vf"}], "-", "p2"}], ",", 
           RowBox[{
            RowBox[{"a", " ", "cap"}], "-", "p2"}]}], "}"}], "]"}], "]"}]}], 
      "}"}], "]"}], "]"}], "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"demand1", "=", 
     RowBox[{"Compile", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"a", ",", "_Real", ",", "0"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"p1", ",", "_Real", ",", "1"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"p2", ",", "_Real", ",", "1"}], "}"}]}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"Min", "[", 
        RowBox[{"Join", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{"p1", " ", "Vf"}], "-", "p2"}], ",", 
            RowBox[{
             RowBox[{"a", " ", "cap"}], "-", "p2"}]}], "}"}], ",", "2"}], 
         "]"}], "]"}], ",", 
       RowBox[{"Parallelization", "\[Rule]", "True"}], ",", 
       RowBox[{"RuntimeAttributes", "\[Rule]", 
        RowBox[{"{", "Listable", "}"}]}], ",", 
       RowBox[{"CompilationOptions", "\[Rule]", 
        RowBox[{"{", 
         RowBox[{"\"\<InlineExternalDefinitions\>\"", "\[Rule]", "True"}], 
         "}"}]}]}], "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{"CompilePrint", "[", "demand1", "]"}]}]}]], "Input",
 CellChangeTimes->{{3.612874383733766*^9, 3.612874391564966*^9}, {
   3.6128746252771063`*^9, 3.6128746592876773`*^9}, {3.612874901050157*^9, 
   3.61287492200107*^9}, {3.6128751599970455`*^9, 3.6128751688098993`*^9}, {
   3.6128759100668097`*^9, 3.6128759153873453`*^9}, 3.6128760468366027`*^9, {
   3.6128761090277376`*^9, 3.6128761133315935`*^9}, {3.6128800798461075`*^9, 
   3.61288009408356*^9}, {3.6128861332539167`*^9, 3.612886140068437*^9}, {
   3.612886176496622*^9, 3.6128863434864645`*^9}, {3.6128863790050416`*^9, 
   3.612886387171867*^9}, 3.6128866224340315`*^9, {3.612886677468563*^9, 
   3.612886792214736*^9}, {3.6128868335781937`*^9, 3.6128868355024695`*^9}, {
   3.6128871515762753`*^9, 3.6128872333255377`*^9}, {3.612887287713641*^9, 
   3.612887350420268*^9}, {3.612887384251726*^9, 3.612887484426223*^9}, {
   3.6128875370351443`*^9, 3.6128875835910425`*^9}, {3.612887986462187*^9, 
   3.612888115303713*^9}, {3.612890818280584*^9, 3.6128908209433517`*^9}, {
   3.612892396621668*^9, 3.612892525928506*^9}, {3.612892557807662*^9, 
   3.6128926925491076`*^9}, {3.612892767080576*^9, 3.6128928379015875`*^9}, {
   3.6128929942213545`*^9, 3.612893011566866*^9}, {3.612893073995309*^9, 
   3.612893095294443*^9}, {3.612893286762538*^9, 3.6128932891321115`*^9}, {
   3.6128933898459644`*^9, 3.6128934499038305`*^9}, {3.6128934981592846`*^9, 
   3.612893563741821*^9}, {3.612894765186723*^9, 3.61289477829142*^9}}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
  "3.718496961494992`", ",", "9.186102428754555`", ",", "9.878626321502711`", 
   ",", "2.9945060964545682`", ",", "4.985335005412006`", ",", 
   "6.036939629778498`", ",", "6.9669525305235105`", ",", 
   "0.48129209178685173`", ",", "8.085009532848218`", ",", 
   "6.528276840141739`"}], "}"}]], "Output",
 CellChangeTimes->{{3.612893514637225*^9, 3.612893531747583*^9}}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
  "2.39177434119949`", ",", "3.2455649825400243`", ",", "7.727861168679979`", 
   ",", "9.927395132290961`", ",", "2.8328120942755675`", ",", 
   "4.795428345103765`", ",", "4.337498934916724`", ",", "4.188909917105326`",
    ",", "1.0742857405936963`", ",", "2.2204800738035306`"}], "}"}]], "Output",
 CellChangeTimes->{{3.612893514637225*^9, 3.6128935317505846`*^9}}],

Cell[BoxData["\<\"\\n\\t\\t3 arguments\\n\\t\\t2 Integer registers\\n\\t\\t3 \
Real registers\\n\\t\\t6 Tensor registers\\n\\t\\tUnderflow checking \
off\\n\\t\\tOverflow checking off\\n\\t\\tInteger overflow checking \
on\\n\\t\\tRuntimeAttributes -> {Listable}\\n\\n\\t\\tR0 = A1\\n\\t\\tT(R1)0 \
= A2\\n\\t\\tT(R1)1 = A3\\n\\t\\tI1 = 2500\\n\\t\\tI0 = 100\\n\\t\\tResult = \
R2\\n\\n1\\tT(R1)2 = - T(R1)1\\n2\\tT(R1)3 = I0 * T(R1)0\\n3\\tT(R1)3 = \
T(R1)3 + T(R1)2\\n4\\tR1 = I1\\n5\\tR2 = R0 * R1\\n6\\tT(R1)4 = R2 + \
T(R1)2\\n7\\tT(R2)5 ={ T(R1)3, T(R1)4 }\\n8\\tT(R2)3 = Transpose[ \
T(R2)5]]\\n9\\tR2 = MinRT[ T(R2)3]]\\n10\\tReturn\\n\"\>"], "Output",
 CellChangeTimes->{{3.612893514637225*^9, 3.6128935317525854`*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"demand2", "=", 
     RowBox[{"Compile", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"a", ",", "_Real", ",", "0"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"p1", ",", "_Real", ",", "1"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"p2", ",", "_Real", ",", "1"}], "}"}]}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"Max", "[", 
        RowBox[{"Transpose", "[", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", "0", "}"}], ",", 
           RowBox[{"Min", "[", 
            RowBox[{"Transpose", "[", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{
                RowBox[{"p1", " ", "Vf"}], "-", "p2"}], ",", 
               RowBox[{
                RowBox[{"a", " ", "cap"}], "-", "p2"}]}], "}"}], "]"}], 
            "]"}]}], "}"}], "]"}], "]"}], ",", 
       RowBox[{"Parallelization", "\[Rule]", "False"}], ",", 
       RowBox[{"RuntimeAttributes", "\[Rule]", 
        RowBox[{"{", "Listable", "}"}]}], ",", 
       RowBox[{"CompilationOptions", "\[Rule]", 
        RowBox[{"{", 
         RowBox[{"\"\<InlineExternalDefinitions\>\"", "\[Rule]", "True"}], 
         "}"}]}]}], "]"}]}], ";", "\[IndentingNewLine]", 
    RowBox[{"CompilePrint", "[", "demand1", "]"}]}], "*)"}], 
  "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"demand1", "=", 
     RowBox[{"Compile", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"a", ",", "_Real", ",", "0"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"p1", ",", "_Real", ",", "1"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"p2", ",", "_Real", ",", "1"}], "}"}]}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"MapThread", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Max", "[", 
           RowBox[{"0", ",", 
            RowBox[{
             RowBox[{"Min", "[", 
              RowBox[{
               RowBox[{"#1", " ", "Vf"}], ",", 
               RowBox[{"a", " ", "cap"}]}], "]"}], "-", "#2"}]}], "]"}], 
          "&"}], ",", 
         RowBox[{"{", 
          RowBox[{"p1", ",", "p2"}], "}"}]}], "]"}], ",", 
       RowBox[{"Parallelization", "\[Rule]", "True"}], ",", 
       RowBox[{"RuntimeAttributes", "\[Rule]", 
        RowBox[{"{", "Listable", "}"}]}], ",", 
       RowBox[{"CompilationOptions", "\[Rule]", 
        RowBox[{"{", 
         RowBox[{"\"\<InlineExternalDefinitions\>\"", "\[Rule]", "True"}], 
         "}"}]}]}], "]"}]}], ";", "\[IndentingNewLine]", 
    RowBox[{"demand2", "=", 
     RowBox[{"Compile", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"a", ",", "_Real", ",", "0"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"p1", ",", "_Real", ",", "1"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"p2", ",", "_Real", ",", "1"}], "}"}]}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"MapThread", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Max", "[", 
           RowBox[{"0", ",", 
            RowBox[{
             RowBox[{"Min", "[", 
              RowBox[{
               RowBox[{"#1", " ", "Vf"}], ",", 
               RowBox[{"a", " ", "cap"}]}], "]"}], "-", "#2"}]}], "]"}], 
          "&"}], ",", 
         RowBox[{"{", 
          RowBox[{"p1", ",", "p2"}], "}"}]}], "]"}], ",", 
       RowBox[{"Parallelization", "\[Rule]", "False"}], ",", 
       RowBox[{"RuntimeAttributes", "\[Rule]", 
        RowBox[{"{", "Listable", "}"}]}], ",", 
       RowBox[{"CompilationOptions", "\[Rule]", 
        RowBox[{"{", 
         RowBox[{"\"\<InlineExternalDefinitions\>\"", "\[Rule]", "True"}], 
         "}"}]}]}], "]"}]}], ";"}], "\[IndentingNewLine]", "*)"}], 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"demand1", "[", 
     RowBox[{"a", ",", "p1", ",", "p2"}], "]"}], "//", "Timing"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"demand2", "[", 
     RowBox[{"a", ",", "p1", ",", "p2"}], "]"}], "//", 
    "Timing"}]}]}]], "Input",
 CellChangeTimes->{{3.612874383733766*^9, 3.612874391564966*^9}, {
   3.6128746252771063`*^9, 3.6128746592876773`*^9}, {3.612874901050157*^9, 
   3.61287492200107*^9}, {3.6128751599970455`*^9, 3.6128751688098993`*^9}, {
   3.6128759100668097`*^9, 3.6128759153873453`*^9}, 3.6128760468366027`*^9, {
   3.6128761090277376`*^9, 3.6128761133315935`*^9}, {3.6128800798461075`*^9, 
   3.61288009408356*^9}, {3.6128861332539167`*^9, 3.612886140068437*^9}, {
   3.612886176496622*^9, 3.6128863434864645`*^9}, {3.6128863790050416`*^9, 
   3.612886387171867*^9}, 3.6128866224340315`*^9, {3.612886677468563*^9, 
   3.612886792214736*^9}, {3.6128868335781937`*^9, 3.6128868355024695`*^9}, {
   3.6128871515762753`*^9, 3.6128872333255377`*^9}, {3.612887287713641*^9, 
   3.612887350420268*^9}, {3.612887384251726*^9, 3.612887484426223*^9}, {
   3.6128875370351443`*^9, 3.6128875835910425`*^9}, {3.612887986462187*^9, 
   3.612888115303713*^9}, {3.612890818280584*^9, 3.6128908209433517`*^9}, {
   3.612892396621668*^9, 3.612892525928506*^9}, {3.612892557807662*^9, 
   3.6128926925491076`*^9}, {3.612892767080576*^9, 3.6128928379015875`*^9}, {
   3.6128929942213545`*^9, 3.612893011566866*^9}, {3.612893073995309*^9, 
   3.612893095294443*^9}, {3.612893286762538*^9, 3.6128932891321115`*^9}, {
   3.6128933898459644`*^9, 3.6128934499038305`*^9}, {3.6128934981592846`*^9, 
   3.6128935085381784`*^9}}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
  "0.8337375355313625`", ",", "35.0635953940799`", ",", "27.70720109197285`", 
   ",", "27.283838455614216`", ",", "4.7867092257016495`", ",", 
   "28.216300272895296`", ",", "0.23540475149802376`", ",", 
   "42.20588097211427`", ",", "18.618227899052457`", ",", 
   "5.658642579380505`"}], "}"}]], "Output",
 CellChangeTimes->{
  3.6128872385299964`*^9, 3.612887372431878*^9, {3.6128874493089094`*^9, 
   3.6128874859042053`*^9}, {3.6128875614573507`*^9, 3.6128876016640406`*^9}, 
   3.612893134420416*^9}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
  "76.47914390366032`", ",", "67.80536488151472`", ",", "76.63503300429994`", 
   ",", "48.89697041718023`", ",", "84.51757058669364`", ",", 
   "55.42487884333974`", ",", "52.45456673948959`", ",", "60.91754257651195`",
    ",", "34.33057858947217`", ",", "61.95307114049345`"}], "}"}]], "Output",
 CellChangeTimes->{
  3.6128872385299964`*^9, 3.612887372431878*^9, {3.6128874493089094`*^9, 
   3.6128874859042053`*^9}, {3.6128875614573507`*^9, 3.6128876016640406`*^9}, 
   3.61289313442542*^9}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"0.`", ",", 
   RowBox[{"-", "28.914091589687217`"}]}], "}"}]], "Output",
 CellChangeTimes->{
  3.6128872385299964`*^9, 3.612887372431878*^9, {3.6128874493089094`*^9, 
   3.6128874859042053`*^9}, {3.6128875614573507`*^9, 3.6128876016640406`*^9}, 
   3.6128931344274206`*^9}],

Cell[BoxData[
 RowBox[{
  StyleBox[
   RowBox[{"CompiledFunction", "::", "cfex"}], "MessageName"], 
  RowBox[{
  ":", " "}], "\<\"Could not complete external evaluation at instruction \
\[NoBreak]\\!\\(21\\)\[NoBreak]; proceeding with uncompiled evaluation. \
\\!\\(\\*ButtonBox[\\\"\[RightSkeleton]\\\", ButtonStyle->\\\"Link\\\", \
ButtonFrame->None, ButtonData:>\\\"paclet:ref/message/CompiledFunction/cfex\\\
\", ButtonNote -> \\\"CompiledFunction::cfex\\\"]\\)\"\>"}]], "Message", "MSG",
 CellChangeTimes->{3.612893134451435*^9}],

Cell[BoxData[
 RowBox[{
  StyleBox[
   RowBox[{"Transpose", "::", "nmtx"}], "MessageName"], 
  RowBox[{
  ":", " "}], "\<\"The first two levels of the one-dimensional list \
\[NoBreak]\\!\\({\\(\\({0}\\)\\), \\(\\(-28.914091589687217`\\)\\)}\\)\
\[NoBreak] cannot be transposed. \\!\\(\\*ButtonBox[\\\"\[RightSkeleton]\\\", \
ButtonStyle->\\\"Link\\\", ButtonFrame->None, \
ButtonData:>\\\"paclet:ref/message/Transpose/nmtx\\\", ButtonNote -> \
\\\"Transpose::nmtx\\\"]\\)\"\>"}]], "Message", "MSG",
 CellChangeTimes->{3.612893134476454*^9}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"0.0625`4.816479930623699", ",", 
   RowBox[{"Transpose", "[", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", "0", "}"}], ",", 
      RowBox[{"-", "28.914091589687217`"}]}], "}"}], "]"}]}], "}"}]], "Output",
 CellChangeTimes->{
  3.6128872385299964`*^9, 3.612887372431878*^9, {3.6128874493089094`*^9, 
   3.6128874859042053`*^9}, {3.6128875614573507`*^9, 3.6128876016640406`*^9}, 
   3.6128931344784565`*^9}]
}, Open  ]],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"MapThread", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"Clip", "[", 
       RowBox[{"#", ",", 
        RowBox[{"{", 
         RowBox[{"0", ",", "#2"}], "}"}]}], "]"}], "&"}], ",", 
     RowBox[{"{", 
      RowBox[{"a", ",", "b"}], "}"}]}], "]"}], ";"}], "//", 
  "Timing"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"MapThread", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"Max", "[", 
       RowBox[{"0", ",", 
        RowBox[{"Min", "[", 
         RowBox[{"#1", ",", "#2"}], "]"}]}], "]"}], "&"}], ",", 
     RowBox[{"{", 
      RowBox[{"a", ",", "b"}], "}"}]}], "]"}], ";"}], "//", 
  "Timing"}]}], "Input",
 CellChangeTimes->{{3.612874383733766*^9, 3.612874391564966*^9}, {
   3.6128746252771063`*^9, 3.6128746592876773`*^9}, {3.612874901050157*^9, 
   3.61287492200107*^9}, {3.6128751599970455`*^9, 3.6128751688098993`*^9}, {
   3.6128759100668097`*^9, 3.6128759153873453`*^9}, 3.6128760468366027`*^9, {
   3.6128761090277376`*^9, 3.6128761133315935`*^9}, {3.6128800798461075`*^9, 
   3.61288009408356*^9}, {3.6128861332539167`*^9, 3.612886140068437*^9}, {
   3.612886176496622*^9, 3.6128863434864645`*^9}, {3.6128863790050416`*^9, 
   3.612886387171867*^9}, 3.6128866224340315`*^9, {3.612886677468563*^9, 
   3.612886792214736*^9}, {3.6128868335781937`*^9, 3.6128868355024695`*^9}, {
   3.6128871515762753`*^9, 3.612887154680336*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"Max", "[", 
   RowBox[{"0", ",", 
    RowBox[{
     RowBox[{"Min", "[", 
      RowBox[{
       RowBox[{"p1", "*", "Vf"}], ",", 
       RowBox[{"a", "*", "cap"}]}], "]"}], "-", "p2"}]}], "]"}], 
  "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{"(", 
        RowBox[{"Max", "[", 
         RowBox[{"0", ",", 
          RowBox[{
           RowBox[{"Min", "[", 
            RowBox[{"#", ",", 
             RowBox[{"{", "5.", "}"}]}], "]"}], "-", "3."}]}], "]"}], ")"}], 
       "&"}], "/@", "a"}], ";"}], "//", "Timing"}], 
   "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{"Clip", "[", 
  RowBox[{
   RowBox[{
    RowBox[{"p1", "*", "Vf"}], "-", "p2"}], ",", 
   RowBox[{"{", 
    RowBox[{"0", ",", 
     RowBox[{
      RowBox[{"a", "*", "cap"}], "-", "p2"}]}], "}"}]}], "]"}]}], "Input",
 CellChangeTimes->{{3.6128691054751334`*^9, 3.6128692971333528`*^9}, {
   3.6128695466109543`*^9, 3.612869639544649*^9}, {3.6128725154851713`*^9, 
   3.6128725178207226`*^9}, {3.6128727040221786`*^9, 3.612872756125764*^9}, {
   3.6128728102286777`*^9, 3.61287281414928*^9}, {3.612872859164156*^9, 
   3.6128729756905107`*^9}, {3.612873035781395*^9, 3.6128730373364305`*^9}, {
   3.612873087396657*^9, 3.612873091794574*^9}, {3.612873125819165*^9, 
   3.6128731866885695`*^9}, {3.6128737562032137`*^9, 3.612874015631427*^9}, 
   3.6128740698123875`*^9, 3.6128742280614367`*^9, 3.6128868960506625`*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{"Clip", "[", 
   RowBox[{
    RowBox[{"a", "-", "3"}], ",", 
    RowBox[{"{", 
     RowBox[{"0", ",", "2"}], "}"}]}], "]"}], "//", "Timing"}]], "Input",
 CellChangeTimes->{{3.6128691054751334`*^9, 3.6128692971333528`*^9}, {
  3.6128695466109543`*^9, 3.612869639544649*^9}, {3.6128725154851713`*^9, 
  3.6128725178207226`*^9}, {3.6128727040221786`*^9, 3.6128727199217324`*^9}, {
  3.6128730443891077`*^9, 3.612873054820035*^9}}],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{",", 
    RowBox[{"CompilationTarget", "\[Rule]", "\"\<C\>\""}]}], "*)"}], 
  "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"aa", "=", 
     RowBox[{"ToExpression", "[", 
      RowBox[{"$ScriptCommandLine", "[", 
       RowBox[{"[", "2", "]"}], "]"}], "]"}]}], ";", "\n", 
    RowBox[{"bb", "=", 
     RowBox[{"ToExpression", "[", 
      RowBox[{"$ScriptCommandLine", "[", 
       RowBox[{"[", "3", "]"}], "]"}], "]"}]}], ";"}], "*)"}], 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"Needs", "[", "\"\<CompiledFunctionTools`\>\"", "]"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"root", " ", "=", " ", "\"\<c:/data/TimeInvariant/\>\""}], ";"}], 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{"Kj", "=", "150."}], ";", 
     RowBox[{"w", "=", "20."}], ";", 
     RowBox[{"Vf", "=", "100."}], ";", 
     RowBox[{"cap", "=", "2500."}], ";", 
     RowBox[{"n", "=", "10"}], ";", 
     RowBox[{"m", "=", "25"}], ";", 
     RowBox[{"p", "=", "5"}], ";", 
     RowBox[{"RML", "=", "3"}], ";", 
     RowBox[{"L", "=", "3."}], ";", 
     RowBox[{"delta", "=", "1."}], ";", 
     RowBox[{"dt", "=", 
      RowBox[{"4.", "/", "3600."}]}], ";", 
     RowBox[{"dx", "=", 
      RowBox[{"1.", "/", "9."}]}], ";", 
     RowBox[{"Ssteps", "=", "10"}], ";", 
     RowBox[{"b", "=", "0.1"}], ";"}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Kj", "=", "150."}], ";", 
    RowBox[{"w", "=", "20."}], ";", 
    RowBox[{"Vf", "=", "100."}], ";", 
    RowBox[{"cap", "=", "2500."}], ";", 
    RowBox[{"L", "=", "3."}], ";", 
    RowBox[{"dx", "=", 
     RowBox[{"1.", "/", "9."}]}], ";", 
    RowBox[{"b", "=", "0.1"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"demand1", "=", 
     RowBox[{"Compile", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"a", ",", "_Real", ",", "0"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"p1", ",", "_Real", ",", "1"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"p2", ",", "_Real", ",", "1"}], "}"}]}], "}"}], ",", 
       RowBox[{"Min", "/@", 
        RowBox[{"Transpose", "[", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{
            RowBox[{"p1", " ", "Vf"}], "-", "p2"}], ",", 
           RowBox[{
            RowBox[{"a", " ", "cap"}], "-", "p2"}]}], "}"}], "]"}]}], ",", 
       RowBox[{"Parallelization", "\[Rule]", "True"}], ",", 
       RowBox[{"RuntimeAttributes", "\[Rule]", 
        RowBox[{"{", "Listable", "}"}]}], ",", 
       RowBox[{"CompilationOptions", "\[Rule]", 
        RowBox[{"{", 
         RowBox[{"\"\<InlineExternalDefinitions\>\"", "\[Rule]", "True"}], 
         "}"}]}]}], "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"demand", "=", 
     RowBox[{"Compile", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"a", ",", "_Real", ",", "0"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"p1", ",", "_Real", ",", "1"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"p2", ",", "_Real", ",", "1"}], "}"}]}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"MapThread", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Clip", "[", 
           RowBox[{"#", ",", 
            RowBox[{"{", 
             RowBox[{"0", ",", "#2"}], "}"}]}], "]"}], "&"}], ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{
             RowBox[{"p1", " ", "Vf"}], "-", "p2"}], ")"}], ",", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"a", " ", "cap"}], "-", "p2"}], ")"}]}], "}"}]}], "]"}], 
       "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{"Max", "[", 
         RowBox[{"0", ",", 
          RowBox[{
           RowBox[{"Min", "[", 
            RowBox[{
             RowBox[{"p2", "*", "Vf"}], ",", 
             RowBox[{"p1", "*", "cap"}]}], "]"}], "-", "p3"}]}], "]"}], 
        "*)"}], "\[IndentingNewLine]", ",", 
       RowBox[{"Parallelization", "\[Rule]", "True"}], ",", 
       RowBox[{"RuntimeAttributes", "\[Rule]", 
        RowBox[{"{", "Listable", "}"}]}], ",", 
       RowBox[{"CompilationOptions", "\[Rule]", 
        RowBox[{"{", 
         RowBox[{"\"\<InlineExternalDefinitions\>\"", "\[Rule]", "True"}], 
         "}"}]}]}], "]"}]}], ";", 
    RowBox[{"(*", 
     RowBox[{"CompilePrint", "[", "demand", "]"}], "*)"}], "\n", 
    RowBox[{"supply", "=", 
     RowBox[{"Compile", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"{", 
         RowBox[{"p", ",", "_Real", ",", "1"}], "}"}], "}"}], ",", 
       RowBox[{"Max", "[", 
        RowBox[{"0", ",", 
         RowBox[{
          RowBox[{"Min", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"(", 
              RowBox[{
               RowBox[{
                RowBox[{"p", "[", 
                 RowBox[{"[", "1", "]"}], "]"}], " ", "Kj"}], "-", 
               RowBox[{"p", "[", 
                RowBox[{"[", "2", "]"}], "]"}]}], ")"}], " ", "w"}], ",", 
            RowBox[{
             RowBox[{"p", "[", 
              RowBox[{"[", "1", "]"}], "]"}], " ", "cap"}]}], "]"}], "-", 
          RowBox[{"p", "[", 
           RowBox[{"[", "3", "]"}], "]"}]}]}], "]"}], ",", 
       RowBox[{"Parallelization", "\[Rule]", "True"}], ",", 
       RowBox[{"RuntimeAttributes", "\[Rule]", 
        RowBox[{"{", "Listable", "}"}]}], ",", 
       RowBox[{"CompilationOptions", "\[Rule]", 
        RowBox[{"{", 
         RowBox[{"\"\<InlineExternalDefinitions\>\"", "\[Rule]", "True"}], 
         "}"}]}]}], "]"}]}], ";", 
    RowBox[{"(*", 
     RowBox[{"CompilePrint", "[", "supply", "]"}], "*)"}], "\n", 
    RowBox[{"Nsupply", "=", 
     RowBox[{"Compile", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"{", 
         RowBox[{"p", ",", "_Real", ",", "1"}], "}"}], "}"}], ",", 
       RowBox[{"Max", "[", 
        RowBox[{"0", ",", 
         RowBox[{
          RowBox[{"Min", "[", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"(", 
               RowBox[{
                RowBox[{
                 RowBox[{"p", "[", 
                  RowBox[{"[", "1", "]"}], "]"}], " ", "Kj"}], "-", 
                RowBox[{"p", "[", 
                 RowBox[{"[", "2", "]"}], "]"}]}], ")"}], " ", "Vf"}], "-", 
             RowBox[{"p", "[", 
              RowBox[{"[", "3", "]"}], "]"}], "-", 
             RowBox[{"p", "[", 
              RowBox[{"[", "4", "]"}], "]"}]}], ",", 
            RowBox[{
             RowBox[{"p", "[", 
              RowBox[{"[", "1", "]"}], "]"}], " ", "cap"}]}], "]"}], "-", 
          RowBox[{"p", "[", 
           RowBox[{"[", "5", "]"}], "]"}]}]}], "]"}], ",", 
       RowBox[{"Parallelization", "\[Rule]", "True"}], ",", 
       RowBox[{"RuntimeAttributes", "\[Rule]", 
        RowBox[{"{", "Listable", "}"}]}], ",", 
       RowBox[{"CompilationOptions", "\[Rule]", 
        RowBox[{"{", 
         RowBox[{"\"\<InlineExternalDefinitions\>\"", "\[Rule]", "True"}], 
         "}"}]}]}], "]"}]}], ";", 
    RowBox[{"(*", 
     RowBox[{"CompilePrint", "[", "Nsupply", "]"}], "*)"}], "\n", 
    RowBox[{"floExctF", "=", 
     RowBox[{"Compile", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"{", 
         RowBox[{"p", ",", "_Real", ",", "1"}], "}"}], "}"}], ",", 
       RowBox[{"Min", "[", 
        RowBox[{
         RowBox[{"demand", "[", 
          RowBox[{"Join", "[", 
           RowBox[{
            RowBox[{"{", "L", "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"p", "[", 
              RowBox[{"[", "1", "]"}], "]"}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"p", "[", 
              RowBox[{"[", "5", "]"}], "]"}], "}"}]}], "]"}], "]"}], ",", 
         RowBox[{"Nsupply", "[", 
          RowBox[{"Join", "[", 
           RowBox[{
            RowBox[{"{", "L", "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"p", "[", 
              RowBox[{"[", "2", "]"}], "]"}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"p", "[", 
              RowBox[{"[", "3", "]"}], "]"}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"p", "[", 
              RowBox[{"[", "4", "]"}], "]"}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"p", "[", 
              RowBox[{"[", "5", "]"}], "]"}], "}"}]}], "]"}], "]"}]}], "]"}], 
       ",", 
       RowBox[{"Parallelization", "\[Rule]", "True"}], ",", 
       RowBox[{"RuntimeAttributes", "\[Rule]", 
        RowBox[{"{", "Listable", "}"}]}], ",", 
       RowBox[{"CompilationOptions", "\[Rule]", 
        RowBox[{"{", 
         RowBox[{"\"\<InlineExternalDefinitions\>\"", "\[Rule]", "True"}], 
         "}"}]}]}], "]"}]}], ";", 
    RowBox[{"(*", 
     RowBox[{"CompilePrint", "[", "floExctF", "]"}], "*)"}], "\n", 
    RowBox[{"(*", 
     RowBox[{
      RowBox[{"floExctR", "=", 
       RowBox[{"Compile", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"p1", ",", "_Real", ",", "1"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"p2", ",", "_Real", ",", "1"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"p3", ",", "_Real", ",", "1"}], "}"}]}], "}"}], ",", 
         RowBox[{"Min", "[", 
          RowBox[{
           RowBox[{"demand", "[", 
            RowBox[{"Join", "[", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"p", "[", 
                RowBox[{"[", "1", "]"}], "]"}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"p", "[", 
                RowBox[{"[", "2", "]"}], "]"}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"p", "[", 
                RowBox[{"[", "6", "]"}], "]"}], "}"}]}], "]"}], "]"}], ",", 
           RowBox[{"Nsupply", "[", 
            RowBox[{"Join", "[", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"p", "[", 
                RowBox[{"[", "1", "]"}], "]"}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"p", "[", 
                RowBox[{"[", "3", "]"}], "]"}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"p", "[", 
                RowBox[{"[", "4", "]"}], "]"}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"p", "[", 
                RowBox[{"[", "5", "]"}], "]"}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"p", "[", 
                RowBox[{"[", "6", "]"}], "]"}], "}"}]}], "]"}], "]"}]}], 
          "]"}], ",", 
         RowBox[{"Parallelization", "\[Rule]", "True"}], ",", 
         RowBox[{"RuntimeAttributes", "\[Rule]", 
          RowBox[{"{", "Listable", "}"}]}], ",", 
         RowBox[{"CompilationOptions", "\[Rule]", 
          RowBox[{"{", 
           RowBox[{"\"\<InlineExternalDefinitions\>\"", "\[Rule]", "True"}], 
           "}"}]}]}], "]"}]}], ";"}], 
     RowBox[{"(*", 
      RowBox[{"CompilePrint", "[", "floExctR", "]"}], "*)"}], "*)"}], 
    "\[IndentingNewLine]", 
    RowBox[{"floExctR", "=", 
     RowBox[{"Compile", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"p1", ",", "_Real", ",", "1"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"p2", ",", "_Real", ",", "1"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"p3", ",", "_Real", ",", "1"}], "}"}]}], "}"}], ",", 
       RowBox[{"Min", "[", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"demand", "[", 
            RowBox[{"ArrayFlatten", "[", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"{", 
                RowBox[{"1.", ",", 
                 RowBox[{"Transpose", "[", 
                  RowBox[{"{", "#", "}"}], "]"}], ",", "0."}], "}"}], "}"}], 
              ",", "2"}], "]"}], "]"}], "&"}], "/@", "p1"}], ",", 
         RowBox[{"MapThread", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"Nsupply", "[", 
             RowBox[{"ArrayFlatten", "[", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{"{", 
                 RowBox[{"1.", ",", 
                  RowBox[{"Transpose", "[", 
                   RowBox[{"{", 
                    RowBox[{"#1", ",", "#2"}], "}"}], "]"}], ",", "0", ",", 
                  "0"}], "}"}], "}"}], ",", "2"}], "]"}], "]"}], "&"}], ",", 
           RowBox[{"{", 
            RowBox[{"p2", ",", "p3"}], "}"}]}], "]"}]}], "]"}], ",", 
       RowBox[{"Parallelization", "\[Rule]", "True"}], ",", 
       RowBox[{"RuntimeAttributes", "\[Rule]", 
        RowBox[{"{", "Listable", "}"}]}], ",", 
       RowBox[{"CompilationOptions", "\[Rule]", 
        RowBox[{"{", 
         RowBox[{"\"\<InlineExternalDefinitions\>\"", "\[Rule]", "True"}], 
         "}"}]}]}], "]"}]}], ";", 
    RowBox[{"CompilePrint", "[", "floExctR", "]"}]}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"gamma", "=", 
     RowBox[{"Compile", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"{", 
         RowBox[{"p", ",", "_Real", ",", "1"}], "}"}], "}"}], ",", 
       RowBox[{"Min", "[", 
        RowBox[{"1", ",", 
         RowBox[{
          RowBox[{"supply", "[", 
           RowBox[{"Join", "[", 
            RowBox[{
             RowBox[{"{", "L", "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"p", "[", 
               RowBox[{"[", "2", "]"}], "]"}], "}"}], ",", 
             RowBox[{"{", "0.", "}"}]}], "]"}], "]"}], "/", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{"demand", "[", 
             RowBox[{"Join", "[", 
              RowBox[{
               RowBox[{"{", "L", "}"}], ",", 
               RowBox[{"{", 
                RowBox[{"p", "[", 
                 RowBox[{"[", "1", "]"}], "]"}], "}"}], ",", 
               RowBox[{"{", "0.", "}"}]}], "]"}], "]"}], "+", "0.001"}], 
           ")"}]}]}], "]"}], ",", 
       RowBox[{"Parallelization", "\[Rule]", "True"}], ",", 
       RowBox[{"RuntimeAttributes", "\[Rule]", 
        RowBox[{"{", "Listable", "}"}]}], ",", 
       RowBox[{"CompilationOptions", "\[Rule]", 
        RowBox[{"{", 
         RowBox[{"\"\<InlineExternalDefinitions\>\"", "\[Rule]", "True"}], 
         "}"}]}]}], "]"}]}], ";", 
    RowBox[{"(*", 
     RowBox[{"CompilePrint", "[", "gamma", "]"}], "*)"}], 
    "\[IndentingNewLine]", 
    RowBox[{"density", "=", 
     RowBox[{"Compile", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"{", 
         RowBox[{"p", ",", "_Real", ",", "1"}], "}"}], "}"}], ",", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{
           RowBox[{"p", "[", 
            RowBox[{"[", "1", "]"}], "]"}], "-", 
           RowBox[{"p", "[", 
            RowBox[{"[", "2", "]"}], "]"}], "+", 
           RowBox[{"p", "[", 
            RowBox[{"[", "3", "]"}], "]"}]}], ")"}], "/", "Vf"}], ")"}], ",", 
       RowBox[{"Parallelization", "\[Rule]", "True"}], ",", 
       RowBox[{"RuntimeAttributes", "\[Rule]", 
        RowBox[{"{", "Listable", "}"}]}], ",", 
       RowBox[{"CompilationOptions", "\[Rule]", 
        RowBox[{"{", 
         RowBox[{"\"\<InlineExternalDefinitions\>\"", "\[Rule]", "True"}], 
         "}"}]}]}], "]"}]}], ";", 
    RowBox[{"(*", 
     RowBox[{"CompilePrint", "[", "density", "]"}], "*)"}], "\n", 
    RowBox[{"inflow", "=", 
     RowBox[{"Compile", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"{", 
         RowBox[{"p", ",", "_Real", ",", "1"}], "}"}], "}"}], ",", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{
          RowBox[{"p", "[", 
           RowBox[{"[", "1", "]"}], "]"}], "-", 
          RowBox[{"b", " ", 
           RowBox[{"p", "[", 
            RowBox[{"[", "2", "]"}], "]"}]}]}], ")"}], " ", "dx"}], ",", 
       RowBox[{"Parallelization", "\[Rule]", "True"}], ",", 
       RowBox[{"RuntimeAttributes", "\[Rule]", 
        RowBox[{"{", "Listable", "}"}]}], ",", 
       RowBox[{"CompilationOptions", "\[Rule]", 
        RowBox[{"{", 
         RowBox[{"\"\<InlineExternalDefinitions\>\"", "\[Rule]", "True"}], 
         "}"}]}]}], "]"}]}], ";", 
    RowBox[{"(*", 
     RowBox[{"CompilePrint", "[", "inflow", "]"}], "*)"}], "\n", 
    RowBox[{"updateF", "=", 
     RowBox[{"Compile", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"{", 
         RowBox[{"p", ",", "_Real", ",", "1"}], "}"}], "}"}], ",", 
       RowBox[{"Max", "[", 
        RowBox[{
         RowBox[{"L", " ", "Kj"}], ",", 
         RowBox[{
          RowBox[{"p", "[", 
           RowBox[{"[", "1", "]"}], "]"}], "+", 
          RowBox[{"p", "[", 
           RowBox[{"[", "2", "]"}], "]"}]}]}], "]"}], ",", 
       RowBox[{"Parallelization", "\[Rule]", "True"}], ",", 
       RowBox[{"RuntimeAttributes", "\[Rule]", 
        RowBox[{"{", "Listable", "}"}]}], ",", 
       RowBox[{"CompilationOptions", "\[Rule]", 
        RowBox[{"{", 
         RowBox[{"\"\<InlineExternalDefinitions\>\"", "\[Rule]", "True"}], 
         "}"}]}]}], "]"}]}], ";", 
    RowBox[{"(*", 
     RowBox[{"CompilePrint", "[", "updateF", "]"}], "*)"}], "\n", 
    RowBox[{"updateR", "=", 
     RowBox[{"Compile", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"{", 
         RowBox[{"p", ",", "_Real", ",", "1"}], "}"}], "}"}], ",", 
       RowBox[{"Total", "[", "p", "]"}], ",", 
       RowBox[{"Parallelization", "\[Rule]", "True"}], ",", 
       RowBox[{"RuntimeAttributes", "\[Rule]", 
        RowBox[{"{", "Listable", "}"}]}]}], "]"}]}], ";", 
    RowBox[{"(*", 
     RowBox[{"CompilePrint", "[", "updateR", "]"}], "*)"}], "\n", 
    RowBox[{"flowR", "=", 
     RowBox[{"Compile", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"{", 
         RowBox[{"p", ",", "_Real", ",", "1"}], "}"}], "}"}], ",", 
       RowBox[{"Join", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"p", "[", 
           RowBox[{"[", "1", "]"}], "]"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"p", "[", 
           RowBox[{"[", "2", "]"}], "]"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"p", "[", 
           RowBox[{"[", "3", "]"}], "]"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"p", "[", 
           RowBox[{"[", "4", "]"}], "]"}], "}"}]}], "]"}], ",", 
       RowBox[{"Parallelization", "\[Rule]", "True"}], ",", 
       RowBox[{"RuntimeAttributes", "\[Rule]", 
        RowBox[{"{", "Listable", "}"}]}]}], "]"}]}], ";", 
    RowBox[{"(*", 
     RowBox[{"CompilePrint", "[", "flowR", "]"}], "*)"}], "\n", 
    RowBox[{"compiledMin", "=", 
     RowBox[{"Compile", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"{", 
         RowBox[{"p", ",", "_Real", ",", "1"}], "}"}], "}"}], ",", 
       RowBox[{"Min", "[", "p", "]"}], ",", 
       RowBox[{"Parallelization", "\[Rule]", "True"}], ",", 
       RowBox[{"RuntimeAttributes", "\[Rule]", 
        RowBox[{"{", "Listable", "}"}]}]}], "]"}]}], ";", 
    RowBox[{"(*", 
     RowBox[{"CompilePrint", "[", "compiledMin", "]"}], "*)"}], 
    "\[IndentingNewLine]"}]}]}]], "Input",
 CellChangeTimes->{{3.612023226274868*^9, 3.612023308894287*^9}, {
   3.6120289429476037`*^9, 3.6120289539439216`*^9}, {3.612101981630884*^9, 
   3.612101985198258*^9}, {3.6121025294596176`*^9, 3.6121025323335314`*^9}, {
   3.612102691318324*^9, 3.612102757763501*^9}, {3.612102791329834*^9, 
   3.6121027983044767`*^9}, {3.6121028404124985`*^9, 3.61210286945282*^9}, {
   3.612102932444417*^9, 3.6121029930439796`*^9}, {3.6121034045060186`*^9, 
   3.6121034051274333`*^9}, 3.6121034432928295`*^9, {3.6121040749284916`*^9, 
   3.612104081288724*^9}, {3.6121042874909377`*^9, 3.6121043152434034`*^9}, 
   3.612104348956001*^9, {3.6121044008935633`*^9, 3.6121044106970897`*^9}, {
   3.6121045975849314`*^9, 3.612104628338397*^9}, {3.612104758575061*^9, 
   3.6121047834015822`*^9}, 3.612105008574419*^9, {3.612107413218937*^9, 
   3.6121074173316717`*^9}, {3.612117740528376*^9, 3.612117764633855*^9}, {
   3.61211795143198*^9, 3.612117963809216*^9}, {3.6121352013952565`*^9, 
   3.61213524918606*^9}, {3.6121352912550526`*^9, 3.6121353157598896`*^9}, 
   3.612135382307171*^9, {3.6121354410803804`*^9, 3.612135445719468*^9}, 
   3.6121359386107426`*^9, {3.6121362237563663`*^9, 3.6121362344324684`*^9}, {
   3.612136283289982*^9, 3.6121362842276077`*^9}, 3.6121363797928495`*^9, {
   3.6121364357718835`*^9, 3.612136441037386*^9}, {3.612136481830531*^9, 
   3.6121365009402485`*^9}, {3.612136621901739*^9, 3.6121366224491034`*^9}, 
   3.6121366821956425`*^9, 3.6121367935613904`*^9, 3.6121374551211495`*^9, {
   3.6121377361291466`*^9, 3.6121377566678143`*^9}, 3.6121378273888736`*^9, {
   3.612137890026557*^9, 3.6121378995458922`*^9}, {3.612138006934985*^9, 
   3.612138013689479*^9}, {3.6121380689132285`*^9, 3.612138072642709*^9}, {
   3.6121381029598846`*^9, 3.612138138015211*^9}, {3.6121381791966143`*^9, 
   3.6121382000524926`*^9}, 3.612138621872572*^9, 3.612139285687533*^9, {
   3.612139829954717*^9, 3.6121398306922083`*^9}, {3.6121400019191484`*^9, 
   3.612140002896799*^9}, {3.6121403567162437`*^9, 3.6121403589967613`*^9}, {
   3.6121409501006794`*^9, 3.612140971555807*^9}, {3.612141154598349*^9, 
   3.612141157954582*^9}, {3.6121427848922844`*^9, 3.612142815617729*^9}, {
   3.612142852346074*^9, 3.6121428531345987`*^9}, {3.6121429346179204`*^9, 
   3.6121430217879267`*^9}, {3.6121434206455793`*^9, 
   3.6121435428314466`*^9}, {3.61214378929737*^9, 3.612143844818313*^9}, {
   3.6121438912922425`*^9, 3.6121439017041674`*^9}, {3.6121439588341837`*^9, 
   3.6121439631550584`*^9}, {3.6121440113821526`*^9, 3.612144035573745*^9}, {
   3.612144121678812*^9, 3.61214414550871*^9}, {3.6121442110293083`*^9, 
   3.612144211846854*^9}, {3.6121442642887526`*^9, 3.6121442651493225`*^9}, {
   3.6121445699298344`*^9, 3.6121446122790127`*^9}, {3.61214470073869*^9, 
   3.612144707414133*^9}, {3.612147894199198*^9, 3.6121479539549613`*^9}, {
   3.612147994780312*^9, 3.612148002762624*^9}, {3.612148050310264*^9, 
   3.6121480513889823`*^9}, {3.612148109704789*^9, 3.6121481107864113`*^9}, {
   3.612152927999116*^9, 3.6121530898108883`*^9}, {3.6121531215540104`*^9, 
   3.6121531583254795`*^9}, 3.6121532031142845`*^9, {3.612153380795519*^9, 
   3.6121533898235292`*^9}, 3.61215343493047*^9, {3.6121551494603176`*^9, 
   3.6121551910248127`*^9}, {3.6121552247764397`*^9, 3.612155254746627*^9}, {
   3.6121555589018607`*^9, 3.6121555661990824`*^9}, {3.612155604857193*^9, 
   3.612155640608906*^9}, {3.612155673110471*^9, 3.612155677313798*^9}, {
   3.612155762218522*^9, 3.612155827924796*^9}, 3.612156201793826*^9, {
   3.612156623817785*^9, 3.6121566491335793`*^9}, {3.6121567718212786`*^9, 
   3.612156798325864*^9}, {3.612167700162096*^9, 3.6121677150189514`*^9}, 
   3.6121681342340517`*^9, 3.612170087589526*^9, {3.612170118192828*^9, 
   3.6121701227888784`*^9}, {3.612170202886012*^9, 3.612170217228527*^9}, {
   3.612170296098846*^9, 3.612170299469082*^9}, {3.612174859074157*^9, 
   3.612174868442374*^9}, {3.612174905478945*^9, 3.6121749141927223`*^9}, {
   3.6121750252794156`*^9, 3.612175049639578*^9}, {3.612175150496484*^9, 
   3.612175173207551*^9}, {3.6121752118951516`*^9, 3.612175223370763*^9}, {
   3.612175448705247*^9, 3.6121754490604815`*^9}, {3.612175480498337*^9, 
   3.6121757635180874`*^9}, {3.612175798662401*^9, 3.612175844638901*^9}, {
   3.6121758778239155`*^9, 3.61217602008529*^9}, {3.6121760528420196`*^9, 
   3.61217606138969*^9}, 3.6121771021585574`*^9, {3.612177193988475*^9, 
   3.612177221599792*^9}, {3.6121772758577876`*^9, 3.6121773079150524`*^9}, {
   3.6121773463505497`*^9, 3.6121773723628087`*^9}, {3.612177508486109*^9, 
   3.6121775182886114`*^9}, {3.6121777079724445`*^9, 
   3.6121777098366814`*^9}, {3.61217780819393*^9, 3.612177814319993*^9}, {
   3.6121778619678545`*^9, 3.61217788217126*^9}, {3.612177951333141*^9, 
   3.6121779608964834`*^9}, 3.612178139420913*^9, {3.6121865737842283`*^9, 
   3.612186577882946*^9}, 3.6121866430231586`*^9, 3.612186820490893*^9, {
   3.6121869451756015`*^9, 3.6121869494764566`*^9}, {3.6121920487112513`*^9, 
   3.6121921851107354`*^9}, {3.6121923389197707`*^9, 3.612192410475238*^9}, {
   3.6121932949433537`*^9, 3.6121933043555984`*^9}, 3.612368294516653*^9, {
   3.6123684248909273`*^9, 3.612368477493738*^9}, {3.6123686015348215`*^9, 
   3.612368613263582*^9}, 3.612368735813677*^9, {3.612369538700982*^9, 
   3.612369592771764*^9}, {3.6123696358732867`*^9, 3.61236966152326*^9}, {
   3.6123698397662125`*^9, 3.612369855541651*^9}, {3.612369956905729*^9, 
   3.612370063082989*^9}, {3.6123703611182137`*^9, 3.6123704080652857`*^9}, {
   3.612371064740831*^9, 3.6123711392581425`*^9}, {3.6123711787242584`*^9, 
   3.612371432050898*^9}, {3.6123740964586377`*^9, 3.6123740986360817`*^9}, {
   3.612374208116529*^9, 3.6123742471903872`*^9}, {3.612375050638279*^9, 
   3.612375077006723*^9}, {3.6123751191446104`*^9, 3.612375121007841*^9}, 
   3.612400148994667*^9, {3.6124001944297376`*^9, 3.6124002234039106`*^9}, {
   3.6124024281322756`*^9, 3.6124024632184973`*^9}, {3.6124089830376263`*^9, 
   3.612408987569625*^9}, {3.612409024790257*^9, 3.6124090768346987`*^9}, {
   3.612409342123251*^9, 3.612409362020418*^9}, {3.6124094066819715`*^9, 
   3.6124094673321085`*^9}, {3.6124096112783613`*^9, 
   3.6124096463025417`*^9}, {3.612409693673886*^9, 3.612409700052106*^9}, {
   3.612413371203472*^9, 3.6124134079978228`*^9}, 3.6124138800652113`*^9, {
   3.6124139523600492`*^9, 3.6124139560434914`*^9}, {3.612460090242484*^9, 
   3.612460142299935*^9}, {3.612460199626871*^9, 3.6124603671157017`*^9}, {
   3.6124615007737026`*^9, 3.612461535069393*^9}, {3.6124620792323437`*^9, 
   3.6124620837873554`*^9}, {3.6124621162358327`*^9, 3.612462170219557*^9}, {
   3.6124629982802224`*^9, 3.6124630425325108`*^9}, {3.6124630808258457`*^9, 
   3.6124630871980667`*^9}, {3.612463581214978*^9, 3.6124635896765795`*^9}, 
   3.61252587979101*^9, {3.612525958101805*^9, 3.6125259901820345`*^9}, {
   3.61252640127604*^9, 3.612526415392381*^9}, 3.6125425337524076`*^9, {
   3.6125427856149035`*^9, 3.6125428209534054`*^9}, {3.612547332653658*^9, 
   3.6125473773643923`*^9}, {3.612547457985009*^9, 3.6125474732901874`*^9}, {
   3.6125475044859304`*^9, 3.6125475675118475`*^9}, {3.612553477076542*^9, 
   3.6125535349920588`*^9}, {3.6125542109861574`*^9, 
   3.6125542537495966`*^9}, {3.612554540513301*^9, 3.6125545933284245`*^9}, {
   3.6125546246432514`*^9, 3.612554647820665*^9}, {3.6125560457310205`*^9, 
   3.6125561201719685`*^9}, {3.612556223148447*^9, 3.6125562258232193`*^9}, {
   3.6125562771193333`*^9, 3.61255628767035*^9}, {3.6125571100118885`*^9, 
   3.6125571368607407`*^9}, {3.612557261326519*^9, 3.61255732141648*^9}, 
   3.612573415901248*^9, {3.612573573144557*^9, 3.6125736177892494`*^9}, {
   3.6125738982225485`*^9, 3.6125739015517626`*^9}, {3.6125740657579594`*^9, 
   3.6125741087845783`*^9}, 3.6125741467668324`*^9, {3.612574226901124*^9, 
   3.6125742555491753`*^9}, {3.6125743282695403`*^9, 
   3.6125743564202614`*^9}, {3.6125744212673817`*^9, 
   3.6125744490328474`*^9}, {3.6125752939607453`*^9, 
   3.6125753102085543`*^9}, {3.6125753882674675`*^9, 
   3.6125755100894814`*^9}, {3.6125763192204304`*^9, 3.612576319758788*^9}, {
   3.6125764827721996`*^9, 3.6125764892014723`*^9}, {3.6125765238445153`*^9, 
   3.612576596928116*^9}, {3.6125767223034916`*^9, 3.6125767252904806`*^9}, {
   3.612576869429769*^9, 3.6125769049854193`*^9}, {3.6125789669624147`*^9, 
   3.612579043528331*^9}, {3.6125791004001513`*^9, 3.6125791182430196`*^9}, {
   3.61257918477326*^9, 3.612579296191355*^9}, {3.612580240519504*^9, 
   3.6125802862619286`*^9}, {3.6125833208404207`*^9, 
   3.6125834045325356`*^9}, {3.6125834457649565`*^9, 3.612583448772957*^9}, 
   3.6125841896543827`*^9, {3.6125842602129517`*^9, 3.6125842792195883`*^9}, 
   3.612584333669803*^9, {3.6125846443674254`*^9, 3.612584652474812*^9}, 
   3.61258471407078*^9, 3.6125848425309815`*^9, {3.6125848905248985`*^9, 
   3.612584900217345*^9}, {3.612584945450425*^9, 3.6125849576355305`*^9}, {
   3.612637176099736*^9, 3.6126371814763117`*^9}, {3.6127070417398987`*^9, 
   3.6127070468873224`*^9}, {3.612713968210849*^9, 3.6127140408901806`*^9}, {
   3.6127888466200533`*^9, 3.612788866647352*^9}, {3.6127949699603605`*^9, 
   3.6127950037457857`*^9}, {3.6127951116574216`*^9, 
   3.6127951626272516`*^9}, {3.6127999159709663`*^9, 
   3.6127999563627777`*^9}, {3.6128000177105026`*^9, 3.612800079590576*^9}, {
   3.6128006673557324`*^9, 3.6128007112628775`*^9}, {3.61280076497453*^9, 
   3.6128007964984555`*^9}, {3.612800843028343*^9, 3.6128008991025643`*^9}, {
   3.6128120730720067`*^9, 3.6128121367883034`*^9}, {3.612872682230852*^9, 
   3.612872687040901*^9}, {3.6128869252690535`*^9, 3.61288694757386*^9}, {
   3.6128870617156277`*^9, 3.6128871319972773`*^9}, {3.613009749978815*^9, 
   3.6130097510945663`*^9}}],

Cell[BoxData["\<\"\\n\\t\\t3 arguments\\n\\t\\t10 Integer registers\\n\\t\\t3 \
Real registers\\n\\t\\t6 Tensor registers\\n\\t\\tUnderflow checking \
off\\n\\t\\tOverflow checking off\\n\\t\\tInteger overflow checking \
on\\n\\t\\tRuntimeAttributes -> {Listable}\\n\\n\\t\\tT(R1)0 = \
A1\\n\\t\\tT(R1)1 = A2\\n\\t\\tT(R1)2 = A3\\n\\t\\tI3 = 1\\n\\t\\tR0 = \
1.\\n\\t\\tI7 = 0\\n\\t\\tResult = I4\\n\\n1\\tI2 = Length[ T(R1)0]\\n2\\tI5 \
= I7\\n3\\tT(I1)3 = Table[ I2]\\n4\\tI4 = I7\\n5\\tgoto 8\\n6\\tI9I4 = \
MainEvaluate[ Function[{p1, p2, p3, Compile`Variable$652Compile$1}, \
Block[{Compile`Variable$652 = Compile`Variable$652Compile$1}, \
{CompiledFunction[{p}, Max[0, Min[p[[2]] 100., p[[1]] 2500.] - p[[3]]], \
-CompiledCode-][ArrayFlatten[{{1., Transpose[{Compile`GetElement[p1, \
Compile`Variable$652]}], 0.}}, 2]], Compile`Variable$652}]][ T(R1)0, T(R1)1, \
T(R1)2, I4]]\\n7\\tElement[ T(I1)3, I5] = I9\\n8\\tif[ ++ I4 <= I2] goto \
6\\n9\\tI1 = Length[ T(R1)2]\\n10\\tI6 = I7\\n11\\tT(I1)4 = Table[ \
I1]\\n12\\tI5 = I7\\n13\\tgoto 16\\n14\\tI8I5 = MainEvaluate[ Function[{p1, \
p2, p3, Compile`Variable$653Compile$2}, Block[{Compile`Variable$653 = \
Compile`Variable$653Compile$2}, {CompiledFunction[{p}, Block[{Compile`$2}, \
Compile`$2 = p[[1]]; Max[0, Min[(Compile`$2 150. - p[[2]]) 100. - p[[3]] - \
p[[4]], Compile`$2 2500.] - p[[5]]]], -CompiledCode-][ArrayFlatten[{{1., \
Transpose[{Compile`GetElement[p2, Compile`Variable$653], \
Compile`GetElement[p3, Compile`Variable$653]}], 0, 0}}, 2]], \
Compile`Variable$653}]][ T(R1)0, T(R1)1, T(R1)2, I5]]\\n15\\tElement[ T(I1)4, \
I6] = I8\\n16\\tif[ ++ I5 <= I1] goto 14\\n17\\tI4 = MinIT[ T(I1)3, \
T(I1)4]]\\n18\\tReturn\\n\"\>"], "Output",
 CellChangeTimes->{3.612800880269063*^9, 3.6128009103340197`*^9}]
}, Open  ]],

Cell[BoxData[{
 RowBox[{
  RowBox[{"L", "=", "3."}], ";", 
  RowBox[{"n", "=", "5"}], ";", 
  RowBox[{"p", "=", "6"}], ";", " ", 
  RowBox[{"RML", "=", "4"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"k0", "=", 
    RowBox[{"Table", "[", 
     RowBox[{
      RowBox[{"RandomReal", "[", "10", "]"}], ",", 
      RowBox[{"{", "2", "}"}], ",", 
      RowBox[{"{", "n", "}"}]}], "]"}]}], ";"}], "\n", 
  RowBox[{"(*", 
   RowBox[{"Fk", "=", 
    RowBox[{"Table", "[", 
     RowBox[{
      RowBox[{"RandomReal", "[", "10", "]"}], ",", 
      RowBox[{"{", "n", "}"}]}], "]"}]}], "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{"kr", "=", 
  RowBox[{"Table", "[", 
   RowBox[{
    RowBox[{"RandomReal", "[", "100", "]"}], ",", 
    RowBox[{"{", 
     RowBox[{"n", "-", "2"}], "}"}], ",", 
    RowBox[{"{", "p", "}"}]}], "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Rk", "=", 
   RowBox[{"Table", "[", 
    RowBox[{
     RowBox[{"RandomReal", "[", "10", "]"}], ",", 
     RowBox[{"{", "4", "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"n", "-", "2"}], "}"}], ",", 
     RowBox[{"{", "p", "}"}]}], "]"}]}], "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{"Fq", "=", 
    RowBox[{
     RowBox[{
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{"RandomReal", "[", "10", "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"n", "-", "1"}], "}"}]}], "]"}], "\[IndentingNewLine]", 
      "Fin"}], "=", 
     RowBox[{"Table", "[", 
      RowBox[{
       RowBox[{"RandomReal", "[", "10", "]"}], ",", 
       RowBox[{"{", 
        RowBox[{"n", "-", "2"}], "}"}]}], "]"}]}]}], 
   "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Rq", "=", 
   RowBox[{"Table", "[", 
    RowBox[{
     RowBox[{"RandomReal", "[", "10", "]"}], ",", 
     RowBox[{"{", 
      RowBox[{"n", "-", "2"}], "}"}], ",", 
     RowBox[{"{", "p", "}"}]}], "]"}]}], "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{"fi", "=", 
    RowBox[{"RandomReal", "[", 
     RowBox[{"100", ",", 
      RowBox[{"{", "8", "}"}]}], "]"}]}], "*)"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Take", "[", 
    RowBox[{"#", ",", 
     RowBox[{"{", 
      RowBox[{"1", ",", 
       RowBox[{"RML", "-", "1"}]}], "}"}]}], "]"}], "&"}], "/@", "kr"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"Take", "[", 
    RowBox[{"#", ",", 
     RowBox[{"{", 
      RowBox[{"2", ",", "RML"}], "}"}]}], "]"}], "&"}], "/@", 
  RowBox[{"Rk", "[", 
   RowBox[{"[", "1", "]"}], "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Take", "[", 
    RowBox[{"#", ",", 
     RowBox[{"{", 
      RowBox[{"1", ",", 
       RowBox[{"RML", "-", "1"}]}], "}"}]}], "]"}], "&"}], "/@", 
  "Rq"}], "\[IndentingNewLine]", 
 RowBox[{"Join", "[", 
  RowBox[{
   RowBox[{
    RowBox[{"{", 
     RowBox[{"#1", ",", "#2", ",", "#3"}], "}"}], "&"}], 
   RowBox[{"{", 
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{"Take", "[", 
        RowBox[{"#", ",", 
         RowBox[{"{", 
          RowBox[{"1", ",", 
           RowBox[{"RML", "-", "1"}]}], "}"}]}], "]"}], "&"}], "/@", "kr"}], 
     ",", 
     RowBox[{
      RowBox[{
       RowBox[{"Take", "[", 
        RowBox[{"#", ",", 
         RowBox[{"{", 
          RowBox[{"2", ",", "RML"}], "}"}]}], "]"}], "&"}], "/@", 
      RowBox[{"Rk", "[", 
       RowBox[{"[", "1", "]"}], "]"}]}], ",", 
     RowBox[{
      RowBox[{
       RowBox[{"Take", "[", 
        RowBox[{"#", ",", 
         RowBox[{"{", 
          RowBox[{"1", ",", 
           RowBox[{"RML", "-", "1"}]}], "}"}]}], "]"}], "&"}], "/@", "Rq"}]}],
     "}"}]}], "]"}]}], "Input",
 CellChangeTimes->{{3.612659076693582*^9, 3.612659078850016*^9}, {
   3.612659213077279*^9, 3.6126592325852547`*^9}, {3.612659533848995*^9, 
   3.6126595637468777`*^9}, {3.612659976594431*^9, 3.612660002802861*^9}, {
   3.6126600554368677`*^9, 3.6126600732357035`*^9}, {3.6126601727648935`*^9, 
   3.6126601735384035`*^9}, {3.6126602036774483`*^9, 3.612660292924802*^9}, {
   3.612660740879425*^9, 3.612660765630885*^9}, {3.6126609502024097`*^9, 
   3.61266099068233*^9}, {3.6126610218080297`*^9, 3.6126610222022915`*^9}, {
   3.612661059076815*^9, 3.6126610766044703`*^9}, {3.612713869594263*^9, 
   3.612713886053209*^9}, {3.612785837745778*^9, 3.6127860191481943`*^9}, {
   3.612786141811615*^9, 3.612786180899565*^9}, {3.612786215398466*^9, 
   3.6127863993445663`*^9}, {3.6127892234868803`*^9, 
   3.6127893028545647`*^9}, {3.6127893329985733`*^9, 3.612789464160638*^9}, {
   3.6127903827964287`*^9, 3.6127904747254486`*^9}, {3.612790555891326*^9, 
   3.6127905610747666`*^9}, {3.612790717853834*^9, 3.6127907287630777`*^9}, {
   3.612790759929764*^9, 3.6127908374412146`*^9}, {3.6127914982228394`*^9, 
   3.6127915102318115`*^9}, {3.6127915615688877`*^9, 3.612791573771989*^9}, 
   3.6127920532672744`*^9, {3.6127941392159166`*^9, 3.6127941841247272`*^9}, {
   3.612795587044979*^9, 3.612795597763092*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"g", "[", 
    RowBox[{"aa_", ",", "a21_", ",", "a22_"}], "]"}], ":=", 
   RowBox[{
    RowBox[{"g", "[", 
     RowBox[{"aa", ",", "a21", ",", "a22"}], "]"}], "=", 
    RowBox[{"f", "[", 
     RowBox[{"aa", ",", "a21", ",", "a22"}], "]"}]}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"f", "=", 
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"Kj", "=", "150."}], ",", 
       RowBox[{"w", "=", "20."}], ",", 
       RowBox[{"Vf", "=", "100."}], ",", 
       RowBox[{"n", "=", "10."}], ",", 
       RowBox[{"m", "=", "25."}], ",", 
       RowBox[{"p", "=", "5."}], ",", 
       RowBox[{"RML", "=", "3."}], ",", 
       RowBox[{"L", "=", "3."}], ",", 
       RowBox[{"delta", "=", "1."}], ",", 
       RowBox[{"dt", "=", 
        RowBox[{"4.", "/", "3600."}]}], ",", 
       RowBox[{"dx", "=", 
        RowBox[{"1.", "/", "9."}]}], ",", 
       RowBox[{"Ssteps", "=", "10."}]}], "}"}], ",", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", "}"}], ",", 
       RowBox[{"Compile", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"aa", ",", "_Integer", ",", "1"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"a21", ",", "_Real"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"a22", ",", "_Real"}], "}"}]}], "}"}], ",", 
         RowBox[{"Module", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{"a", "=", "a21"}], ",", 
             RowBox[{"b", "=", "a22"}], ",", 
             RowBox[{"k0", "=", 
              RowBox[{"Table", "[", 
               RowBox[{"0.", ",", 
                RowBox[{"{", "n", "}"}]}], "]"}]}], ",", 
             RowBox[{"Fk", "=", 
              RowBox[{"Table", "[", 
               RowBox[{"0.", ",", 
                RowBox[{"{", "5", "}"}], ",", 
                RowBox[{"{", "n", "}"}]}], "]"}]}], ",", 
             RowBox[{"kr", "=", 
              RowBox[{"Table", "[", 
               RowBox[{"0.", ",", 
                RowBox[{"{", 
                 RowBox[{"n", "-", "2"}], "}"}], ",", 
                RowBox[{"{", "p", "}"}]}], "]"}]}], ",", 
             RowBox[{"Rk", "=", 
              RowBox[{"Table", "[", 
               RowBox[{"0.", ",", 
                RowBox[{"{", "4", "}"}], ",", 
                RowBox[{"{", 
                 RowBox[{"n", "-", "2"}], "}"}], ",", 
                RowBox[{"{", "p", "}"}]}], "]"}]}], ",", 
             RowBox[{"Fq", "=", 
              RowBox[{"Table", "[", 
               RowBox[{"0.", ",", 
                RowBox[{"{", "4", "}"}], ",", 
                RowBox[{"{", 
                 RowBox[{"n", "-", "1"}], "}"}]}], "]"}]}], ",", 
             RowBox[{"Fin", "=", 
              RowBox[{"Table", "[", 
               RowBox[{"0.", ",", 
                RowBox[{"{", "4", "}"}], ",", 
                RowBox[{"{", 
                 RowBox[{"n", "-", "2"}], "}"}]}], "]"}]}], ",", 
             RowBox[{"Rq", "=", 
              RowBox[{"Table", "[", 
               RowBox[{"0.", ",", 
                RowBox[{"{", "4", "}"}], ",", 
                RowBox[{"{", 
                 RowBox[{"n", "-", "2"}], "}"}], ",", 
                RowBox[{"{", "p", "}"}]}], "]"}]}], ",", 
             RowBox[{"Shutoff", "=", "False"}], ",", 
             RowBox[{"j", "=", "1."}], ",", "fi", ",", "qin", ",", "qr", ",", 
             "qf", ",", "qsum", ",", 
             RowBox[{"TT", "=", "0."}], ",", 
             RowBox[{"FTT", "=", "0."}], ",", 
             RowBox[{"RTT", "=", "0."}], ",", 
             RowBox[{"Tsteps", "=", 
              RowBox[{
               RowBox[{"Length", "[", "aa", "]"}], "/", "Ssteps"}]}], ",", 
             "RM", ",", "RMori"}], " ", "}"}], ",", 
           RowBox[{
            RowBox[{"RM", "=", 
             RowBox[{"Table", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"aa", "[", 
                 RowBox[{"[", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"(", 
                    RowBox[{"j", "-", "1"}], ")"}], "*", "Ssteps"}], "+", 
                   RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Floor", "[", 
                    RowBox[{"i", " ", "dx"}], "]"}], "<", "1"}], ",", " ", 
                    "1", ",", 
                    RowBox[{"Ceiling", "[", 
                    RowBox[{"i", " ", "dx"}], "]"}]}], "]"}]}], "]"}], "]"}], 
                " ", "100"}], ",", 
               RowBox[{"{", 
                RowBox[{"j", ",", "Tsteps"}], "}"}], ",", 
               RowBox[{"{", 
                RowBox[{"i", ",", "2", ",", 
                 RowBox[{"n", "-", "1"}]}], "}"}]}], "]"}]}], ";", 
            RowBox[{"RMori", "=", " ", 
             RowBox[{"RM", "[", 
              RowBox[{"[", "1", "]"}], "]"}]}], ";", 
            RowBox[{"kr", "=", 
             RowBox[{
              RowBox[{
               RowBox[{"ReplacePart", "[", 
                RowBox[{"#", ",", 
                 RowBox[{"(", 
                  RowBox[{"a", " ", 
                   RowBox[{"delta", "/", "Vf"}]}], ")"}], ",", "1"}], "]"}], 
               "&"}], "/@", "kr"}]}], ";", "\[IndentingNewLine]", 
            RowBox[{"RTT", "=", 
             RowBox[{"TT", "=", 
              RowBox[{
               RowBox[{"(", 
                RowBox[{"Total", "@", 
                 RowBox[{"(", 
                  RowBox[{"Total", "@", "kr"}], ")"}]}], ")"}], " ", 
               "dx"}]}]}], ";", 
            RowBox[{"AppendTo", "[", 
             RowBox[{"Rk", ",", "kr"}], "]"}], ";", "\[IndentingNewLine]", 
            RowBox[{"(*", 
             RowBox[{"While", "[", 
              RowBox[{
               RowBox[{"TT", ">", "0"}], ","}]}], "*)"}], 
            "\[IndentingNewLine]", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"Mod", "[", 
                RowBox[{"j", ",", "100"}], "]"}], "\[Equal]", " ", "0"}], ",", 
              RowBox[{"RMori", "=", 
               RowBox[{"RM", "[", 
                RowBox[{"[", 
                 RowBox[{"Min", "[", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"(", 
                    RowBox[{"j", "/", "100"}], ")"}], "+", "1"}], ",", 
                   "Tsteps"}], "]"}], "]"}], "]"}]}]}], "]"}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"fi", "=", 
             RowBox[{
              RowBox[{"demand", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"Join", "[", 
                  RowBox[{
                   RowBox[{"{", "1.", "}"}], ",", 
                   RowBox[{"{", 
                    RowBox[{"#", "[", 
                    RowBox[{"[", 
                    RowBox[{"-", "1"}], "]"}], "]"}], "}"}], ",", 
                   RowBox[{"{", "0.", "}"}]}], "]"}], "&"}], "/@", "kr"}], 
               "]"}], " ", 
              RowBox[{"gamma", "[", 
               RowBox[{"Transpose", "[", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"Take", "[", 
                   RowBox[{"k0", ",", 
                    RowBox[{"{", 
                    RowBox[{"2", ",", 
                    RowBox[{"-", "2"}]}], "}"}]}], "]"}], ",", 
                  RowBox[{"Take", "[", 
                   RowBox[{"k0", ",", 
                    RowBox[{"{", 
                    RowBox[{"3", ",", 
                    RowBox[{"-", "1"}]}], "}"}]}], "]"}]}], "}"}], "]"}], 
               "]"}]}]}], ";", "\[IndentingNewLine]", 
            RowBox[{"qf", "=", 
             RowBox[{
              RowBox[{"Fq", "[", 
               RowBox[{"[", 
                RowBox[{
                 RowBox[{"Mod", "[", 
                  RowBox[{"j", ",", "4"}], "]"}], "+", "1"}], "]"}], "]"}], 
              "=", 
              RowBox[{"floExctF", "[", 
               RowBox[{"Transpose", "[", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"Most", "@", "k0"}], ",", 
                  RowBox[{"Rest", "@", 
                   RowBox[{"(", 
                    RowBox[{"Fk", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], ")"}]}], ",", 
                  RowBox[{"Total", "@", "Fq"}], ",", 
                  RowBox[{"Join", "[", 
                   RowBox[{
                    RowBox[{"Total", "@", "Fin"}], ",", 
                    RowBox[{"{", "0.", "}"}]}], "]"}], ",", 
                  RowBox[{"Join", "[", 
                   RowBox[{
                    RowBox[{"fi", " ", "dx"}], ",", 
                    RowBox[{"{", "0.", "}"}]}], "]"}]}], "}"}], "]"}], 
               "]"}]}]}], ";", "\[IndentingNewLine]", 
            RowBox[{"qin", "=", 
             RowBox[{
              RowBox[{"Fin", "[", 
               RowBox[{"[", 
                RowBox[{
                 RowBox[{"Mod", "[", 
                  RowBox[{"j", ",", "4"}], "]"}], "+", "1"}], "]"}], "]"}], 
              "=", 
              RowBox[{"inflow", "[", 
               RowBox[{"Transpose", "[", 
                RowBox[{"{", 
                 RowBox[{"fi", ",", 
                  RowBox[{"Most", "@", "qf"}]}], "}"}], "]"}], "]"}]}]}], ";",
             "\[IndentingNewLine]", 
            RowBox[{"Fk", "=", 
             RowBox[{"RotateLeft", "[", "Fk", "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"k0", "=", 
             RowBox[{
              RowBox[{"Fk", "[", 
               RowBox[{"[", 
                RowBox[{"-", "1"}], "]"}], "]"}], "=", 
              RowBox[{"updateF", "[", 
               RowBox[{"Transpose", "[", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"Join", "[", 
                   RowBox[{
                    RowBox[{"{", "0.", "}"}], ",", 
                    RowBox[{"density", "[", 
                    RowBox[{"Transpose", "[", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"Most", "@", "qf"}], ",", 
                    RowBox[{"Rest", "@", "qf"}], ",", "qin"}], "}"}], "]"}], 
                    "]"}], ",", 
                    RowBox[{"{", "0.", "}"}]}], "]"}], ",", "k0"}], "}"}], 
                "]"}], "]"}]}]}], ";", "\[IndentingNewLine]", 
            RowBox[{"qsum", "=", 
             RowBox[{"Total", "@", "Rq"}]}], ";", "\[IndentingNewLine]", 
            RowBox[{"qr", "=", 
             RowBox[{
              RowBox[{"Rq", "[", 
               RowBox[{"[", 
                RowBox[{
                 RowBox[{"Mod", "[", 
                  RowBox[{"j", ",", "4"}], "]"}], "+", "1"}], "]"}], "]"}], 
              "=", "\[IndentingNewLine]", 
              RowBox[{"flowR", "@@@", 
               RowBox[{"Transpose", "[", 
                RowBox[{"{", "\[IndentingNewLine]", 
                 RowBox[{
                  RowBox[{"floExct", "[", 
                   RowBox[{"Join", "[", 
                    RowBox[{
                    RowBox[{"{", "L", "}"}], ",", 
                    RowBox[{"Transpose", "[", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"Most", "@", "k0"}], ",", 
                    RowBox[{"Rest", "@", 
                    RowBox[{"(", 
                    RowBox[{"Fk", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], ")"}]}], ",", 
                    RowBox[{"Total", "@", "Fq"}], ",", 
                    RowBox[{"Join", "[", 
                    RowBox[{
                    RowBox[{"Total", "@", "Fin"}], ",", 
                    RowBox[{"{", "0.", "}"}]}], "]"}], ",", 
                    RowBox[{"Join", "[", 
                    RowBox[{
                    RowBox[{"fi", " ", "dx"}], ",", 
                    RowBox[{"{", "0.", "}"}]}], "]"}]}], "}"}], "]"}]}], 
                    "]"}], "]"}], ",", "\[IndentingNewLine]", 
                  RowBox[{"floExct", "[", 
                   RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"Take", "[", 
                    RowBox[{"#", ",", 
                    RowBox[{"{", 
                    RowBox[{"1", ",", 
                    RowBox[{"RML", "-", "1"}]}], "}"}]}], "]"}], "&"}], "/@", 
                    "kr"}], ",", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Take", "[", 
                    RowBox[{"#", ",", 
                    RowBox[{"{", 
                    RowBox[{"2", ",", "RML"}], "}"}]}], "]"}], "&"}], "/@", 
                    RowBox[{"Rk", "[", 
                    RowBox[{"[", "1", "]"}], "]"}]}], ",", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Take", "[", 
                    RowBox[{"#", ",", 
                    RowBox[{"{", 
                    RowBox[{"1", ",", 
                    RowBox[{"RML", "-", "1"}]}], "}"}]}], "]"}], "&"}], "/@", 
                    "qsum"}]}], "]"}], ",", "\[IndentingNewLine]", 
                  "\[IndentingNewLine]", "\[IndentingNewLine]", 
                  RowBox[{"compiledMin", "@@", 
                   RowBox[{"Transpose", "[", 
                    RowBox[{"{", 
                    RowBox[{"RMori", ",", 
                    RowBox[{
                    RowBox[{"floExct", "@@@", 
                    RowBox[{"Transpose", "[", 
                    RowBox[{"{", 
                    RowBox[{"1", ",", 
                    RowBox[{"#1", "[", 
                    RowBox[{"[", "RML", "]"}], "]"}], ",", 
                    RowBox[{"#2", "[", 
                    RowBox[{"[", 
                    RowBox[{"RML", "+", "1"}], "]"}], "]"}], ",", 
                    RowBox[{"#3", "[", 
                    RowBox[{"[", "RML", "]"}], "]"}], ",", "0", ",", "0"}], 
                    "}"}], "]"}]}], "&"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"kr", ",", 
                    RowBox[{"Rk", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], ",", "qsum"}], "}"}]}], 
                    "}"}], "]"}]}], ",", 
                  RowBox[{"floExct", "@@@", 
                   RowBox[{"Transpose", "[", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{"1", ",", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Take", "[", 
                    RowBox[{"#", ",", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"RML", "+", "1"}], ",", 
                    RowBox[{"-", "2"}]}], "}"}]}], "]"}], "&"}], "/@", "kr"}],
                     ",", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Take", "[", 
                    RowBox[{"#", ",", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"RML", "+", "2"}], ",", 
                    RowBox[{"-", "1"}]}], "}"}]}], "]"}], "&"}], "/@", 
                    RowBox[{"Rk", "[", 
                    RowBox[{"[", "1", "]"}], "]"}]}], ",", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Take", "[", 
                    RowBox[{"#", ",", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"RML", "+", "1"}], ",", 
                    RowBox[{"-", "2"}]}], "}"}]}], "]"}], "&"}], "/@", 
                    "qsum"}], ",", "0", ",", "0"}], "}"}], ",", "2"}], 
                    "]"}]}], ",", "fi"}], "}"}], "]"}]}]}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"(*", 
             RowBox[{
              RowBox[{"Rk", "=", 
               RowBox[{"RotateLeft", "[", "Rk", "]"}]}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{"kr", "=", 
               RowBox[{
                RowBox[{"Rk", "[", 
                 RowBox[{"[", 
                  RowBox[{"-", "1"}], "]"}], "]"}], "=", 
                RowBox[{"updateR", "@@@", 
                 RowBox[{"Transpose", "[", 
                  RowBox[{"{", 
                   RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"Join", "[", 
                    RowBox[{
                    RowBox[{"{", "0.", "}"}], ",", "#"}], "]"}], "&"}], "/@", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"density", "@@@", 
                    RowBox[{"Transpose", "[", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"Most", "@", "#"}], ",", 
                    RowBox[{"Rest", "@", "#"}], ",", "0"}], "}"}], "]"}]}], 
                    "&"}], "/@", "qr"}], ")"}]}], ",", "kr"}], "}"}], 
                  "]"}]}]}]}], ";", "\[IndentingNewLine]", 
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{"Shutoff", "\[Equal]", "False"}], ")"}], "&&", 
                 RowBox[{"j", ">", "m"}]}], ",", 
                RowBox[{
                 RowBox[{"Shutoff", "=", "True"}], ";", 
                 RowBox[{"kr", "=", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"ReplacePart", "[", 
                    RowBox[{"#", ",", "0", ",", "1"}], "]"}], "&"}], "/@", 
                   "kr"}]}]}]}], "]"}], ";", "\[IndentingNewLine]", 
              RowBox[{"FTT", "+=", 
               RowBox[{"Total", "@", "k0"}]}], ";", 
              RowBox[{"RTT", "+=", 
               RowBox[{
                RowBox[{"(", 
                 RowBox[{"Total", "@", 
                  RowBox[{"(", 
                   RowBox[{"Total", "@", "kr"}], ")"}]}], ")"}], " ", 
                "dx"}]}], ";", 
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{"j", ">", "m"}], ",", 
                RowBox[{"TT", "=", 
                 RowBox[{"Total", "@", "k0"}]}]}], "]"}], ";", 
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"Max", "[", 
                  RowBox[{"(", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"#", "[", 
                    RowBox[{"[", 
                    RowBox[{"RML", "+", "1"}], "]"}], "]"}], "&"}], "/@", 
                    "kr"}], ")"}], "]"}], ">", 
                 RowBox[{"Kj", "-", 
                  RowBox[{"a", "/", "w"}]}]}], ",", 
                RowBox[{
                 RowBox[{"Print", "[", "\"\<Meter Spillback\>\"", "]"}], ";", 
                 RowBox[{"RTT", "=", 
                  RowBox[{"10", "^", "10"}]}], ";", 
                 RowBox[{"Break", "[", "]"}]}]}], "]"}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"Max", "[", 
                  RowBox[{"(", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"#", "[", 
                    RowBox[{"[", "2", "]"}], "]"}], "&"}], "/@", "kr"}], 
                   ")"}], "]"}], ">", 
                 RowBox[{"Kj", "-", 
                  RowBox[{"a", "/", "w"}]}]}], ",", 
                RowBox[{
                 RowBox[{"Print", "[", "\"\<Ramp Spillback\>\"", "]"}], ";", 
                 RowBox[{"RTT", "=", 
                  RowBox[{"10", "^", "10"}]}], ";", 
                 RowBox[{"Break", "[", "]"}]}]}], "]"}], ";", 
              RowBox[{"j", "++"}]}], "*)"}], 
            RowBox[{"(*", 
             RowBox[{"]", ";"}], "*)"}], "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"RTT", "+", "FTT"}], ")"}], " ", "dt", " ", "dx"}]}]}], 
          "]"}], ",", 
         RowBox[{"CompilationOptions", "\[Rule]", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"\"\<ExpressionOptimization\>\"", "\[Rule]", "True"}], 
            ",", 
            RowBox[{
            "\"\<InlineExternalDefinitions\>\"", "\[Rule]", "True"}]}], 
           "}"}]}], ",", 
         RowBox[{"Parallelization", "\[Rule]", "True"}], ",", 
         RowBox[{"RuntimeAttributes", "\[Rule]", 
          RowBox[{"{", "Listable", "}"}]}], ",", 
         RowBox[{"RuntimeOptions", "\[Rule]", "\"\<Speed\>\""}]}], "]"}]}], 
      "]"}]}], "]"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.612023226274868*^9, 3.612023308894287*^9}, {
   3.6120289429476037`*^9, 3.6120289539439216`*^9}, {3.612101981630884*^9, 
   3.612101985198258*^9}, {3.6121025294596176`*^9, 3.6121025323335314`*^9}, {
   3.612102691318324*^9, 3.612102757763501*^9}, {3.612102791329834*^9, 
   3.6121027983044767`*^9}, {3.6121028404124985`*^9, 3.61210286945282*^9}, {
   3.612102932444417*^9, 3.6121029930439796`*^9}, {3.6121034045060186`*^9, 
   3.6121034051274333`*^9}, 3.6121034432928295`*^9, {3.6121040749284916`*^9, 
   3.612104081288724*^9}, {3.6121042874909377`*^9, 3.6121043152434034`*^9}, 
   3.612104348956001*^9, {3.6121044008935633`*^9, 3.6121044106970897`*^9}, {
   3.6121045975849314`*^9, 3.612104628338397*^9}, {3.612104758575061*^9, 
   3.6121047834015822`*^9}, 3.612105008574419*^9, {3.612107413218937*^9, 
   3.6121074173316717`*^9}, {3.612117740528376*^9, 3.612117764633855*^9}, {
   3.61211795143198*^9, 3.612117963809216*^9}, {3.6121352013952565`*^9, 
   3.61213524918606*^9}, {3.6121352912550526`*^9, 3.6121353157598896`*^9}, 
   3.612135382307171*^9, {3.6121354410803804`*^9, 3.612135445719468*^9}, 
   3.6121359386107426`*^9, {3.6121362237563663`*^9, 3.6121362344324684`*^9}, {
   3.612136283289982*^9, 3.6121362842276077`*^9}, 3.6121363797928495`*^9, {
   3.6121364357718835`*^9, 3.612136441037386*^9}, {3.612136481830531*^9, 
   3.6121365009402485`*^9}, {3.612136621901739*^9, 3.6121366224491034`*^9}, 
   3.6121366821956425`*^9, 3.6121367935613904`*^9, 3.6121374551211495`*^9, {
   3.6121377361291466`*^9, 3.6121377566678143`*^9}, 3.6121378273888736`*^9, {
   3.612137890026557*^9, 3.6121378995458922`*^9}, {3.612138006934985*^9, 
   3.612138013689479*^9}, {3.6121380689132285`*^9, 3.612138072642709*^9}, {
   3.6121381029598846`*^9, 3.612138138015211*^9}, {3.6121381791966143`*^9, 
   3.6121382000524926`*^9}, 3.612138621872572*^9, 3.612139285687533*^9, {
   3.612139829954717*^9, 3.6121398306922083`*^9}, {3.6121400019191484`*^9, 
   3.612140002896799*^9}, {3.6121403567162437`*^9, 3.6121403589967613`*^9}, {
   3.6121409501006794`*^9, 3.612140971555807*^9}, {3.612141154598349*^9, 
   3.612141157954582*^9}, {3.6121427848922844`*^9, 3.612142815617729*^9}, {
   3.612142852346074*^9, 3.6121428531345987`*^9}, {3.6121429346179204`*^9, 
   3.6121430217879267`*^9}, {3.6121434206455793`*^9, 
   3.6121435428314466`*^9}, {3.61214378929737*^9, 3.612143844818313*^9}, {
   3.6121438912922425`*^9, 3.6121439017041674`*^9}, {3.6121439588341837`*^9, 
   3.6121439631550584`*^9}, {3.6121440113821526`*^9, 3.612144035573745*^9}, {
   3.612144121678812*^9, 3.61214414550871*^9}, {3.6121442110293083`*^9, 
   3.612144211846854*^9}, {3.6121442642887526`*^9, 3.6121442651493225`*^9}, {
   3.6121445699298344`*^9, 3.6121446122790127`*^9}, {3.61214470073869*^9, 
   3.612144707414133*^9}, {3.612147894199198*^9, 3.6121479539549613`*^9}, {
   3.612147994780312*^9, 3.612148002762624*^9}, {3.612148050310264*^9, 
   3.6121480513889823`*^9}, {3.612148109704789*^9, 3.6121481107864113`*^9}, {
   3.612152927999116*^9, 3.6121530898108883`*^9}, {3.6121531215540104`*^9, 
   3.6121531583254795`*^9}, 3.6121532031142845`*^9, {3.612153380795519*^9, 
   3.6121533898235292`*^9}, 3.61215343493047*^9, {3.6121551494603176`*^9, 
   3.6121551910248127`*^9}, {3.6121552247764397`*^9, 3.612155254746627*^9}, {
   3.6121555589018607`*^9, 3.6121555661990824`*^9}, {3.612155604857193*^9, 
   3.612155640608906*^9}, {3.612155673110471*^9, 3.612155677313798*^9}, {
   3.612155762218522*^9, 3.612155827924796*^9}, 3.612156201793826*^9, {
   3.612156623817785*^9, 3.6121566491335793`*^9}, {3.6121567718212786`*^9, 
   3.612156798325864*^9}, {3.612167700162096*^9, 3.6121677150189514`*^9}, 
   3.6121681342340517`*^9, 3.612170087589526*^9, {3.612170118192828*^9, 
   3.6121701227888784`*^9}, {3.612170202886012*^9, 3.612170217228527*^9}, {
   3.612170296098846*^9, 3.612170299469082*^9}, {3.612174859074157*^9, 
   3.612174868442374*^9}, {3.612174905478945*^9, 3.6121749141927223`*^9}, {
   3.6121750252794156`*^9, 3.612175049639578*^9}, {3.612175150496484*^9, 
   3.612175173207551*^9}, {3.6121752118951516`*^9, 3.612175223370763*^9}, {
   3.612175448705247*^9, 3.6121754490604815`*^9}, {3.612175480498337*^9, 
   3.6121757635180874`*^9}, {3.612175798662401*^9, 3.612175844638901*^9}, {
   3.6121758778239155`*^9, 3.61217602008529*^9}, {3.6121760528420196`*^9, 
   3.61217606138969*^9}, 3.6121771021585574`*^9, {3.612177193988475*^9, 
   3.612177221599792*^9}, {3.6121772758577876`*^9, 3.6121773079150524`*^9}, {
   3.6121773463505497`*^9, 3.6121773723628087`*^9}, {3.612177508486109*^9, 
   3.6121775182886114`*^9}, {3.6121777079724445`*^9, 
   3.6121777098366814`*^9}, {3.61217780819393*^9, 3.612177814319993*^9}, {
   3.6121778619678545`*^9, 3.61217788217126*^9}, {3.612177951333141*^9, 
   3.6121779608964834`*^9}, 3.612178139420913*^9, {3.6121865737842283`*^9, 
   3.612186577882946*^9}, 3.6121866430231586`*^9, 3.612186820490893*^9, {
   3.6121869451756015`*^9, 3.6121869494764566`*^9}, {3.6121920487112513`*^9, 
   3.6121921851107354`*^9}, {3.6121923389197707`*^9, 3.612192410475238*^9}, {
   3.6121932949433537`*^9, 3.6121933043555984`*^9}, 3.612368294516653*^9, {
   3.6123684248909273`*^9, 3.612368477493738*^9}, {3.6123686015348215`*^9, 
   3.612368613263582*^9}, 3.612368735813677*^9, {3.612369538700982*^9, 
   3.612369592771764*^9}, {3.6123696358732867`*^9, 3.61236966152326*^9}, {
   3.6123698397662125`*^9, 3.612369855541651*^9}, {3.612369956905729*^9, 
   3.612370063082989*^9}, {3.6123703611182137`*^9, 3.6123704080652857`*^9}, {
   3.612371064740831*^9, 3.6123711392581425`*^9}, {3.6123711787242584`*^9, 
   3.612371432050898*^9}, {3.6123740964586377`*^9, 3.6123740986360817`*^9}, {
   3.612374208116529*^9, 3.6123742471903872`*^9}, {3.612375050638279*^9, 
   3.612375077006723*^9}, {3.6123751191446104`*^9, 3.612375121007841*^9}, 
   3.612400148994667*^9, {3.6124001944297376`*^9, 3.6124002234039106`*^9}, {
   3.6124024281322756`*^9, 3.6124024632184973`*^9}, {3.6124089830376263`*^9, 
   3.612408987569625*^9}, {3.612409024790257*^9, 3.6124090768346987`*^9}, {
   3.612409342123251*^9, 3.612409362020418*^9}, {3.6124094066819715`*^9, 
   3.6124094673321085`*^9}, {3.6124096112783613`*^9, 
   3.6124096463025417`*^9}, {3.612409693673886*^9, 3.612409700052106*^9}, {
   3.612413371203472*^9, 3.6124134079978228`*^9}, 3.6124138800652113`*^9, {
   3.6124139523600492`*^9, 3.6124139560434914`*^9}, {3.612460090242484*^9, 
   3.612460142299935*^9}, 3.612460199626871*^9, 3.612528186519616*^9, {
   3.6125282213726797`*^9, 3.612528247593032*^9}, {3.6125283128472114`*^9, 
   3.6125283257177277`*^9}, {3.6125300154177475`*^9, 
   3.6125300302495575`*^9}, {3.612530188881505*^9, 3.612530222525769*^9}, {
   3.612530320771781*^9, 3.612530363262898*^9}, 3.6125474705913897`*^9, {
   3.612553574675453*^9, 3.612553590627056*^9}, 3.612553629103644*^9, {
   3.6125542688106127`*^9, 3.6125542727802525`*^9}, {3.612554341184743*^9, 
   3.6125543863567853`*^9}, {3.612554440698928*^9, 3.6125544420578284`*^9}, {
   3.6125544885887723`*^9, 3.612554499447994*^9}, {3.612558043106106*^9, 
   3.6125580577808647`*^9}, {3.6125581727993555`*^9, 
   3.6125581801662607`*^9}, {3.612558261093074*^9, 3.6125582775019855`*^9}, {
   3.6125626230829735`*^9, 3.6125626367630744`*^9}, {3.612573380510711*^9, 
   3.612573392964995*^9}, {3.6125735014381313`*^9, 3.6125735041609383`*^9}, {
   3.61257353709258*^9, 3.612573544473486*^9}, {3.612573640522365*^9, 
   3.612573641942305*^9}, 3.612573840311033*^9, {3.6125738730448*^9, 
   3.612573881915699*^9}, {3.6125849741825314`*^9, 3.6125850596293554`*^9}, {
   3.6125852033454857`*^9, 3.612585235507696*^9}, {3.612585296481244*^9, 
   3.6125853790031233`*^9}, {3.6125854159857163`*^9, 
   3.6125854239410086`*^9}, {3.61260837975736*^9, 3.612608404325701*^9}, {
   3.6126187843843484`*^9, 3.6126188162845645`*^9}, 3.612722564912916*^9, {
   3.6127871222994576`*^9, 3.612787124129672*^9}, {3.612787155629584*^9, 
   3.612787200752537*^9}, {3.612788418802072*^9, 3.6127884540134478`*^9}, {
   3.6127890905890007`*^9, 3.612789093956236*^9}, {3.612789125711317*^9, 
   3.6127891330081577`*^9}, {3.6127895452564697`*^9, 
   3.6127895488678656`*^9}, {3.612790169784028*^9, 3.6127902267218246`*^9}, {
   3.6127902765989337`*^9, 3.612790291884076*^9}, {3.612794549992588*^9, 
   3.612794564172001*^9}, {3.612794755802204*^9, 3.612794837503437*^9}, {
   3.6127950301373053`*^9, 3.612795072688552*^9}, {3.6127954845059137`*^9, 
   3.612795489205033*^9}, {3.612795530928727*^9, 3.612795559675811*^9}, {
   3.612795752993134*^9, 3.6127957579684367`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"f", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "1", ",", "2", ",", "3", ",", "4", ",", "5", ",", "6", ",", "7", ",", 
      "8", ",", "9", ",", "10"}], "}"}], ",", "1500", ",", "0.1"}], "]"}], "//",
   "Timing"}]], "Input"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"f", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "1", ",", "2", ",", "3", ",", "4", ",", "5", ",", "6", ",", "7", ",", 
      "8", ",", "9", ",", "10"}], "}"}], ",", "1500", ",", "0.1"}], "]"}], "//",
   "Timing"}]], "Input",
 CellChangeTimes->{{3.6123684981013775`*^9, 3.6123685136776853`*^9}, {
  3.612368544215892*^9, 3.612368579543267*^9}}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"10.03125`7.021954967364591", ",", "2015.6902598469592`"}], 
  "}"}]], "Output",
 CellChangeTimes->{
  3.612368517136972*^9, {3.612368564084036*^9, 3.6123685934294553`*^9}}]
}, Open  ]],

Cell[BoxData[{
 RowBox[{
  RowBox[{"aa", "=", "2500."}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"bb", "=", "0.05"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"vars", "=", 
   RowBox[{"Array", "[", 
    RowBox[{"x", ",", "20"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"{", 
    RowBox[{"sol", ",", 
     RowBox[{"{", "points", "}"}]}], "}"}], "=", 
   RowBox[{"Reap", "[", 
    RowBox[{"NMinimize", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"Hold", "[", 
         RowBox[{"t", "=", 
          RowBox[{"g", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{
              RowBox[{"x", "[", "1", "]"}], ",", 
              RowBox[{"x", "[", "2", "]"}], ",", 
              RowBox[{"x", "[", "3", "]"}], ",", 
              RowBox[{"x", "[", "4", "]"}], ",", 
              RowBox[{"x", "[", "5", "]"}], ",", 
              RowBox[{"x", "[", "6", "]"}], ",", 
              RowBox[{"x", "[", "7", "]"}], ",", 
              RowBox[{"x", "[", "8", "]"}], ",", 
              RowBox[{"x", "[", "9", "]"}], ",", 
              RowBox[{"x", "[", "10", "]"}], ",", 
              RowBox[{"x", "[", "11", "]"}], ",", 
              RowBox[{"x", "[", "12", "]"}], ",", 
              RowBox[{"x", "[", "13", "]"}], ",", 
              RowBox[{"x", "[", "14", "]"}], ",", 
              RowBox[{"x", "[", "15", "]"}], ",", 
              RowBox[{"x", "[", "16", "]"}], ",", 
              RowBox[{"x", "[", "17", "]"}], ",", 
              RowBox[{"x", "[", "18", "]"}], ",", 
              RowBox[{"x", "[", "19", "]"}], ",", 
              RowBox[{"x", "[", "20", "]"}]}], "}"}], ",", "aa", ",", "bb"}], 
           "]"}]}], "]"}], ",", 
        RowBox[{
         RowBox[{"And", "@@", 
          RowBox[{"Thread", "@", 
           RowBox[{"LessEqual", "[", 
            RowBox[{"3", ",", "vars", ",", "25"}], "]"}]}]}], "&&", 
         RowBox[{"vars", "\[Element]", "Integers"}]}]}], "}"}], ",", "vars", 
      ",", 
      RowBox[{"Method", "\[Rule]", 
       RowBox[{"{", 
        RowBox[{"\"\<SimulatedAnnealing\>\"", ",", 
         RowBox[{"\"\<PerturbationScale\>\"", "\[Rule]", "2"}], ",", 
         RowBox[{"\"\<SearchPoints\>\"", "\[Rule]", "100000"}]}], "}"}]}], 
      ",", 
      RowBox[{"EvaluationMonitor", "\[RuleDelayed]", 
       RowBox[{"Sow", "[", 
        RowBox[{"{", 
         RowBox[{"Join", "[", 
          RowBox[{"vars", ",", 
           RowBox[{"{", "t", "}"}]}], "]"}], "}"}], "]"}]}]}], "]"}], "]"}]}],
   ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Export", "[", 
    RowBox[{
     RowBox[{"root", "<>", "\"\<TI\>\"", "<>", "\"\<_\>\"", "<>", 
      RowBox[{"ToString", "[", "aa", "]"}], "<>", "\"\<_\>\"", "<>", 
      RowBox[{"ToString", "[", "bb", "]"}], "<>", "\"\<.xls\>\""}], ",", 
     RowBox[{"DeleteDuplicates", "[", "points", "]"}]}], "]"}], ";"}], 
  "\[IndentingNewLine]", "\[IndentingNewLine]"}], "\n"}], "Input",
 CellChangeTimes->{{3.612151395967471*^9, 3.6121513959754753`*^9}, {
   3.6121514396665497`*^9, 3.6121514747929244`*^9}, {3.612151531150429*^9, 
   3.6121515939556665`*^9}, {3.6121516487060995`*^9, 
   3.6121517303635283`*^9}, {3.6121519920366282`*^9, 3.612151993723751*^9}, {
   3.6121520489474993`*^9, 3.612152097919014*^9}, {3.6121522070226145`*^9, 
   3.6121522209638968`*^9}, {3.6121522633561*^9, 3.6121523005760384`*^9}, {
   3.6121525334704337`*^9, 3.6121525677792835`*^9}, {3.6121526284435406`*^9, 
   3.612152631594634*^9}, {3.612152678283947*^9, 3.6121526820834775`*^9}, {
   3.612152742270525*^9, 3.6121528674848475`*^9}, {3.6121533066852036`*^9, 
   3.6121533703315554`*^9}, {3.612154093949224*^9, 3.612154109387463*^9}, {
   3.6121541717185793`*^9, 3.6121541741249466`*^9}, {3.612177977327383*^9, 
   3.6121780093005943`*^9}, {3.6121780904714456`*^9, 3.612178098123522*^9}, 
   3.612178793628908*^9, {3.61217933051195*^9, 3.6121793320899963`*^9}, {
   3.6121910514183965`*^9, 3.6121910568119745`*^9}, {3.612191815963853*^9, 
   3.6121919125819426`*^9}, {3.6121919848698983`*^9, 
   3.6121919868542175`*^9}, {3.6121927306586456`*^9, 
   3.6121927322462025`*^9}, {3.612192782470521*^9, 3.6121928081205378`*^9}, {
   3.6121930944373407`*^9, 3.612193094527402*^9}, {3.612193197076432*^9, 
   3.612193238709051*^9}, {3.612707010734894*^9, 3.612707035650462*^9}}]
},
WindowSize->{1350, 631},
WindowMargins->{{0, Automatic}, {Automatic, 0}},
FrontEndVersion->"9.0 for Microsoft Windows (64-bit) (January 25, 2013)",
StyleDefinitions->"Default.nb"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[CellGroupData[{
Cell[579, 22, 746, 19, 92, "Input"],
Cell[1328, 43, 457, 8, 31, "Output"],
Cell[1788, 53, 164, 2, 31, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[1989, 60, 12012, 305, 512, "Input"],
Cell[14004, 367, 497, 8, 31, "Output"],
Cell[14504, 377, 493, 8, 31, "Output"],
Cell[15000, 387, 496, 8, 31, "Output"],
Cell[15499, 397, 473, 8, 31, "Output"],
Cell[15975, 407, 475, 8, 31, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[16487, 420, 5629, 133, 192, "Input"],
Cell[22119, 555, 480, 10, 21, "Message"],
Cell[22602, 567, 492, 8, 31, "Output"],
Cell[23097, 577, 496, 8, 31, "Output"],
Cell[23596, 587, 492, 8, 31, "Output"]
}, Open  ]],
Cell[24103, 598, 1630, 32, 31, "Input"],
Cell[25736, 632, 5289, 131, 212, "Input"],
Cell[CellGroupData[{
Cell[31050, 767, 2199, 49, 152, "Input"],
Cell[33252, 818, 787, 16, 31, "Output"],
Cell[34042, 836, 677, 13, 31, "Output"],
Cell[34722, 851, 790, 14, 21, "Message"],
Cell[35515, 867, 626, 11, 21, "Message"],
Cell[36144, 880, 700, 13, 31, "Output"],
Cell[36847, 895, 790, 14, 21, "Message"],
Cell[37640, 911, 628, 11, 21, "Message"],
Cell[38271, 924, 698, 13, 31, "Output"]
}, Open  ]],
Cell[38984, 940, 1403, 38, 132, "Input"],
Cell[CellGroupData[{
Cell[40412, 982, 1458, 40, 92, "Input"],
Cell[41873, 1024, 141, 2, 31, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[42051, 1031, 2891, 59, 132, "Input"],
Cell[44945, 1092, 630, 10, 52, "Output"],
Cell[45578, 1104, 637, 11, 52, "Output"],
Cell[46218, 1117, 1283, 27, 92, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[47538, 1149, 3983, 93, 232, "Input"],
Cell[51524, 1244, 412, 8, 52, "Output"],
Cell[51939, 1254, 409, 7, 52, "Output"],
Cell[52351, 1263, 728, 9, 572, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[53116, 1277, 5551, 133, 332, "Input"],
Cell[58670, 1412, 547, 11, 52, "Output"],
Cell[59220, 1425, 536, 10, 52, "Output"],
Cell[59759, 1437, 313, 7, 31, "Output"],
Cell[60075, 1446, 534, 10, 39, "Message"],
Cell[60612, 1458, 541, 11, 21, "Message"],
Cell[61156, 1471, 452, 11, 31, "Output"]
}, Open  ]],
Cell[61623, 1485, 1410, 34, 52, "Input"],
Cell[63036, 1521, 1480, 39, 72, "Input"],
Cell[64519, 1562, 461, 10, 31, "Input"],
Cell[CellGroupData[{
Cell[65005, 1576, 28756, 633, 1492, "Input"],
Cell[93764, 2211, 1772, 24, 1032, "Output"]
}, Open  ]],
Cell[95551, 2238, 4916, 137, 292, "Input"],
Cell[100470, 2377, 28964, 611, 652, "Input"],
Cell[129437, 2990, 270, 8, 31, "Input"],
Cell[CellGroupData[{
Cell[129732, 3002, 389, 10, 31, "Input"],
Cell[130124, 3014, 212, 5, 31, "Output"]
}, Open  ]],
Cell[130351, 3022, 4343, 93, 392, "Input"]
}
]
*)

(* End of internal cache information *)
