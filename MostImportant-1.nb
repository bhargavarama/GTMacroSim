(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 9.0' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       157,          7]
NotebookDataLength[     71616,       1665]
NotebookOptionsPosition[     70334,       1623]
NotebookOutlinePosition[     70677,       1638]
CellTagsIndexPosition[     70634,       1635]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{
Cell[BoxData[{
 RowBox[{
  RowBox[{"root", " ", "=", " ", "\"\<c:/data/TimeInvariant/\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Kj", "=", "150."}], ";", 
  RowBox[{"w", "=", "20."}], ";", 
  RowBox[{"Vf", "=", "100."}], ";", 
  RowBox[{"cap", "=", "2500."}], ";", 
  RowBox[{"L", "=", "1."}], ";", 
  RowBox[{"b", "=", "0.1"}], ";", 
  RowBox[{"dx", "=", 
   RowBox[{"1.", "/", "9"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"demF", "=", 
   RowBox[{"Compile", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"p1", ",", "_Real", ",", "0"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"p2", ",", "_Real", ",", "0"}], "}"}]}], "}"}], ",", 
     RowBox[{"Max", "[", 
      RowBox[{"0", ",", 
       RowBox[{
        RowBox[{"Min", "[", 
         RowBox[{
          RowBox[{"p1", " ", "Vf"}], ",", 
          RowBox[{"L", " ", "cap"}]}], "]"}], "-", "p2"}]}], "]"}], ",", 
     RowBox[{"Parallelization", "\[Rule]", "True"}], ",", 
     RowBox[{"RuntimeAttributes", "\[Rule]", 
      RowBox[{"{", "Listable", "}"}]}], ",", 
     RowBox[{"CompilationOptions", "\[Rule]", 
      RowBox[{"{", 
       RowBox[{"\"\<InlineExternalDefinitions\>\"", "\[Rule]", "True"}], 
       "}"}]}]}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"demR", "=", 
   RowBox[{"Compile", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"{", 
       RowBox[{"p1", ",", "_Real", ",", "0"}], "}"}], "}"}], ",", 
     RowBox[{"Min", "[", 
      RowBox[{
       RowBox[{"p1", " ", "Vf"}], ",", "cap"}], "]"}], ",", 
     RowBox[{"Parallelization", "\[Rule]", "True"}], ",", 
     RowBox[{"RuntimeAttributes", "\[Rule]", 
      RowBox[{"{", "Listable", "}"}]}], ",", 
     RowBox[{"CompilationOptions", "\[Rule]", 
      RowBox[{"{", 
       RowBox[{"\"\<InlineExternalDefinitions\>\"", "\[Rule]", "True"}], 
       "}"}]}]}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"supF", "=", 
   RowBox[{"Compile", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"{", 
       RowBox[{"p1", ",", "_Real", ",", "0"}], "}"}], "}"}], ",", 
     RowBox[{"Min", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"(", 
         RowBox[{
          RowBox[{"L", " ", "Kj"}], "-", "p1"}], ")"}], " ", "w"}], ",", 
       RowBox[{"L", " ", "cap"}]}], "]"}], ",", 
     RowBox[{"Parallelization", "\[Rule]", "True"}], ",", 
     RowBox[{"RuntimeAttributes", "\[Rule]", 
      RowBox[{"{", "Listable", "}"}]}], ",", 
     RowBox[{"CompilationOptions", "\[Rule]", 
      RowBox[{"{", 
       RowBox[{"\"\<InlineExternalDefinitions\>\"", "\[Rule]", "True"}], 
       "}"}]}]}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"NsupF", "=", 
   RowBox[{"Compile", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"p1", ",", "_Real", ",", "0"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"p2", ",", "_Real", ",", "0"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"p3", ",", "_Real", ",", "0"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"p4", ",", "_Real", ",", "0"}], "}"}]}], "}"}], ",", 
     RowBox[{"Max", "[", 
      RowBox[{"0", ",", 
       RowBox[{
        RowBox[{"Min", "[", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"(", 
             RowBox[{
              RowBox[{"L", " ", "Kj"}], "-", "p1"}], ")"}], " ", "Vf"}], "-", 
           "p2", "-", "p3"}], ",", 
          RowBox[{"L", " ", "cap"}]}], "]"}], "-", "p4"}]}], "]"}], ",", 
     RowBox[{"Parallelization", "\[Rule]", "True"}], ",", 
     RowBox[{"RuntimeAttributes", "\[Rule]", 
      RowBox[{"{", "Listable", "}"}]}], ",", 
     RowBox[{"CompilationOptions", "\[Rule]", 
      RowBox[{"{", 
       RowBox[{"\"\<InlineExternalDefinitions\>\"", "\[Rule]", "True"}], 
       "}"}]}]}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"NsupR", "=", 
   RowBox[{"Compile", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"p1", ",", "_Real", ",", "0"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"p2", ",", "_Real", ",", "0"}], "}"}]}], "}"}], ",", 
     RowBox[{"Min", "[", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"Kj", "-", "p1"}], ")"}], " ", "Vf"}], "-", "p2"}], ",", 
       "cap"}], "]"}], ",", 
     RowBox[{"Parallelization", "\[Rule]", "True"}], ",", 
     RowBox[{"RuntimeAttributes", "\[Rule]", 
      RowBox[{"{", "Listable", "}"}]}], ",", 
     RowBox[{"CompilationOptions", "\[Rule]", 
      RowBox[{"{", 
       RowBox[{"\"\<InlineExternalDefinitions\>\"", "\[Rule]", "True"}], 
       "}"}]}]}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"floF", "=", 
   RowBox[{"Compile", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"p1", ",", "_Real", ",", "0"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"p2", ",", "_Real", ",", "0"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"p3", ",", "_Real", ",", "0"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"p4", ",", "_Real", ",", "0"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"p5", ",", "_Real", ",", "0"}], "}"}]}], "}"}], ",", 
     RowBox[{"Min", "[", 
      RowBox[{
       RowBox[{"demF", "[", 
        RowBox[{"p1", ",", "p5"}], "]"}], ",", 
       RowBox[{"NsupF", "[", 
        RowBox[{"p2", ",", "p3", ",", "p4", ",", "p5"}], "]"}]}], "]"}], ",", 
     RowBox[{"Parallelization", "\[Rule]", "True"}], ",", 
     RowBox[{"RuntimeAttributes", "\[Rule]", 
      RowBox[{"{", "Listable", "}"}]}], ",", 
     RowBox[{"CompilationOptions", "\[Rule]", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"\"\<InlineExternalDefinitions\>\"", "\[Rule]", "True"}], ",", 
        RowBox[{"\"\<InlineCompiledFunctions\>\"", "\[Rule]", "True"}]}], 
       "}"}]}]}], "]"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{"floR", "=", 
   RowBox[{"Compile", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"p1", ",", "_Real", ",", "0"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"p2", ",", "_Real", ",", "0"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"p3", ",", "_Real", ",", "0"}], "}"}]}], "}"}], ",", 
     RowBox[{"Min", "[", 
      RowBox[{
       RowBox[{"demR", "[", "p1", "]"}], ",", 
       RowBox[{"NsupR", "[", 
        RowBox[{"p2", ",", "p3"}], "]"}]}], "]"}], ",", 
     RowBox[{"Parallelization", "\[Rule]", "True"}], ",", 
     RowBox[{"RuntimeAttributes", "\[Rule]", 
      RowBox[{"{", "Listable", "}"}]}], ",", 
     RowBox[{"CompilationOptions", "\[Rule]", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"\"\<InlineExternalDefinitions\>\"", "\[Rule]", "True"}], ",", 
        RowBox[{"\"\<InlineCompiledFunctions\>\"", "\[Rule]", "True"}]}], 
       "}"}]}]}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"gamma", "=", 
   RowBox[{"Compile", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"p1", ",", "_Real", ",", "0"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"p2", ",", "_Real", ",", "0"}], "}"}]}], "}"}], ",", 
     RowBox[{"Min", "[", 
      RowBox[{"1", ",", 
       RowBox[{
        RowBox[{"supF", "[", "p2", "]"}], "/", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"demF", "[", 
           RowBox[{"p1", ",", "0"}], "]"}], "+", "0.001"}], ")"}]}]}], "]"}], 
     ",", 
     RowBox[{"Parallelization", "\[Rule]", "True"}], ",", 
     RowBox[{"RuntimeAttributes", "\[Rule]", 
      RowBox[{"{", "Listable", "}"}]}], ",", 
     RowBox[{"CompilationOptions", "\[Rule]", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"\"\<InlineExternalDefinitions\>\"", "\[Rule]", "True"}], ",", 
        RowBox[{"\"\<InlineCompiledFunctions\>\"", "\[Rule]", "True"}]}], 
       "}"}]}]}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"den", "=", 
   RowBox[{"Compile", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"p1", ",", "_Real", ",", "0"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"p2", ",", "_Real", ",", "0"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"p3", ",", "_Real", ",", "0"}], "}"}]}], "}"}], ",", 
     RowBox[{
      RowBox[{"(", 
       RowBox[{"p1", "-", "p2", "+", "p3"}], ")"}], "/", "Vf"}], ",", 
     RowBox[{"Parallelization", "\[Rule]", "True"}], ",", 
     RowBox[{"RuntimeAttributes", "\[Rule]", 
      RowBox[{"{", "Listable", "}"}]}], ",", 
     RowBox[{"CompilationOptions", "\[Rule]", 
      RowBox[{"{", 
       RowBox[{"\"\<InlineExternalDefinitions\>\"", "\[Rule]", "True"}], 
       "}"}]}]}], "]"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{"inflow", "=", 
   RowBox[{"Compile", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"p1", ",", "_Real", ",", "0"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"p2", ",", "_Real", ",", "0"}], "}"}]}], "}"}], ",", 
     RowBox[{
      RowBox[{"(", 
       RowBox[{"p1", "-", 
        RowBox[{"b", " ", "p2"}]}], ")"}], " ", "dx"}], ",", 
     RowBox[{"Parallelization", "\[Rule]", "True"}], ",", 
     RowBox[{"RuntimeAttributes", "\[Rule]", 
      RowBox[{"{", "Listable", "}"}]}], ",", 
     RowBox[{"CompilationOptions", "\[Rule]", 
      RowBox[{"{", 
       RowBox[{"\"\<InlineExternalDefinitions\>\"", "\[Rule]", "True"}], 
       "}"}]}]}], "]"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{"updateF", "=", 
   RowBox[{"Compile", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"p1", ",", "_Real", ",", "0"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"p2", ",", "_Real", ",", "0"}], "}"}]}], "}"}], ",", 
     RowBox[{"Max", "[", 
      RowBox[{
       RowBox[{"L", " ", "Kj"}], ",", 
       RowBox[{"p1", "+", "p2"}]}], "]"}], ",", 
     RowBox[{"Parallelization", "\[Rule]", "True"}], ",", 
     RowBox[{"RuntimeAttributes", "\[Rule]", 
      RowBox[{"{", "Listable", "}"}]}], ",", 
     RowBox[{"CompilationOptions", "\[Rule]", 
      RowBox[{"{", 
       RowBox[{"\"\<InlineExternalDefinitions\>\"", "\[Rule]", "True"}], 
       "}"}]}]}], "]"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"updateR", "=", 
    RowBox[{"Compile", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"p1", ",", "_Real", ",", "0"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"p2", ",", "_Real", ",", "0"}], "}"}]}], "}"}], ",", 
      RowBox[{"p1", "+", "p2"}], ",", 
      RowBox[{"Parallelization", "\[Rule]", "True"}], ",", 
      RowBox[{"RuntimeAttributes", "\[Rule]", 
       RowBox[{"{", "Listable", "}"}]}]}], "]"}]}], ";"}], "\n", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"flowR", "=", 
     RowBox[{"Compile", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"{", 
         RowBox[{"p", ",", "_Real", ",", "1"}], "}"}], "}"}], ",", 
       RowBox[{"Join", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"p", "[", 
           RowBox[{"[", "1", "]"}], "]"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"p", "[", 
           RowBox[{"[", "2", "]"}], "]"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"p", "[", 
           RowBox[{"[", "3", "]"}], "]"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"p", "[", 
           RowBox[{"[", "4", "]"}], "]"}], "}"}]}], "]"}], ",", 
       RowBox[{"Parallelization", "\[Rule]", "True"}], ",", 
       RowBox[{"RuntimeAttributes", "\[Rule]", 
        RowBox[{"{", "Listable", "}"}]}]}], "]"}]}], ";"}], "*)"}], 
  RowBox[{"(*", 
   RowBox[{"CompilePrint", "[", "flowR", "]"}], "*)"}]}], "\n", 
 RowBox[{
  RowBox[{"compiledMin", "=", 
   RowBox[{"Compile", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"p1", ",", "_Real", ",", "0"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"p2", ",", "_Real", ",", "0"}], "}"}]}], "}"}], ",", 
     RowBox[{"Min", "[", 
      RowBox[{"p1", ",", "p2"}], "]"}], ",", 
     RowBox[{"Parallelization", "\[Rule]", "True"}], ",", 
     RowBox[{"RuntimeAttributes", "\[Rule]", 
      RowBox[{"{", "Listable", "}"}]}]}], "]"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.612023226274868*^9, 3.612023308894287*^9}, {
   3.6120289429476037`*^9, 3.6120289539439216`*^9}, {3.612101981630884*^9, 
   3.612101985198258*^9}, {3.6121025294596176`*^9, 3.6121025323335314`*^9}, {
   3.612102691318324*^9, 3.612102757763501*^9}, {3.612102791329834*^9, 
   3.6121027983044767`*^9}, {3.6121028404124985`*^9, 3.61210286945282*^9}, {
   3.612102932444417*^9, 3.6121029930439796`*^9}, {3.6121034045060186`*^9, 
   3.6121034051274333`*^9}, 3.6121034432928295`*^9, {3.6121040749284916`*^9, 
   3.612104081288724*^9}, {3.6121042874909377`*^9, 3.6121043152434034`*^9}, 
   3.612104348956001*^9, {3.6121044008935633`*^9, 3.6121044106970897`*^9}, {
   3.6121045975849314`*^9, 3.612104628338397*^9}, {3.612104758575061*^9, 
   3.6121047834015822`*^9}, 3.612105008574419*^9, {3.612107413218937*^9, 
   3.6121074173316717`*^9}, {3.612117740528376*^9, 3.612117764633855*^9}, {
   3.61211795143198*^9, 3.612117963809216*^9}, {3.6121352013952565`*^9, 
   3.61213524918606*^9}, {3.6121352912550526`*^9, 3.6121353157598896`*^9}, 
   3.612135382307171*^9, {3.6121354410803804`*^9, 3.612135445719468*^9}, 
   3.6121359386107426`*^9, {3.6121362237563663`*^9, 3.6121362344324684`*^9}, {
   3.612136283289982*^9, 3.6121362842276077`*^9}, 3.6121363797928495`*^9, {
   3.6121364357718835`*^9, 3.612136441037386*^9}, {3.612136481830531*^9, 
   3.6121365009402485`*^9}, {3.612136621901739*^9, 3.6121366224491034`*^9}, 
   3.6121366821956425`*^9, 3.6121367935613904`*^9, 3.6121374551211495`*^9, {
   3.6121377361291466`*^9, 3.6121377566678143`*^9}, 3.6121378273888736`*^9, {
   3.612137890026557*^9, 3.6121378995458922`*^9}, {3.612138006934985*^9, 
   3.612138013689479*^9}, {3.6121380689132285`*^9, 3.612138072642709*^9}, {
   3.6121381029598846`*^9, 3.612138138015211*^9}, {3.6121381791966143`*^9, 
   3.6121382000524926`*^9}, 3.612138621872572*^9, 3.612139285687533*^9, {
   3.612139829954717*^9, 3.6121398306922083`*^9}, {3.6121400019191484`*^9, 
   3.612140002896799*^9}, {3.6121403567162437`*^9, 3.6121403589967613`*^9}, {
   3.6121409501006794`*^9, 3.612140971555807*^9}, {3.612141154598349*^9, 
   3.612141157954582*^9}, {3.6121427848922844`*^9, 3.612142815617729*^9}, {
   3.612142852346074*^9, 3.6121428531345987`*^9}, {3.6121429346179204`*^9, 
   3.6121430217879267`*^9}, {3.6121434206455793`*^9, 
   3.6121435428314466`*^9}, {3.61214378929737*^9, 3.612143844818313*^9}, {
   3.6121438912922425`*^9, 3.6121439017041674`*^9}, {3.6121439588341837`*^9, 
   3.6121439631550584`*^9}, {3.6121440113821526`*^9, 3.612144035573745*^9}, {
   3.612144121678812*^9, 3.61214414550871*^9}, {3.6121442110293083`*^9, 
   3.612144211846854*^9}, {3.6121442642887526`*^9, 3.6121442651493225`*^9}, {
   3.6121445699298344`*^9, 3.6121446122790127`*^9}, {3.61214470073869*^9, 
   3.612144707414133*^9}, {3.612147894199198*^9, 3.6121479539549613`*^9}, {
   3.612147994780312*^9, 3.612148002762624*^9}, {3.612148050310264*^9, 
   3.6121480513889823`*^9}, {3.612148109704789*^9, 3.6121481107864113`*^9}, {
   3.612152927999116*^9, 3.6121530898108883`*^9}, {3.6121531215540104`*^9, 
   3.6121531583254795`*^9}, 3.6121532031142845`*^9, {3.612153380795519*^9, 
   3.6121533898235292`*^9}, 3.61215343493047*^9, {3.6121551494603176`*^9, 
   3.6121551910248127`*^9}, {3.6121552247764397`*^9, 3.612155254746627*^9}, {
   3.6121555589018607`*^9, 3.6121555661990824`*^9}, {3.612155604857193*^9, 
   3.612155640608906*^9}, {3.612155673110471*^9, 3.612155677313798*^9}, {
   3.612155762218522*^9, 3.612155827924796*^9}, 3.612156201793826*^9, {
   3.612156623817785*^9, 3.6121566491335793`*^9}, {3.6121567718212786`*^9, 
   3.612156798325864*^9}, {3.612167700162096*^9, 3.6121677150189514`*^9}, 
   3.6121681342340517`*^9, 3.612170087589526*^9, {3.612170118192828*^9, 
   3.6121701227888784`*^9}, {3.612170202886012*^9, 3.612170217228527*^9}, {
   3.612170296098846*^9, 3.612170299469082*^9}, {3.612174859074157*^9, 
   3.612174868442374*^9}, {3.612174905478945*^9, 3.6121749141927223`*^9}, {
   3.6121750252794156`*^9, 3.612175049639578*^9}, {3.612175150496484*^9, 
   3.612175173207551*^9}, {3.6121752118951516`*^9, 3.612175223370763*^9}, {
   3.612175448705247*^9, 3.6121754490604815`*^9}, {3.612175480498337*^9, 
   3.6121757635180874`*^9}, {3.612175798662401*^9, 3.612175844638901*^9}, {
   3.6121758778239155`*^9, 3.61217602008529*^9}, {3.6121760528420196`*^9, 
   3.61217606138969*^9}, 3.6121771021585574`*^9, {3.612177193988475*^9, 
   3.612177221599792*^9}, {3.6121772758577876`*^9, 3.6121773079150524`*^9}, {
   3.6121773463505497`*^9, 3.6121773723628087`*^9}, {3.612177508486109*^9, 
   3.6121775182886114`*^9}, {3.6121777079724445`*^9, 
   3.6121777098366814`*^9}, {3.61217780819393*^9, 3.612177814319993*^9}, {
   3.6121778619678545`*^9, 3.61217788217126*^9}, {3.612177951333141*^9, 
   3.6121779608964834`*^9}, 3.612178139420913*^9, {3.6121865737842283`*^9, 
   3.612186577882946*^9}, 3.6121866430231586`*^9, 3.612186820490893*^9, {
   3.6121869451756015`*^9, 3.6121869494764566`*^9}, {3.6121920487112513`*^9, 
   3.6121921851107354`*^9}, {3.6121923389197707`*^9, 3.612192410475238*^9}, {
   3.6121932949433537`*^9, 3.6121933043555984`*^9}, {3.613145258627679*^9, 
   3.6131452651820555`*^9}, 3.613146451343665*^9, {3.6131464911512527`*^9, 
   3.613146516216993*^9}, {3.613146731736936*^9, 3.613146847413198*^9}, {
   3.613146890561015*^9, 3.613146973561451*^9}, {3.6131472630762844`*^9, 
   3.613147305986948*^9}, {3.613147357534374*^9, 3.613147369661475*^9}, {
   3.613147414858659*^9, 3.613147496568232*^9}, {3.6131484150791817`*^9, 
   3.613148445930789*^9}, {3.6131494482339144`*^9, 3.6131495861350193`*^9}, {
   3.6131496255013103`*^9, 3.6131496511274304`*^9}, 3.613149993584152*^9, 
   3.6131500598748837`*^9, 3.6131501808636923`*^9, {3.6131502438747816`*^9, 
   3.613150251775058*^9}, {3.613150297673713*^9, 3.6131502991647053`*^9}, {
   3.613150346839552*^9, 3.6131504004687157`*^9}, {3.6131504313623486`*^9, 
   3.6131504314223986`*^9}, {3.6131504788900948`*^9, 3.613150498697141*^9}, {
   3.613151008580276*^9, 3.6131510658785458`*^9}, {3.613152051202121*^9, 
   3.613152079791216*^9}, {3.6131521286228323`*^9, 3.6131521486121836`*^9}, {
   3.613152192873742*^9, 3.6131522379038167`*^9}, {3.613152269873169*^9, 
   3.6131523256063943`*^9}, {3.61315241262111*^9, 3.6131524501031456`*^9}, {
   3.6131529879080944`*^9, 3.6131530084007792`*^9}, {3.6131530787757826`*^9, 
   3.6131531052364006`*^9}, {3.613153173983316*^9, 3.613153198144453*^9}, 
   3.613153249675871*^9, {3.6131533091871786`*^9, 3.6131533240070753`*^9}, {
   3.6131533540361333`*^9, 3.6131534326856627`*^9}, {3.613153636490615*^9, 
   3.613153648579687*^9}, {3.6131692502722907`*^9, 3.61316925126896*^9}, 
   3.613169302896442*^9, {3.613169342831111*^9, 3.613169349593627*^9}, {
   3.6131726111332846`*^9, 3.613172632892819*^9}, {3.613177713513173*^9, 
   3.6131777157706814`*^9}, {3.613178217242371*^9, 3.613178221337104*^9}, {
   3.613203069935812*^9, 3.6132031010025606`*^9}}],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{
  RowBox[{"n", "=", "10"}], ";", 
  RowBox[{"p", "=", "5"}], ";", 
  RowBox[{"RML", "=", "3"}], ";", 
  RowBox[{"delta", "=", "1."}], ";", 
  RowBox[{"dt", "=", 
   RowBox[{"4.", "/", "3600."}]}], ";", 
  RowBox[{"Ssteps", "=", "10."}], ";", 
  RowBox[{"a", "=", "10"}], ";", 
  RowBox[{"Shutoff", "=", "False"}], ";", 
  RowBox[{"j", "=", "1."}], ";", 
  RowBox[{"Tsteps", "=", 
   RowBox[{
    RowBox[{"Length", "[", "aa", "]"}], "/", "Ssteps"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Print", "[", "\"\<k0:\>\"", "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"k0", "=", 
   RowBox[{"Table", "[", 
    RowBox[{
     RowBox[{"RandomReal", "[", "50", "]"}], ",", 
     RowBox[{"{", "n", "}"}]}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Print", "[", "\"\<Fk:\>\"", "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Fk", "=", 
   RowBox[{"Table", "[", 
    RowBox[{
     RowBox[{"RandomReal", "[", "10", "]"}], ",", 
     RowBox[{"{", "5", "}"}], ",", 
     RowBox[{"{", "n", "}"}]}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Print", "[", "\"\<kr:\>\"", "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"kr", "=", 
   RowBox[{"Table", "[", 
    RowBox[{
     RowBox[{"RandomReal", "[", "10", "]"}], ",", 
     RowBox[{"{", 
      RowBox[{"n", "-", "2"}], "}"}], ",", 
     RowBox[{"{", "p", "}"}]}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Print", "[", "\"\<Rk:\>\"", "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Rk", "=", 
   RowBox[{"Table", "[", 
    RowBox[{
     RowBox[{"RandomReal", "[", "10", "]"}], ",", 
     RowBox[{"{", "4", "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"n", "-", "2"}], "}"}], ",", 
     RowBox[{"{", "p", "}"}]}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Print", "[", "\"\<Fq:\>\"", "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Fq", "=", 
   RowBox[{"Table", "[", 
    RowBox[{
     RowBox[{"RandomReal", "[", "10", "]"}], ",", 
     RowBox[{"{", "4", "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"n", "-", "1"}], "}"}]}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Print", "[", "\"\<Fin:\>\"", "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Fin", "=", 
   RowBox[{"Table", "[", 
    RowBox[{
     RowBox[{"RandomReal", "[", "10", "]"}], ",", 
     RowBox[{"{", "4", "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"n", "-", "2"}], "}"}]}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Print", "[", "\"\<Rq:\>\"", "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Rq", "=", 
   RowBox[{"Table", "[", 
    RowBox[{
     RowBox[{"RandomReal", "[", "10", "]"}], ",", 
     RowBox[{"{", "4", "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"n", "-", "2"}], "}"}], ",", 
     RowBox[{"{", "p", "}"}]}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"aa", "=", 
   RowBox[{"Table", "[", 
    RowBox[{
     RowBox[{"10", " ", "i"}], ",", 
     RowBox[{"{", 
      RowBox[{"i", ",", "20"}], "}"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"RM", "=", 
   RowBox[{"Table", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"aa", "[", 
       RowBox[{"[", 
        RowBox[{
         RowBox[{
          RowBox[{"(", 
           RowBox[{"j", "-", "1"}], ")"}], "*", "Ssteps"}], "+", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"Floor", "[", 
             RowBox[{"i", " ", "dx"}], "]"}], "<", "1"}], ",", " ", "1", ",", 
           RowBox[{"Ceiling", "[", 
            RowBox[{"i", " ", "dx"}], "]"}]}], "]"}]}], "]"}], "]"}], " ", 
      "100"}], ",", 
     RowBox[{"{", 
      RowBox[{"j", ",", "Tsteps"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"i", ",", "2", ",", 
       RowBox[{"n", "-", "1"}]}], "}"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"RMori", "=", 
   RowBox[{"RM", "[", 
    RowBox[{"[", "1", "]"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"fi", "=", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"demR", "[", 
       RowBox[{"#", "[", 
        RowBox[{"[", 
         RowBox[{"-", "1"}], "]"}], "]"}], "]"}], "&"}], "/@", "kr"}], " ", 
    RowBox[{"gamma", "[", 
     RowBox[{
      RowBox[{"Take", "[", 
       RowBox[{"k0", ",", 
        RowBox[{"{", 
         RowBox[{"2", ",", 
          RowBox[{"-", "2"}]}], "}"}]}], "]"}], ",", 
      RowBox[{"Take", "[", 
       RowBox[{"k0", ",", 
        RowBox[{"{", 
         RowBox[{"3", ",", 
          RowBox[{"-", "1"}]}], "}"}]}], "]"}]}], "]"}]}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Print", "[", "\"\<fi:\>\"", "]"}], ";", 
  "fi"}], "\[IndentingNewLine]", 
 RowBox[{"Most", "@", "k0"}], "\[IndentingNewLine]", 
 RowBox[{"Rest", "@", 
  RowBox[{"(", 
   RowBox[{"Fk", "[", 
    RowBox[{"[", "1", "]"}], "]"}], ")"}]}], "\[IndentingNewLine]", 
 RowBox[{"Total", "@", "Fq"}], "\[IndentingNewLine]", 
 RowBox[{"Join", "[", 
  RowBox[{
   RowBox[{"Total", "@", "Fin"}], ",", 
   RowBox[{"{", "0.", "}"}]}], "]"}], "\[IndentingNewLine]", 
 RowBox[{"Join", "[", 
  RowBox[{
   RowBox[{"fi", " ", "dx"}], ",", 
   RowBox[{"{", "0.", "}"}]}], "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Print", "[", "\"\<dem:\>\"", "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{"demF", "[", 
  RowBox[{
   RowBox[{"Most", "@", "k0"}], ",", 
   RowBox[{"Join", "[", 
    RowBox[{
     RowBox[{"fi", " ", "dx"}], ",", 
     RowBox[{"{", "0.", "}"}]}], "]"}]}], "]"}], "\[IndentingNewLine]", 
 RowBox[{"NsupF", "[", 
  RowBox[{
   RowBox[{"Rest", "@", 
    RowBox[{"(", 
     RowBox[{"Fk", "[", 
      RowBox[{"[", "1", "]"}], "]"}], ")"}]}], ",", 
   RowBox[{"Total", "@", "Fq"}], ",", 
   RowBox[{"Join", "[", 
    RowBox[{
     RowBox[{"Total", "@", "Fin"}], ",", 
     RowBox[{"{", "0.", "}"}]}], "]"}], ",", 
   RowBox[{"Join", "[", 
    RowBox[{
     RowBox[{"fi", " ", "dx"}], ",", 
     RowBox[{"{", "0.", "}"}]}], "]"}]}], "]"}], "\[IndentingNewLine]", 
 RowBox[{"floF", "[", 
  RowBox[{
   RowBox[{"Most", "@", "k0"}], ",", 
   RowBox[{"Rest", "@", 
    RowBox[{"(", 
     RowBox[{"Fk", "[", 
      RowBox[{"[", "1", "]"}], "]"}], ")"}]}], ",", 
   RowBox[{"Total", "@", "Fq"}], ",", 
   RowBox[{"Join", "[", 
    RowBox[{
     RowBox[{"Total", "@", "Fin"}], ",", 
     RowBox[{"{", "0.", "}"}]}], "]"}], ",", 
   RowBox[{"Join", "[", 
    RowBox[{
     RowBox[{"fi", " ", "dx"}], ",", 
     RowBox[{"{", "0.", "}"}]}], "]"}]}], "]"}]}], "Input",
 CellChangeTimes->{
  3.613174105465031*^9, {3.6131741355311117`*^9, 3.6131741752606506`*^9}, {
   3.613174276112007*^9, 3.6131746442258725`*^9}, {3.6131762004921412`*^9, 
   3.6131762453669515`*^9}, {3.613176305082836*^9, 3.613176312600857*^9}, {
   3.613176381970187*^9, 3.6131763868914757`*^9}, {3.61317644401763*^9, 
   3.6131765377682414`*^9}, {3.613201835331476*^9, 3.6132018785853643`*^9}, {
   3.613201938984701*^9, 3.6132019734427166`*^9}, {3.6132020523254013`*^9, 
   3.613202139405566*^9}, {3.613202210165827*^9, 3.6132022678572793`*^9}, 
   3.6132025922894144`*^9, 3.6132026423568535`*^9, 3.6132027391731696`*^9, 
   3.613202794180914*^9, {3.613203208785549*^9, 3.6132032126211147`*^9}, 
   3.6132040387364926`*^9, {3.6132041280151224`*^9, 3.6132041928325515`*^9}, {
   3.6132042253872957`*^9, 3.61320427560384*^9}}],

Cell[BoxData["\<\"k0:\"\>"], "Print",
 CellChangeTimes->{3.613202158125064*^9, 3.6132022743866367`*^9, 
  3.61320322226856*^9, 3.6132040428372335`*^9}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
  "1.4739626150913807`", ",", "14.009616886564231`", ",", 
   "23.757641023336205`", ",", "40.00203481910167`", ",", 
   "2.899046729195206`", ",", "8.268333307077214`", ",", 
   "22.698456391087888`", ",", "33.413180706241846`", ",", 
   "35.986989062969315`", ",", "44.07570308640223`"}], "}"}]], "Output",
 CellChangeTimes->{
  3.613176255945014*^9, 3.613176339807026*^9, 3.6131763915135603`*^9, {
   3.6131765244013176`*^9, 3.613176571205574*^9}, 3.613177725693309*^9, 
   3.6131777878498244`*^9, 3.613178227597287*^9, 3.613202158128066*^9, 
   3.6132022743886375`*^9, 3.6132032222715592`*^9, 3.6132040428392353`*^9}],

Cell[BoxData["\<\"Fk:\"\>"], "Print",
 CellChangeTimes->{3.613202158125064*^9, 3.6132022743866367`*^9, 
  3.61320322226856*^9, 3.613204042841235*^9}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
    "7.824745191081451`", ",", "8.890322480925605`", ",", "5.22092196277028`",
      ",", "1.3167030754990865`", ",", "2.456707185840912`", ",", 
     "7.542039528938325`", ",", "3.413461821138675`", ",", 
     "4.738106883394018`", ",", "6.959991389388605`", ",", 
     "4.500666478545819`"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
    "2.752677460655903`", ",", "5.603893701472053`", ",", "4.59854228605275`",
      ",", "3.5139722478902353`", ",", "0.009581089081596161`", ",", 
     "2.8875527453898204`", ",", "8.170057082552159`", ",", 
     "3.7902612369171678`", ",", "7.457391852459665`", ",", 
     "9.704924823486529`"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
    "2.0287291142568797`", ",", "5.546372224137938`", ",", 
     "0.09489656668453605`", ",", "0.9927393253341261`", ",", 
     "7.177157350846272`", ",", "5.404051836341102`", ",", 
     "6.929578079495052`", ",", "0.7578379206385506`", ",", 
     "5.707983840822763`", ",", "2.336926136966653`"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
    "4.9729571796647285`", ",", "6.534913010773209`", ",", 
     "5.73793032312919`", ",", "0.35042210738282265`", ",", 
     "6.943196016498227`", ",", "0.8799818888459718`", ",", 
     "2.1392498316914104`", ",", "8.798180219947906`", ",", 
     "8.137346798881566`", ",", "3.341885329688248`"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
    "3.601148127509637`", ",", "9.541623819357653`", ",", 
     "3.4257331903524317`", ",", "3.799363621252283`", ",", 
     "8.017637238883154`", ",", "5.518726720496742`", ",", 
     "5.29222953865953`", ",", "1.8231026254833331`", ",", 
     "9.53936976802581`", ",", "8.384967737085624`"}], "}"}]}], 
  "}"}]], "Output",
 CellChangeTimes->{
  3.613176255945014*^9, 3.613176339807026*^9, 3.6131763915135603`*^9, {
   3.6131765244013176`*^9, 3.613176571205574*^9}, 3.613177725693309*^9, 
   3.6131777878498244`*^9, 3.613178227597287*^9, 3.613202158128066*^9, 
   3.6132022743886375`*^9, 3.6132032222715592`*^9, 3.613204042842234*^9}],

Cell[BoxData["\<\"kr:\"\>"], "Print",
 CellChangeTimes->{3.613202158125064*^9, 3.6132022743866367`*^9, 
  3.61320322226856*^9, 3.613204042844237*^9}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
    "3.7861566638160973`", ",", "8.314815042849656`", ",", 
     "7.569255115507158`", ",", "8.73751031140268`", ",", 
     "4.958204209694596`"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
    "1.8960985934151466`", ",", "7.488355727961718`", ",", 
     "6.777473247027519`", ",", "9.591781312040414`", ",", 
     "4.135958424234298`"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
    "9.761818025283674`", ",", "3.148214382649069`", ",", 
     "6.316229987042444`", ",", "4.44617541639353`", ",", 
     "8.450542638296938`"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
    "4.257602892856331`", ",", "0.3090462655529791`", ",", 
     "0.9308528223132218`", ",", "7.111691512313762`", ",", 
     "0.6087967425960255`"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
    "5.464250912151014`", ",", "8.465437916831714`", ",", 
     "3.350073788087098`", ",", "0.8386851123921435`", ",", 
     "8.026242560442082`"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
    "6.477997173896295`", ",", "5.442310220765648`", ",", 
     "1.954717934961021`", ",", "6.164322914028041`", ",", 
     "8.74692210285501`"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
    "1.1653767342868893`", ",", "8.067126958917662`", ",", 
     "4.056932868730442`", ",", "8.215020474206614`", ",", 
     "1.5772756128471261`"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
    "2.2095535754218574`", ",", "0.09463211345491729`", ",", 
     "0.7309414839910673`", ",", "7.069965297644252`", ",", 
     "4.748945696480858`"}], "}"}]}], "}"}]], "Output",
 CellChangeTimes->{
  3.613176255945014*^9, 3.613176339807026*^9, 3.6131763915135603`*^9, {
   3.6131765244013176`*^9, 3.613176571205574*^9}, 3.613177725693309*^9, 
   3.6131777878498244`*^9, 3.613178227597287*^9, 3.613202158128066*^9, 
   3.6132022743886375`*^9, 3.6132032222715592`*^9, 3.613204042845236*^9}],

Cell[CellGroupData[{

Cell[BoxData["\<\"Rk:\"\>"], "Print",
 CellChangeTimes->{3.613202158125064*^9, 3.6132022743866367`*^9, 
  3.61320322226856*^9, 3.6132040428472385`*^9}],

Cell[BoxData["\<\"Fq:\"\>"], "Print",
 CellChangeTimes->{3.613202158125064*^9, 3.6132022743866367`*^9, 
  3.61320322226856*^9, 3.6132040428472385`*^9}]
}, Open  ]],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
    "3.7610900179135847`", ",", "3.24126731802769`", ",", 
     "1.591872569227199`", ",", "0.5882233175970324`", ",", 
     "5.317689022998959`", ",", "1.1576505793393572`", ",", 
     "7.574934550668363`", ",", "2.9636657737017984`", ",", 
     "2.0728250298622193`"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
    "5.782681015806723`", ",", "3.5331664087338037`", ",", 
     "2.798796359526353`", ",", "3.0280633805143697`", ",", 
     "0.28557026076192926`", ",", "4.884272637805875`", ",", 
     "6.103903394293869`", ",", "5.326895624301304`", ",", 
     "4.976945140993701`"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
    "6.937847632339469`", ",", "3.5586179796105135`", ",", 
     "9.986720561809335`", ",", "6.377195704967676`", ",", 
     "1.3484319954191566`", ",", "4.199064537856907`", ",", 
     "4.143274563975368`", ",", "5.209629074931319`", ",", 
     "9.19089967855879`"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
    "7.142796938370466`", ",", "7.737153168855848`", ",", 
     "3.2878767231658763`", ",", "4.733103859444785`", ",", 
     "6.737841424510499`", ",", "6.278652505299792`", ",", 
     "7.226367059904426`", ",", "8.39404416218855`", ",", 
     "5.240230964387811`"}], "}"}]}], "}"}]], "Output",
 CellChangeTimes->{
  3.613176255945014*^9, 3.613176339807026*^9, 3.6131763915135603`*^9, {
   3.6131765244013176`*^9, 3.613176571205574*^9}, 3.613177725693309*^9, 
   3.6131777878498244`*^9, 3.613178227597287*^9, 3.613202158128066*^9, 
   3.6132022743886375`*^9, 3.6132032222715592`*^9, 3.6132040428492403`*^9}],

Cell[BoxData["\<\"Fin:\"\>"], "Print",
 CellChangeTimes->{3.613202158125064*^9, 3.6132022743866367`*^9, 
  3.61320322226856*^9, 3.613204042850241*^9}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
    "6.407950595837725`", ",", "3.8202667810980877`", ",", 
     "5.010348548110304`", ",", "6.640183264680672`", ",", 
     "2.266295731399577`", ",", "0.4399485907088021`", ",", 
     "5.024728023458424`", ",", "2.875434317518817`"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
    "8.989291576366597`", ",", "0.5030349135503762`", ",", 
     "4.141453477664584`", ",", "6.786933449315843`", ",", 
     "9.718596715175806`", ",", "0.6713747696738075`", ",", 
     "8.520147163381168`", ",", "0.43143649351332414`"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
    "2.023701757052317`", ",", "5.325241923047644`", ",", 
     "8.712298818647085`", ",", "4.774637951842589`", ",", 
     "2.363948955404137`", ",", "6.618504169232505`", ",", 
     "1.6947534970750429`", ",", "7.134267345873937`"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
    "6.349379293076414`", ",", "7.959679057945838`", ",", 
     "8.464488196292766`", ",", "1.8792878607505479`", ",", 
     "0.6015561780072058`", ",", "4.462413221926456`", ",", 
     "7.040212997200122`", ",", "4.643862115113857`"}], "}"}]}], 
  "}"}]], "Output",
 CellChangeTimes->{
  3.613176255945014*^9, 3.613176339807026*^9, 3.6131763915135603`*^9, {
   3.6131765244013176`*^9, 3.613176571205574*^9}, 3.613177725693309*^9, 
   3.6131777878498244`*^9, 3.613178227597287*^9, 3.613202158128066*^9, 
   3.6132022743886375`*^9, 3.6132032222715592`*^9, 3.6132040428512416`*^9}],

Cell[CellGroupData[{

Cell[BoxData["\<\"Rq:\"\>"], "Print",
 CellChangeTimes->{3.613202158125064*^9, 3.6132022743866367`*^9, 
  3.61320322226856*^9, 3.6132040428542433`*^9}],

Cell[BoxData["\<\"fi:\"\>"], "Print",
 CellChangeTimes->{3.613202158125064*^9, 3.6132022743866367`*^9, 
  3.61320322226856*^9, 3.613204042856249*^9}]
}, Open  ]],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
  "495.82042096945963`", ",", "382.98989263853645`", ",", 
   "845.0539258081235`", ",", "60.879674259602545`", ",", 
   "802.6242560442082`", ",", "874.692210285501`", ",", "143.8638958130426`", 
   ",", "402.4228262153421`"}], "}"}]], "Output",
 CellChangeTimes->{
  3.613176255945014*^9, 3.613176339807026*^9, 3.6131763915135603`*^9, {
   3.6131765244013176`*^9, 3.613176571205574*^9}, 3.613177725693309*^9, 
   3.6131777878498244`*^9, 3.613178227597287*^9, 3.613202158128066*^9, 
   3.6132022743886375`*^9, 3.6132032222715592`*^9, 3.6132040428582463`*^9}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
  "1.4739626150913807`", ",", "14.009616886564231`", ",", 
   "23.757641023336205`", ",", "40.00203481910167`", ",", 
   "2.899046729195206`", ",", "8.268333307077214`", ",", 
   "22.698456391087888`", ",", "33.413180706241846`", ",", 
   "35.986989062969315`"}], "}"}]], "Output",
 CellChangeTimes->{
  3.613176255945014*^9, 3.613176339807026*^9, 3.6131763915135603`*^9, {
   3.6131765244013176`*^9, 3.613176571205574*^9}, 3.613177725693309*^9, 
   3.6131777878498244`*^9, 3.613178227597287*^9, 3.613202158128066*^9, 
   3.6132022743886375`*^9, 3.6132032222715592`*^9, 3.6132040428602476`*^9}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
  "8.890322480925605`", ",", "5.22092196277028`", ",", "1.3167030754990865`", 
   ",", "2.456707185840912`", ",", "7.542039528938325`", ",", 
   "3.413461821138675`", ",", "4.738106883394018`", ",", "6.959991389388605`",
    ",", "4.500666478545819`"}], "}"}]], "Output",
 CellChangeTimes->{
  3.613176255945014*^9, 3.613176339807026*^9, 3.6131763915135603`*^9, {
   3.6131765244013176`*^9, 3.613176571205574*^9}, 3.613177725693309*^9, 
   3.6131777878498244`*^9, 3.613178227597287*^9, 3.613202158128066*^9, 
   3.6132022743886375`*^9, 3.6132032222715592`*^9, 3.613204042861249*^9}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
  "23.624415604430244`", ",", "18.070204875227855`", ",", 
   "17.665266213728763`", ",", "14.726586262523863`", ",", 
   "13.689532703690544`", ",", "16.519640260301934`", ",", 
   "25.048479568842026`", ",", "21.89423463512297`", ",", 
   "21.48090081380252`"}], "}"}]], "Output",
 CellChangeTimes->{
  3.613176255945014*^9, 3.613176339807026*^9, 3.6131763915135603`*^9, {
   3.6131765244013176`*^9, 3.613176571205574*^9}, 3.613177725693309*^9, 
   3.6131777878498244`*^9, 3.613178227597287*^9, 3.613202158128066*^9, 
   3.6132022743886375`*^9, 3.6132032222715592`*^9, 3.61320404286325*^9}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
  "23.770323222333055`", ",", "17.608222675641947`", ",", 
   "26.32858904071474`", ",", "20.081042526589652`", ",", 
   "14.950397579986726`", ",", "12.19224075154157`", ",", 
   "22.279841681114757`", ",", "15.085000272019935`", ",", "0.`"}], 
  "}"}]], "Output",
 CellChangeTimes->{
  3.613176255945014*^9, 3.613176339807026*^9, 3.6131763915135603`*^9, {
   3.6131765244013176`*^9, 3.613176571205574*^9}, 3.613177725693309*^9, 
   3.6131777878498244`*^9, 3.613178227597287*^9, 3.613202158128066*^9, 
   3.6132022743886375`*^9, 3.6132032222715592`*^9, 3.61320404286525*^9}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
  "55.09115788549551`", ",", "42.55443251539294`", ",", "93.89488064534704`", 
   ",", "6.764408251066949`", ",", "89.18047289380091`", ",", 
   "97.18802336505566`", ",", "15.984877312560288`", ",", 
   "44.713647357260236`", ",", "0.`"}], "}"}]], "Output",
 CellChangeTimes->{
  3.613176255945014*^9, 3.613176339807026*^9, 3.6131763915135603`*^9, {
   3.6131765244013176`*^9, 3.613176571205574*^9}, 3.613177725693309*^9, 
   3.6131777878498244`*^9, 3.613178227597287*^9, 3.613202158128066*^9, 
   3.6132022743886375`*^9, 3.6132032222715592`*^9, 3.6132040428672523`*^9}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
  "92.30510362364257`", ",", "1358.40725614103`", ",", "2281.8692216882732`", 
   ",", "2493.235591748933`", ",", "200.72420002571965`", ",", 
   "729.6453073426658`", ",", "2253.8607617962284`", ",", "2455.28635264274`",
    ",", "2500.`"}], "}"}]], "Output",
 CellChangeTimes->{
  3.613176255945014*^9, 3.613176339807026*^9, 3.6131763915135603`*^9, {
   3.6131765244013176`*^9, 3.613176571205574*^9}, 3.613177725693309*^9, 
   3.6131777878498244`*^9, 3.613178227597287*^9, 3.613202158128066*^9, 
   3.6132022743886375`*^9, 3.6132032222715592`*^9, 3.6132040428682528`*^9}]
}, Open  ]],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"g", "[", 
       RowBox[{"aa_", ",", "a21_", ",", "a22_"}], "]"}], ":=", 
      RowBox[{
       RowBox[{"g", "[", 
        RowBox[{"aa", ",", "a21", ",", "a22"}], "]"}], "=", 
       RowBox[{"f", "[", 
        RowBox[{"aa", ",", "a21", ",", "a22"}], "]"}]}]}], ";"}], 
    "\[IndentingNewLine]", 
    RowBox[{"f", "=", 
     RowBox[{"With", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"Kj", "=", "150."}], ",", 
         RowBox[{"w", "=", "20."}], ",", 
         RowBox[{"Vf", "=", "100."}], ",", 
         RowBox[{"cap", "=", "2500."}], ",", 
         RowBox[{"n", "=", "90"}], ",", 
         RowBox[{"m", "=", "225"}], ",", 
         RowBox[{"p", "=", "85"}], ",", 
         RowBox[{"RML", "=", "45"}], ",", 
         RowBox[{"L", "=", "3."}], ",", 
         RowBox[{"delta", "=", "1."}], ",", 
         RowBox[{"dt", "=", 
          RowBox[{"4.", "/", "3600."}]}], ",", 
         RowBox[{"dx", "=", 
          RowBox[{"1.", "/", "9."}]}], ",", 
         RowBox[{"Ssteps", "=", "10."}]}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{"Compile", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"aa", ",", "_Integer", ",", "1"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"a21", ",", "_Real", ",", "0"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"a22", ",", "_Real", ",", "0"}], "}"}]}], "}"}], ",", 
         RowBox[{"Module", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{"a", "=", "a21"}], ",", 
             RowBox[{"b", "=", "a22"}], ",", 
             RowBox[{"k0", "=", 
              RowBox[{"Table", "[", 
               RowBox[{"0.", ",", 
                RowBox[{"{", "n", "}"}]}], "]"}]}], ",", 
             RowBox[{"Fk", "=", 
              RowBox[{"Table", "[", 
               RowBox[{"0.", ",", 
                RowBox[{"{", "5", "}"}], ",", 
                RowBox[{"{", "n", "}"}]}], "]"}]}], ",", 
             RowBox[{"kr", "=", 
              RowBox[{"Table", "[", 
               RowBox[{"0.", ",", 
                RowBox[{"{", 
                 RowBox[{"n", "-", "2"}], "}"}], ",", 
                RowBox[{"{", "p", "}"}]}], "]"}]}], ",", 
             RowBox[{"Rk", "=", 
              RowBox[{"Table", "[", 
               RowBox[{"0.", ",", 
                RowBox[{"{", "4", "}"}], ",", 
                RowBox[{"{", 
                 RowBox[{"n", "-", "2"}], "}"}], ",", 
                RowBox[{"{", "p", "}"}]}], "]"}]}], ",", 
             RowBox[{"Fq", "=", 
              RowBox[{"Table", "[", 
               RowBox[{"0.", ",", 
                RowBox[{"{", "4", "}"}], ",", 
                RowBox[{"{", 
                 RowBox[{"n", "-", "1"}], "}"}]}], "]"}]}], ",", 
             RowBox[{"Fin", "=", 
              RowBox[{"Table", "[", 
               RowBox[{"0.", ",", 
                RowBox[{"{", "4", "}"}], ",", 
                RowBox[{"{", 
                 RowBox[{"n", "-", "2"}], "}"}]}], "]"}]}], ",", 
             RowBox[{"Rq", "=", 
              RowBox[{"Table", "[", 
               RowBox[{"0.", ",", 
                RowBox[{"{", "4", "}"}], ",", 
                RowBox[{"{", 
                 RowBox[{"n", "-", "2"}], "}"}], ",", 
                RowBox[{"{", "p", "}"}]}], "]"}]}], ",", 
             RowBox[{"Shutoff", "=", "False"}], ",", 
             RowBox[{"j", "=", "1."}], ",", "fi", ",", "qin", ",", "qr", ",", 
             "qf", ",", "qsum", ",", 
             RowBox[{"TT", "=", "0."}], ",", 
             RowBox[{"FTT", "=", "0."}], ",", 
             RowBox[{"RTT", "=", "0."}], ",", 
             RowBox[{"Tsteps", "=", 
              RowBox[{
               RowBox[{"Length", "[", "aa", "]"}], "/", "Ssteps"}]}], ",", 
             "RM", ",", "RMori"}], " ", "}"}], ",", 
           RowBox[{
            RowBox[{"RM", "=", 
             RowBox[{"Table", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"aa", "[", 
                 RowBox[{"[", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"(", 
                    RowBox[{"j", "-", "1"}], ")"}], "*", "Ssteps"}], "+", 
                   RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Floor", "[", 
                    RowBox[{"i", " ", "dx"}], "]"}], "<", "1"}], ",", " ", 
                    "1", ",", 
                    RowBox[{"Ceiling", "[", 
                    RowBox[{"i", " ", "dx"}], "]"}]}], "]"}]}], "]"}], "]"}], 
                " ", "100"}], ",", 
               RowBox[{"{", 
                RowBox[{"j", ",", "Tsteps"}], "}"}], ",", 
               RowBox[{"{", 
                RowBox[{"i", ",", "2", ",", 
                 RowBox[{"n", "-", "1"}]}], "}"}]}], "]"}]}], ";", 
            RowBox[{"RMori", "=", " ", 
             RowBox[{"RM", "[", 
              RowBox[{"[", "1", "]"}], "]"}]}], ";", 
            RowBox[{"(*", 
             RowBox[{
              RowBox[{
               RowBox[{"kr", "[", 
                RowBox[{"[", 
                 RowBox[{"All", ",", "1"}], "]"}], "]"}], "=", 
               RowBox[{"a", " ", 
                RowBox[{"delta", "/", "Vf"}]}]}], ";"}], "*)"}], 
            "\[IndentingNewLine]", 
            RowBox[{"kr", "=", 
             RowBox[{
              RowBox[{
               RowBox[{"ReplacePart", "[", 
                RowBox[{"#", ",", 
                 RowBox[{"(", 
                  RowBox[{"a", " ", 
                   RowBox[{"delta", "/", "Vf"}]}], ")"}], ",", "1"}], "]"}], 
               "&"}], "/@", "kr"}]}], ";", "\[IndentingNewLine]", 
            RowBox[{"RTT", "=", 
             RowBox[{"TT", "=", 
              RowBox[{
               RowBox[{"Total", "[", 
                RowBox[{"kr", ",", "2"}], "]"}], " ", "dx"}]}]}], ";", 
            RowBox[{"AppendTo", "[", 
             RowBox[{"Rk", ",", "kr"}], "]"}], ";", "\[IndentingNewLine]", 
            RowBox[{"While", "[", 
             RowBox[{
              RowBox[{"TT", ">", "0"}], ",", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"If", "[", 
                RowBox[{
                 RowBox[{
                  RowBox[{"Mod", "[", 
                   RowBox[{"j", ",", "100"}], "]"}], "\[Equal]", " ", "0"}], 
                 ",", 
                 RowBox[{"RMori", "=", 
                  RowBox[{"RM", "[", 
                   RowBox[{"[", 
                    RowBox[{"Min", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"j", "/", "100"}], ")"}], "+", "1"}], ",", 
                    "Tsteps"}], "]"}], "]"}], "]"}]}]}], "]"}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"fi", "=", 
                RowBox[{
                 RowBox[{
                  RowBox[{
                   RowBox[{"demR", "[", 
                    RowBox[{"#", "[", 
                    RowBox[{"[", 
                    RowBox[{"-", "1"}], "]"}], "]"}], "]"}], "&"}], "/@", 
                  "kr"}], " ", 
                 RowBox[{"gamma", "[", 
                  RowBox[{
                   RowBox[{"Take", "[", 
                    RowBox[{"k0", ",", 
                    RowBox[{"{", 
                    RowBox[{"2", ",", 
                    RowBox[{"-", "2"}]}], "}"}]}], "]"}], ",", 
                   RowBox[{"Take", "[", 
                    RowBox[{"k0", ",", 
                    RowBox[{"{", 
                    RowBox[{"3", ",", 
                    RowBox[{"-", "1"}]}], "}"}]}], "]"}]}], "]"}]}]}], ";", 
               "\[IndentingNewLine]", "\[IndentingNewLine]", 
               RowBox[{"qf", "=", 
                RowBox[{
                 RowBox[{"Fq", "[", 
                  RowBox[{"[", 
                   RowBox[{
                    RowBox[{"Mod", "[", 
                    RowBox[{"j", ",", "4"}], "]"}], "+", "1"}], "]"}], "]"}], 
                 "=", 
                 RowBox[{"floF", "[", 
                  RowBox[{
                   RowBox[{"Most", "@", "k0"}], ",", 
                   RowBox[{"Rest", "@", 
                    RowBox[{"(", 
                    RowBox[{"Fk", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], ")"}]}], ",", 
                   RowBox[{"Total", "@", "Fq"}], ",", 
                   RowBox[{"Join", "[", 
                    RowBox[{
                    RowBox[{"Total", "@", "Fin"}], ",", 
                    RowBox[{"{", "0.", "}"}]}], "]"}], ",", 
                   RowBox[{"Join", "[", 
                    RowBox[{
                    RowBox[{"fi", " ", "dx"}], ",", 
                    RowBox[{"{", "0.", "}"}]}], "]"}]}], "]"}]}]}], ";", 
               "\[IndentingNewLine]", "\[IndentingNewLine]", 
               RowBox[{"qin", "=", 
                RowBox[{
                 RowBox[{"Fin", "[", 
                  RowBox[{"[", 
                   RowBox[{
                    RowBox[{"Mod", "[", 
                    RowBox[{"j", ",", "4"}], "]"}], "+", "1"}], "]"}], "]"}], 
                 "=", 
                 RowBox[{"inflow", "[", 
                  RowBox[{"fi", ",", 
                   RowBox[{"Most", "@", "qf"}]}], "]"}]}]}], ";", 
               "\[IndentingNewLine]", "\[IndentingNewLine]", 
               RowBox[{"Fk", "=", 
                RowBox[{"RotateLeft", "[", "Fk", "]"}]}], ";", 
               "\[IndentingNewLine]", "\[IndentingNewLine]", 
               RowBox[{"k0", "=", 
                RowBox[{
                 RowBox[{"Fk", "[", 
                  RowBox[{"[", 
                   RowBox[{"-", "1"}], "]"}], "]"}], "=", 
                 RowBox[{"updateF", "[", 
                  RowBox[{
                   RowBox[{"Join", "[", 
                    RowBox[{
                    RowBox[{"{", "0.", "}"}], ",", 
                    RowBox[{"den", "[", 
                    RowBox[{
                    RowBox[{"Most", "@", "qf"}], ",", 
                    RowBox[{"Rest", "@", "qf"}], ",", "qin"}], "]"}], ",", 
                    RowBox[{"{", "0.", "}"}]}], "]"}], ",", "k0"}], "]"}]}]}],
                ";", "\[IndentingNewLine]", 
               RowBox[{"qsum", "=", 
                RowBox[{"Total", "@", "Rq"}]}], ";", "\[IndentingNewLine]", 
               RowBox[{"qr", "=", 
                RowBox[{
                 RowBox[{"Rq", "[", 
                  RowBox[{"[", 
                   RowBox[{
                    RowBox[{"Mod", "[", 
                    RowBox[{"j", ",", "4"}], "]"}], "+", "1"}], "]"}], "]"}], 
                 "=", 
                 RowBox[{"MapThread", "[", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"Join", "[", 
                    RowBox[{"#1", ",", 
                    RowBox[{"{", "#2", "}"}], ",", "#3", ",", 
                    RowBox[{"{", "#4", "}"}]}], "]"}], "&"}], ",", 
                   RowBox[{"{", 
                    RowBox[{
                    RowBox[{"MapThread", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"floR", "[", 
                    RowBox[{"#1", ",", "#2", ",", "#3"}], "]"}], "&"}], ",", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"Take", "[", 
                    RowBox[{"#", ",", 
                    RowBox[{"{", 
                    RowBox[{"1", ",", 
                    RowBox[{"RML", "-", "1"}]}], "}"}]}], "]"}], "&"}], "/@", 
                    "kr"}], ",", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Take", "[", 
                    RowBox[{"#", ",", 
                    RowBox[{"{", 
                    RowBox[{"2", ",", "RML"}], "}"}]}], "]"}], "&"}], "/@", 
                    RowBox[{"Rk", "[", 
                    RowBox[{"[", "1", "]"}], "]"}]}], ",", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Take", "[", 
                    RowBox[{"#", ",", 
                    RowBox[{"{", 
                    RowBox[{"1", ",", 
                    RowBox[{"RML", "-", "1"}]}], "}"}]}], "]"}], "&"}], "/@", 
                    "qsum"}]}], "}"}], ",", "2"}], "]"}], ",", 
                    RowBox[{"MapThread", "[", 
                    RowBox[{"compiledMin", "[", 
                    RowBox[{"RMori", ",", 
                    RowBox[{"MapThread", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"floR", "[", 
                    RowBox[{
                    RowBox[{"#1", "[", 
                    RowBox[{"[", "RML", "]"}], "]"}], ",", 
                    RowBox[{"#2", "[", 
                    RowBox[{"[", 
                    RowBox[{"RML", "+", "1"}], "]"}], "]"}], ",", 
                    RowBox[{"#3", "[", 
                    RowBox[{"[", "RML", "]"}], "]"}]}], "]"}], "&"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"kr", ",", 
                    RowBox[{"Rk", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], ",", "qsum"}], "}"}]}], 
                    "]"}]}], "]"}], "]"}], ",", 
                    RowBox[{"MapThread", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"floR", "[", 
                    RowBox[{"#1", ",", "#2", ",", "#3"}], "]"}], "&"}], ",", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"Take", "[", 
                    RowBox[{"#", ",", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"RML", "+", "1"}], ",", 
                    RowBox[{"-", "2"}]}], "}"}]}], "]"}], "&"}], "/@", "kr"}],
                     ",", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Take", "[", 
                    RowBox[{"#", ",", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"RML", "+", "2"}], ",", 
                    RowBox[{"-", "1"}]}], "}"}]}], "]"}], "&"}], "/@", 
                    RowBox[{"Rk", "[", 
                    RowBox[{"[", "1", "]"}], "]"}]}], ",", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Take", "[", 
                    RowBox[{"#", ",", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"RML", "+", "1"}], ",", 
                    RowBox[{"-", "2"}]}], "}"}]}], "]"}], "&"}], "/@", 
                    "qsum"}]}], "}"}], ",", "2"}], "]"}], ",", "fi"}], 
                    "}"}]}], "]"}]}]}], ";", "\[IndentingNewLine]", 
               RowBox[{"Rk", "=", 
                RowBox[{"RotateLeft", "[", "Rk", "]"}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"kr", "=", 
                RowBox[{
                 RowBox[{"Rk", "[", 
                  RowBox[{"[", 
                   RowBox[{"-", "1"}], "]"}], "]"}], "=", 
                 RowBox[{"updateR", "[", 
                  RowBox[{
                   RowBox[{
                    RowBox[{
                    RowBox[{"Join", "[", 
                    RowBox[{
                    RowBox[{"{", "0.", "}"}], ",", "#"}], "]"}], "&"}], "/@", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"density", "[", 
                    RowBox[{
                    RowBox[{"Most", "@", "#"}], ",", 
                    RowBox[{"Rest", "@", "#"}], ",", "0"}], "]"}], "&"}], "/@",
                     "qr"}], ")"}]}], ",", "kr"}], "]"}]}]}], ";", 
               "\[IndentingNewLine]", "\[IndentingNewLine]", 
               RowBox[{"If", "[", 
                RowBox[{
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{"Shutoff", "\[Equal]", "False"}], ")"}], "&&", 
                  RowBox[{"j", ">", "m"}]}], ",", 
                 RowBox[{
                  RowBox[{"Shutoff", "=", "True"}], ";", 
                  RowBox[{"kr", "=", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"ReplacePart", "[", 
                    RowBox[{"#", ",", "0", ",", "1"}], "]"}], "&"}], "/@", 
                    "kr"}]}]}]}], "]"}], ";", "\[IndentingNewLine]", 
               RowBox[{"FTT", "+=", 
                RowBox[{"Total", "@", "k0"}]}], ";", 
               RowBox[{"RTT", "+=", 
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{"Total", "@", 
                   RowBox[{"(", 
                    RowBox[{"Total", "@", "kr"}], ")"}]}], ")"}], " ", 
                 "dx"}]}], ";", 
               RowBox[{"If", "[", 
                RowBox[{
                 RowBox[{"j", ">", "m"}], ",", 
                 RowBox[{"TT", "=", 
                  RowBox[{"Total", "@", "k0"}]}]}], "]"}], ";", 
               RowBox[{"If", "[", 
                RowBox[{
                 RowBox[{
                  RowBox[{"Max", "[", 
                   RowBox[{"(", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"#", "[", 
                    RowBox[{"[", 
                    RowBox[{"RML", "+", "1"}], "]"}], "]"}], "&"}], "/@", 
                    "kr"}], ")"}], "]"}], ">", 
                  RowBox[{"Kj", "-", 
                   RowBox[{"a", "/", "w"}]}]}], ",", 
                 RowBox[{
                  RowBox[{"Print", "[", "\"\<Meter Spillback\>\"", "]"}], ";", 
                  RowBox[{"RTT", "=", 
                   RowBox[{"10", "^", "10"}]}], ";", 
                  RowBox[{"Break", "[", "]"}]}]}], "]"}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"If", "[", 
                RowBox[{
                 RowBox[{
                  RowBox[{"Max", "[", 
                   RowBox[{"(", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"#", "[", 
                    RowBox[{"[", "2", "]"}], "]"}], "&"}], "/@", "kr"}], 
                    ")"}], "]"}], ">", 
                  RowBox[{"Kj", "-", 
                   RowBox[{"a", "/", "w"}]}]}], ",", 
                 RowBox[{
                  RowBox[{"Print", "[", "\"\<Ramp Spillback\>\"", "]"}], ";", 
                  RowBox[{"RTT", "=", 
                   RowBox[{"10", "^", "10"}]}], ";", 
                  RowBox[{"Break", "[", "]"}]}]}], "]"}], ";", 
               RowBox[{"j", "++"}]}]}], "]"}], ";", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"RTT", "+", "FTT"}], ")"}], " ", "dt", " ", "dx"}]}]}], 
          "]"}], ",", 
         RowBox[{"CompilationOptions", "\[Rule]", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"\"\<ExpressionOptimization\>\"", "\[Rule]", "True"}], 
            ",", 
            RowBox[{
            "\"\<InlineExternalDefinitions\>\"", "\[Rule]", "True"}]}], 
           "}"}]}], ",", 
         RowBox[{"Parallelization", "\[Rule]", "True"}], ",", 
         RowBox[{"RuntimeAttributes", "\[Rule]", 
          RowBox[{"{", "Listable", "}"}]}], ",", 
         RowBox[{"RuntimeOptions", "\[Rule]", "\"\<Speed\>\""}]}], "]"}]}], 
      "]"}]}]}], "]"}], ";"}]], "Input",
 CellChangeTimes->{{3.612023226274868*^9, 3.612023308894287*^9}, {
   3.6120289429476037`*^9, 3.6120289539439216`*^9}, {3.612101981630884*^9, 
   3.612101985198258*^9}, {3.6121025294596176`*^9, 3.6121025323335314`*^9}, {
   3.612102691318324*^9, 3.612102757763501*^9}, {3.612102791329834*^9, 
   3.6121027983044767`*^9}, {3.6121028404124985`*^9, 3.61210286945282*^9}, {
   3.612102932444417*^9, 3.6121029930439796`*^9}, {3.6121034045060186`*^9, 
   3.6121034051274333`*^9}, 3.6121034432928295`*^9, {3.6121040749284916`*^9, 
   3.612104081288724*^9}, {3.6121042874909377`*^9, 3.6121043152434034`*^9}, 
   3.612104348956001*^9, {3.6121044008935633`*^9, 3.6121044106970897`*^9}, {
   3.6121045975849314`*^9, 3.612104628338397*^9}, {3.612104758575061*^9, 
   3.6121047834015822`*^9}, 3.612105008574419*^9, {3.612107413218937*^9, 
   3.6121074173316717`*^9}, {3.612117740528376*^9, 3.612117764633855*^9}, {
   3.61211795143198*^9, 3.612117963809216*^9}, {3.6121352013952565`*^9, 
   3.61213524918606*^9}, {3.6121352912550526`*^9, 3.6121353157598896`*^9}, 
   3.612135382307171*^9, {3.6121354410803804`*^9, 3.612135445719468*^9}, 
   3.6121359386107426`*^9, {3.6121362237563663`*^9, 3.6121362344324684`*^9}, {
   3.612136283289982*^9, 3.6121362842276077`*^9}, 3.6121363797928495`*^9, {
   3.6121364357718835`*^9, 3.612136441037386*^9}, {3.612136481830531*^9, 
   3.6121365009402485`*^9}, {3.612136621901739*^9, 3.6121366224491034`*^9}, 
   3.6121366821956425`*^9, 3.6121367935613904`*^9, 3.6121374551211495`*^9, {
   3.6121377361291466`*^9, 3.6121377566678143`*^9}, 3.6121378273888736`*^9, {
   3.612137890026557*^9, 3.6121378995458922`*^9}, {3.612138006934985*^9, 
   3.612138013689479*^9}, {3.6121380689132285`*^9, 3.612138072642709*^9}, {
   3.6121381029598846`*^9, 3.612138138015211*^9}, {3.6121381791966143`*^9, 
   3.6121382000524926`*^9}, 3.612138621872572*^9, 3.612139285687533*^9, {
   3.612139829954717*^9, 3.6121398306922083`*^9}, {3.6121400019191484`*^9, 
   3.612140002896799*^9}, {3.6121403567162437`*^9, 3.6121403589967613`*^9}, {
   3.6121409501006794`*^9, 3.612140971555807*^9}, {3.612141154598349*^9, 
   3.612141157954582*^9}, {3.6121427848922844`*^9, 3.612142815617729*^9}, {
   3.612142852346074*^9, 3.6121428531345987`*^9}, {3.6121429346179204`*^9, 
   3.6121430217879267`*^9}, {3.6121434206455793`*^9, 
   3.6121435428314466`*^9}, {3.61214378929737*^9, 3.612143844818313*^9}, {
   3.6121438912922425`*^9, 3.6121439017041674`*^9}, {3.6121439588341837`*^9, 
   3.6121439631550584`*^9}, {3.6121440113821526`*^9, 3.612144035573745*^9}, {
   3.612144121678812*^9, 3.61214414550871*^9}, {3.6121442110293083`*^9, 
   3.612144211846854*^9}, {3.6121442642887526`*^9, 3.6121442651493225`*^9}, {
   3.6121445699298344`*^9, 3.6121446122790127`*^9}, {3.61214470073869*^9, 
   3.612144707414133*^9}, {3.612147894199198*^9, 3.6121479539549613`*^9}, {
   3.612147994780312*^9, 3.612148002762624*^9}, {3.612148050310264*^9, 
   3.6121480513889823`*^9}, {3.612148109704789*^9, 3.6121481107864113`*^9}, {
   3.612152927999116*^9, 3.6121530898108883`*^9}, {3.6121531215540104`*^9, 
   3.6121531583254795`*^9}, 3.6121532031142845`*^9, {3.612153380795519*^9, 
   3.6121533898235292`*^9}, 3.61215343493047*^9, {3.6121551494603176`*^9, 
   3.6121551910248127`*^9}, {3.6121552247764397`*^9, 3.612155254746627*^9}, {
   3.6121555589018607`*^9, 3.6121555661990824`*^9}, {3.612155604857193*^9, 
   3.612155640608906*^9}, {3.612155673110471*^9, 3.612155677313798*^9}, {
   3.612155762218522*^9, 3.612155827924796*^9}, 3.612156201793826*^9, {
   3.612156623817785*^9, 3.6121566491335793`*^9}, {3.6121567718212786`*^9, 
   3.612156798325864*^9}, {3.612167700162096*^9, 3.6121677150189514`*^9}, 
   3.6121681342340517`*^9, 3.612170087589526*^9, {3.612170118192828*^9, 
   3.6121701227888784`*^9}, {3.612170202886012*^9, 3.612170217228527*^9}, {
   3.612170296098846*^9, 3.612170299469082*^9}, {3.612174859074157*^9, 
   3.612174868442374*^9}, {3.612174905478945*^9, 3.6121749141927223`*^9}, {
   3.6121750252794156`*^9, 3.612175049639578*^9}, {3.612175150496484*^9, 
   3.612175173207551*^9}, {3.6121752118951516`*^9, 3.612175223370763*^9}, {
   3.612175448705247*^9, 3.6121754490604815`*^9}, {3.612175480498337*^9, 
   3.6121757635180874`*^9}, {3.612175798662401*^9, 3.612175844638901*^9}, {
   3.6121758778239155`*^9, 3.61217602008529*^9}, {3.6121760528420196`*^9, 
   3.61217606138969*^9}, 3.6121771021585574`*^9, {3.612177193988475*^9, 
   3.612177221599792*^9}, {3.6121772758577876`*^9, 3.6121773079150524`*^9}, {
   3.6121773463505497`*^9, 3.6121773723628087`*^9}, {3.612177508486109*^9, 
   3.6121775182886114`*^9}, {3.6121777079724445`*^9, 
   3.6121777098366814`*^9}, {3.61217780819393*^9, 3.612177814319993*^9}, {
   3.6121778619678545`*^9, 3.61217788217126*^9}, {3.612177951333141*^9, 
   3.6121779608964834`*^9}, 3.612178139420913*^9, {3.6121865737842283`*^9, 
   3.612186577882946*^9}, 3.6121866430231586`*^9, 3.612186820490893*^9, {
   3.6121869451756015`*^9, 3.6121869494764566`*^9}, {3.6121920487112513`*^9, 
   3.6121921851107354`*^9}, {3.6121923389197707`*^9, 3.612192410475238*^9}, {
   3.6121932949433537`*^9, 3.6121933043555984`*^9}, {3.613145258627679*^9, 
   3.6131452651820555`*^9}, 3.613146451343665*^9, {3.6131464911512527`*^9, 
   3.613146516216993*^9}, {3.613146731736936*^9, 3.613146847413198*^9}, {
   3.613146890561015*^9, 3.613146973561451*^9}, {3.613169324335759*^9, 
   3.613169339950187*^9}, {3.613169607620963*^9, 3.613169621761407*^9}, {
   3.6131696691670694`*^9, 3.613169736955287*^9}, {3.613170403435175*^9, 
   3.6131704170822897`*^9}, 3.613170847742367*^9, {3.61317089967367*^9, 
   3.6131709432617826`*^9}, {3.613170983044354*^9, 3.613171091700926*^9}, {
   3.6131712304971*^9, 3.61317123582666*^9}, {3.6131715575355263`*^9, 
   3.613171564717324*^9}, {3.613171618303115*^9, 3.61317162942254*^9}, {
   3.6131717150787506`*^9, 3.613171747321285*^9}, {3.613171812665929*^9, 
   3.6131718389855723`*^9}, {3.613171915238168*^9, 3.61317196006711*^9}, {
   3.613172527292286*^9, 3.613172541035465*^9}, {3.6131726407830877`*^9, 
   3.6131727751758485`*^9}, {3.613172840674595*^9, 3.6131728637480073`*^9}, {
   3.613174067408613*^9, 3.6131740732525167`*^9}, {3.613201791601265*^9, 
   3.6132018156553307`*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"aa", "=", "2500."}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"bb", "=", "0.05"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"vars", "=", 
   RowBox[{"Array", "[", 
    RowBox[{"x", ",", "20"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"{", 
    RowBox[{"sol", ",", 
     RowBox[{"{", "points", "}"}]}], "}"}], "=", 
   RowBox[{"Reap", "[", 
    RowBox[{"NMinimize", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"Hold", "[", 
         RowBox[{"t", "=", 
          RowBox[{"g", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{
              RowBox[{"x", "[", "1", "]"}], ",", 
              RowBox[{"x", "[", "2", "]"}], ",", 
              RowBox[{"x", "[", "3", "]"}], ",", 
              RowBox[{"x", "[", "4", "]"}], ",", 
              RowBox[{"x", "[", "5", "]"}], ",", 
              RowBox[{"x", "[", "6", "]"}], ",", 
              RowBox[{"x", "[", "7", "]"}], ",", 
              RowBox[{"x", "[", "8", "]"}], ",", 
              RowBox[{"x", "[", "9", "]"}], ",", 
              RowBox[{"x", "[", "10", "]"}], ",", 
              RowBox[{"x", "[", "11", "]"}], ",", 
              RowBox[{"x", "[", "12", "]"}], ",", 
              RowBox[{"x", "[", "13", "]"}], ",", 
              RowBox[{"x", "[", "14", "]"}], ",", 
              RowBox[{"x", "[", "15", "]"}], ",", 
              RowBox[{"x", "[", "16", "]"}], ",", 
              RowBox[{"x", "[", "17", "]"}], ",", 
              RowBox[{"x", "[", "18", "]"}], ",", 
              RowBox[{"x", "[", "19", "]"}], ",", 
              RowBox[{"x", "[", "20", "]"}]}], "}"}], ",", "aa", ",", "bb"}], 
           "]"}]}], "]"}], ",", 
        RowBox[{
         RowBox[{"And", "@@", 
          RowBox[{"Thread", "@", 
           RowBox[{"LessEqual", "[", 
            RowBox[{"3", ",", "vars", ",", "25"}], "]"}]}]}], "&&", 
         RowBox[{"vars", "\[Element]", "Integers"}]}]}], "}"}], ",", "vars", 
      ",", 
      RowBox[{"Method", "\[Rule]", 
       RowBox[{"{", 
        RowBox[{"\"\<SimulatedAnnealing\>\"", ",", 
         RowBox[{"\"\<PerturbationScale\>\"", "\[Rule]", "2"}], ",", 
         RowBox[{"\"\<SearchPoints\>\"", "\[Rule]", "100000"}]}], "}"}]}], 
      ",", 
      RowBox[{"EvaluationMonitor", "\[RuleDelayed]", 
       RowBox[{"Sow", "[", 
        RowBox[{"{", 
         RowBox[{"Join", "[", 
          RowBox[{"vars", ",", 
           RowBox[{"{", "t", "}"}]}], "]"}], "}"}], "]"}]}]}], "]"}], "]"}]}],
   ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Export", "[", 
   RowBox[{
    RowBox[{"root", "<>", "\"\<TI\>\"", "<>", "\"\<_\>\"", "<>", 
     RowBox[{"ToString", "[", "aa", "]"}], "<>", "\"\<_\>\"", "<>", 
     RowBox[{"ToString", "[", "bb", "]"}], "<>", "\"\<.xls\>\""}], ",", 
    RowBox[{"DeleteDuplicates", "[", "points", "]"}]}], "]"}], 
  ";"}]}], "Input",
 CellChangeTimes->{{3.612151395967471*^9, 3.6121513959754753`*^9}, {
   3.6121514396665497`*^9, 3.6121514747929244`*^9}, {3.612151531150429*^9, 
   3.6121515939556665`*^9}, {3.6121516487060995`*^9, 
   3.6121517303635283`*^9}, {3.6121519920366282`*^9, 3.612151993723751*^9}, {
   3.6121520489474993`*^9, 3.612152097919014*^9}, {3.6121522070226145`*^9, 
   3.6121522209638968`*^9}, {3.6121522633561*^9, 3.6121523005760384`*^9}, {
   3.6121525334704337`*^9, 3.6121525677792835`*^9}, {3.6121526284435406`*^9, 
   3.612152631594634*^9}, {3.612152678283947*^9, 3.6121526820834775`*^9}, {
   3.612152742270525*^9, 3.6121528674848475`*^9}, {3.6121533066852036`*^9, 
   3.6121533703315554`*^9}, {3.612154093949224*^9, 3.612154109387463*^9}, {
   3.6121541717185793`*^9, 3.6121541741249466`*^9}, {3.612177977327383*^9, 
   3.6121780093005943`*^9}, {3.6121780904714456`*^9, 3.612178098123522*^9}, 
   3.612178793628908*^9, {3.61217933051195*^9, 3.6121793320899963`*^9}, {
   3.6121910514183965`*^9, 3.6121910568119745`*^9}, {3.612191815963853*^9, 
   3.6121919125819426`*^9}, {3.6121919848698983`*^9, 
   3.6121919868542175`*^9}, {3.6121927306586456`*^9, 
   3.6121927322462025`*^9}, {3.612192782470521*^9, 3.6121928081205378`*^9}, {
   3.6121930944373407`*^9, 3.612193094527402*^9}, {3.612193197076432*^9, 
   3.612193238709051*^9}}]
},
WindowSize->{1350, 631},
WindowMargins->{{0, Automatic}, {Automatic, 0}},
FrontEndVersion->"9.0 for Microsoft Windows (64-bit) (January 25, 2013)",
StyleDefinitions->"Default.nb"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[557, 20, 19137, 430, 552, "Input"],
Cell[CellGroupData[{
Cell[19719, 454, 7349, 212, 592, "Input"],
Cell[27071, 668, 151, 2, 23, "Print"],
Cell[27225, 672, 661, 12, 31, "Output"],
Cell[27889, 686, 149, 2, 23, "Print"],
Cell[28041, 690, 2071, 43, 112, "Output"],
Cell[30115, 735, 149, 2, 23, "Print"],
Cell[30267, 739, 1901, 47, 72, "Output"],
Cell[CellGroupData[{
Cell[32193, 790, 151, 2, 23, "Print"],
Cell[32347, 794, 151, 2, 23, "Print"]
}, Open  ]],
Cell[32513, 799, 1619, 35, 92, "Output"],
Cell[34135, 836, 150, 2, 23, "Print"],
Cell[34288, 840, 1490, 32, 52, "Output"],
Cell[CellGroupData[{
Cell[35803, 876, 151, 2, 23, "Print"],
Cell[35957, 880, 149, 2, 23, "Print"]
}, Open  ]],
Cell[36121, 885, 599, 11, 31, "Output"],
Cell[36723, 898, 634, 12, 31, "Output"],
Cell[37360, 912, 622, 11, 31, "Output"],
Cell[37985, 925, 632, 12, 31, "Output"],
Cell[38620, 939, 615, 12, 31, "Output"],
Cell[39238, 953, 611, 11, 31, "Output"],
Cell[39852, 966, 613, 11, 31, "Output"]
}, Open  ]],
Cell[40480, 980, 25621, 547, 692, "Input"],
Cell[66104, 1529, 4226, 92, 212, "Input"]
}
]
*)

(* End of internal cache information *)
