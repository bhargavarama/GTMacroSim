(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 9.0' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       157,          7]
NotebookDataLength[     46290,       1023]
NotebookOptionsPosition[     45960,       1008]
NotebookOutlinePosition[     46302,       1023]
CellTagsIndexPosition[     46259,       1020]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{
Cell[BoxData[{
 RowBox[{
  RowBox[{"demF", "=", 
   RowBox[{"Compile", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"p1", ",", "_Real", ",", "0"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"p2", ",", "_Real", ",", "0"}], "}"}]}], "}"}], ",", 
     RowBox[{"Max", "[", 
      RowBox[{"0", ",", 
       RowBox[{
        RowBox[{"Min", "[", 
         RowBox[{
          RowBox[{"p1", " ", "Vf"}], ",", 
          RowBox[{"L", " ", "cap"}]}], "]"}], "-", "p2"}]}], "]"}], ",", 
     RowBox[{"Parallelization", "\[Rule]", "True"}], ",", 
     RowBox[{"RuntimeAttributes", "\[Rule]", 
      RowBox[{"{", "Listable", "}"}]}], ",", 
     RowBox[{"CompilationOptions", "\[Rule]", 
      RowBox[{"{", 
       RowBox[{"\"\<InlineExternalDefinitions\>\"", "\[Rule]", "True"}], 
       "}"}]}]}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"demR", "=", 
   RowBox[{"Compile", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"{", 
       RowBox[{"p1", ",", "_Real", ",", "0"}], "}"}], "}"}], ",", 
     RowBox[{"Min", "[", 
      RowBox[{
       RowBox[{"p1", " ", "Vf"}], ",", "cap"}], "]"}], ",", 
     RowBox[{"Parallelization", "\[Rule]", "True"}], ",", 
     RowBox[{"RuntimeAttributes", "\[Rule]", 
      RowBox[{"{", "Listable", "}"}]}], ",", 
     RowBox[{"CompilationOptions", "\[Rule]", 
      RowBox[{"{", 
       RowBox[{"\"\<InlineExternalDefinitions\>\"", "\[Rule]", "True"}], 
       "}"}]}]}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"supF", "=", 
   RowBox[{"Compile", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"{", 
       RowBox[{"p1", ",", "_Real", ",", "0"}], "}"}], "}"}], ",", 
     RowBox[{"Min", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"(", 
         RowBox[{
          RowBox[{"L", " ", "Kj"}], "-", "p1"}], ")"}], " ", "w"}], ",", 
       RowBox[{"L", " ", "cap"}]}], "]"}], ",", 
     RowBox[{"Parallelization", "\[Rule]", "True"}], ",", 
     RowBox[{"RuntimeAttributes", "\[Rule]", 
      RowBox[{"{", "Listable", "}"}]}], ",", 
     RowBox[{"CompilationOptions", "\[Rule]", 
      RowBox[{"{", 
       RowBox[{"\"\<InlineExternalDefinitions\>\"", "\[Rule]", "True"}], 
       "}"}]}]}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"NsupF", "=", 
    RowBox[{"Compile", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"p1", ",", "_Real", ",", "0"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"p2", ",", "_Real", ",", "0"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"p3", ",", "_Real", ",", "0"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"p4", ",", "_Real", ",", "0"}], "}"}]}], "}"}], ",", 
      RowBox[{"Max", "[", 
       RowBox[{"0", ",", 
        RowBox[{
         RowBox[{"Min", "[", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"(", 
              RowBox[{
               RowBox[{"L", " ", "Kj"}], "-", "p1"}], ")"}], " ", "Vf"}], "-",
             "p2", "-", "p3"}], ",", 
           RowBox[{"L", " ", "cap"}]}], "]"}], "-", "p4"}]}], "]"}], ",", 
      RowBox[{"Parallelization", "\[Rule]", "True"}], ",", 
      RowBox[{"RuntimeAttributes", "\[Rule]", 
       RowBox[{"{", "Listable", "}"}]}], ",", 
      RowBox[{"CompilationOptions", "\[Rule]", 
       RowBox[{"{", 
        RowBox[{"\"\<InlineExternalDefinitions\>\"", "\[Rule]", "True"}], 
        "}"}]}]}], "]"}]}], ";"}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"supF", "=", 
    RowBox[{"Compile", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"{", 
        RowBox[{"p1", ",", "_Real", ",", "0"}], "}"}], "}"}], ",", 
      RowBox[{"Max", "[", 
       RowBox[{"0", ",", 
        RowBox[{
         RowBox[{"Min", "[", 
          RowBox[{
           RowBox[{"pp1", " ", "Vf"}], ",", 
           RowBox[{"aa", " ", "cap"}]}], "]"}], "-", "pp2"}]}], "]"}], ",", 
      RowBox[{"Parallelization", "\[Rule]", "True"}], ",", 
      RowBox[{"RuntimeAttributes", "\[Rule]", 
       RowBox[{"{", "Listable", "}"}]}], ",", 
      RowBox[{"CompilationOptions", "\[Rule]", 
       RowBox[{"{", 
        RowBox[{"\"\<InlineExternalDefinitions\>\"", "\[Rule]", "True"}], 
        "}"}]}]}], "]"}]}], ";"}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Nsupply", "=", 
   RowBox[{
    RowBox[{"Max", "[", 
     RowBox[{"0", ",", 
      RowBox[{
       RowBox[{"Min", "[", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"(", 
            RowBox[{
             RowBox[{"#", " ", "Kj"}], "-", "#2"}], ")"}], " ", "Vf"}], "-", 
          "#3", "-", "#4"}], ",", 
         RowBox[{"#", " ", "cap"}]}], "]"}], "-", "#5"}]}], "]"}], "&"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"floExct", "=", 
   RowBox[{
    RowBox[{"Evaluate", "@", 
     RowBox[{"Min", "[", 
      RowBox[{
       RowBox[{"demand", "[", 
        RowBox[{"#", ",", "#2", ",", "#6"}], "]"}], ",", 
       RowBox[{"Nsupply", "[", 
        RowBox[{"#", ",", "#3", ",", "#4", ",", "#5", ",", "#6"}], "]"}]}], 
      "]"}]}], "&"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"gamma", "=", 
   RowBox[{
    RowBox[{"Evaluate", "@", 
     RowBox[{"Min", "[", 
      RowBox[{"1", ",", 
       RowBox[{
        RowBox[{"supply", "[", 
         RowBox[{"L", ",", "#2", ",", "0"}], "]"}], "/", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"demand", "[", 
           RowBox[{"L", ",", "#", ",", "0"}], "]"}], "+", "0.001"}], 
         ")"}]}]}], "]"}]}], "&"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"density", "=", 
   RowBox[{
    RowBox[{
     RowBox[{"(", 
      RowBox[{"#", "-", "#2", "+", "#3"}], ")"}], "/", "Vf"}], "&"}]}], 
  ";"}]}], "Input",
 CellChangeTimes->{{3.612023226274868*^9, 3.612023308894287*^9}, {
   3.6120289429476037`*^9, 3.6120289539439216`*^9}, {3.612101981630884*^9, 
   3.612101985198258*^9}, {3.6121025294596176`*^9, 3.6121025323335314`*^9}, {
   3.612102691318324*^9, 3.612102757763501*^9}, {3.612102791329834*^9, 
   3.6121027983044767`*^9}, {3.6121028404124985`*^9, 3.61210286945282*^9}, {
   3.612102932444417*^9, 3.6121029930439796`*^9}, {3.6121034045060186`*^9, 
   3.6121034051274333`*^9}, 3.6121034432928295`*^9, {3.6121040749284916`*^9, 
   3.612104081288724*^9}, {3.6121042874909377`*^9, 3.6121043152434034`*^9}, 
   3.612104348956001*^9, {3.6121044008935633`*^9, 3.6121044106970897`*^9}, {
   3.6121045975849314`*^9, 3.612104628338397*^9}, {3.612104758575061*^9, 
   3.6121047834015822`*^9}, 3.612105008574419*^9, {3.612107413218937*^9, 
   3.6121074173316717`*^9}, {3.612117740528376*^9, 3.612117764633855*^9}, {
   3.61211795143198*^9, 3.612117963809216*^9}, {3.6121352013952565`*^9, 
   3.61213524918606*^9}, {3.6121352912550526`*^9, 3.6121353157598896`*^9}, 
   3.612135382307171*^9, {3.6121354410803804`*^9, 3.612135445719468*^9}, 
   3.6121359386107426`*^9, {3.6121362237563663`*^9, 3.6121362344324684`*^9}, {
   3.612136283289982*^9, 3.6121362842276077`*^9}, 3.6121363797928495`*^9, {
   3.6121364357718835`*^9, 3.612136441037386*^9}, {3.612136481830531*^9, 
   3.6121365009402485`*^9}, {3.612136621901739*^9, 3.6121366224491034`*^9}, 
   3.6121366821956425`*^9, 3.6121367935613904`*^9, 3.6121374551211495`*^9, {
   3.6121377361291466`*^9, 3.6121377566678143`*^9}, 3.6121378273888736`*^9, {
   3.612137890026557*^9, 3.6121378995458922`*^9}, {3.612138006934985*^9, 
   3.612138013689479*^9}, {3.6121380689132285`*^9, 3.612138072642709*^9}, {
   3.6121381029598846`*^9, 3.612138138015211*^9}, {3.6121381791966143`*^9, 
   3.6121382000524926`*^9}, 3.612138621872572*^9, 3.612139285687533*^9, {
   3.612139829954717*^9, 3.6121398306922083`*^9}, {3.6121400019191484`*^9, 
   3.612140002896799*^9}, {3.6121403567162437`*^9, 3.6121403589967613`*^9}, {
   3.6121409501006794`*^9, 3.612140971555807*^9}, {3.612141154598349*^9, 
   3.612141157954582*^9}, {3.6121427848922844`*^9, 3.612142815617729*^9}, {
   3.612142852346074*^9, 3.6121428531345987`*^9}, {3.6121429346179204`*^9, 
   3.6121430217879267`*^9}, {3.6121434206455793`*^9, 
   3.6121435428314466`*^9}, {3.61214378929737*^9, 3.612143844818313*^9}, {
   3.6121438912922425`*^9, 3.6121439017041674`*^9}, {3.6121439588341837`*^9, 
   3.6121439631550584`*^9}, {3.6121440113821526`*^9, 3.612144035573745*^9}, {
   3.612144121678812*^9, 3.61214414550871*^9}, {3.6121442110293083`*^9, 
   3.612144211846854*^9}, {3.6121442642887526`*^9, 3.6121442651493225`*^9}, {
   3.6121445699298344`*^9, 3.6121446122790127`*^9}, {3.61214470073869*^9, 
   3.612144707414133*^9}, {3.612147894199198*^9, 3.6121479539549613`*^9}, {
   3.612147994780312*^9, 3.612148002762624*^9}, {3.612148050310264*^9, 
   3.6121480513889823`*^9}, {3.612148109704789*^9, 3.6121481107864113`*^9}, {
   3.612152927999116*^9, 3.6121530898108883`*^9}, {3.6121531215540104`*^9, 
   3.6121531583254795`*^9}, 3.6121532031142845`*^9, {3.612153380795519*^9, 
   3.6121533898235292`*^9}, 3.61215343493047*^9, {3.6121551494603176`*^9, 
   3.6121551910248127`*^9}, {3.6121552247764397`*^9, 3.612155254746627*^9}, {
   3.6121555589018607`*^9, 3.6121555661990824`*^9}, {3.612155604857193*^9, 
   3.612155640608906*^9}, {3.612155673110471*^9, 3.612155677313798*^9}, {
   3.612155762218522*^9, 3.612155827924796*^9}, 3.612156201793826*^9, {
   3.612156623817785*^9, 3.6121566491335793`*^9}, {3.6121567718212786`*^9, 
   3.612156798325864*^9}, {3.612167700162096*^9, 3.6121677150189514`*^9}, 
   3.6121681342340517`*^9, 3.612170087589526*^9, {3.612170118192828*^9, 
   3.6121701227888784`*^9}, {3.612170202886012*^9, 3.612170217228527*^9}, {
   3.612170296098846*^9, 3.612170299469082*^9}, {3.612174859074157*^9, 
   3.612174868442374*^9}, {3.612174905478945*^9, 3.6121749141927223`*^9}, {
   3.6121750252794156`*^9, 3.612175049639578*^9}, {3.612175150496484*^9, 
   3.612175173207551*^9}, {3.6121752118951516`*^9, 3.612175223370763*^9}, {
   3.612175448705247*^9, 3.6121754490604815`*^9}, {3.612175480498337*^9, 
   3.6121757635180874`*^9}, {3.612175798662401*^9, 3.612175844638901*^9}, {
   3.6121758778239155`*^9, 3.61217602008529*^9}, {3.6121760528420196`*^9, 
   3.61217606138969*^9}, 3.6121771021585574`*^9, {3.612177193988475*^9, 
   3.612177221599792*^9}, {3.6121772758577876`*^9, 3.6121773079150524`*^9}, {
   3.6121773463505497`*^9, 3.6121773723628087`*^9}, {3.612177508486109*^9, 
   3.6121775182886114`*^9}, {3.6121777079724445`*^9, 
   3.6121777098366814`*^9}, {3.61217780819393*^9, 3.612177814319993*^9}, {
   3.6121778619678545`*^9, 3.61217788217126*^9}, {3.612177951333141*^9, 
   3.6121779608964834`*^9}, 3.612178139420913*^9, {3.6121865737842283`*^9, 
   3.612186577882946*^9}, 3.6121866430231586`*^9, 3.612186820490893*^9, {
   3.6121869451756015`*^9, 3.6121869494764566`*^9}, {3.6121920487112513`*^9, 
   3.6121921851107354`*^9}, {3.6121923389197707`*^9, 3.612192410475238*^9}, {
   3.6121932949433537`*^9, 3.6121933043555984`*^9}, {3.613145258627679*^9, 
   3.6131452651820555`*^9}, 3.613146451343665*^9, {3.6131464911512527`*^9, 
   3.613146516216993*^9}, {3.613146731736936*^9, 3.613146847413198*^9}, {
   3.613146890561015*^9, 3.613146973561451*^9}, {3.6131472630762844`*^9, 
   3.613147305986948*^9}, {3.613147357534374*^9, 3.613147369661475*^9}, {
   3.613147414858659*^9, 3.613147496568232*^9}}],

Cell[BoxData[
 RowBox[{"\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
  "\[IndentingNewLine]", "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"root", " ", "=", " ", "\"\<c:/data/TimeInvariant/\>\""}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{"root", " ", "=", " ", "\"\<~/data/TimeInvariant/\>\""}], ";"}], 
    "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"g", "[", 
      RowBox[{"aa_", ",", "a21_", ",", "a22_"}], "]"}], ":=", 
     RowBox[{
      RowBox[{"g", "[", 
       RowBox[{"aa", ",", "a21", ",", "a22"}], "]"}], "=", 
      RowBox[{"f", "[", 
       RowBox[{"aa", ",", "a21", ",", "a22"}], "]"}]}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"f", "=", 
     RowBox[{"With", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"Kj", "=", "150."}], ",", 
         RowBox[{"w", "=", "20."}], ",", 
         RowBox[{"Vf", "=", "100."}], ",", 
         RowBox[{"cap", "=", "2500."}], ",", 
         RowBox[{"n", "=", "90"}], ",", 
         RowBox[{"m", "=", "225"}], ",", 
         RowBox[{"p", "=", "85"}], ",", 
         RowBox[{"RML", "=", "45"}], ",", 
         RowBox[{"L", "=", "3."}], ",", 
         RowBox[{"delta", "=", "1."}], ",", 
         RowBox[{"dt", "=", 
          RowBox[{"4.", "/", "3600."}]}], ",", 
         RowBox[{"dx", "=", 
          RowBox[{"1.", "/", "9."}]}], ",", 
         RowBox[{"Ssteps", "=", "10"}]}], "}"}], ",", 
       RowBox[{"Module", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
          "demand", ",", "supply", ",", "Nsupply", ",", "floExct", ",", 
           "gamma", ",", "inflow", ",", "density"}], "}"}], ",", 
         RowBox[{
          RowBox[{"demand", "=", 
           RowBox[{
            RowBox[{"Max", "[", 
             RowBox[{"0", ",", 
              RowBox[{
               RowBox[{"Min", "[", 
                RowBox[{
                 RowBox[{"#2", " ", "Vf"}], ",", 
                 RowBox[{"#", " ", "cap"}]}], "]"}], "-", "#3"}]}], "]"}], 
            "&"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"supply", "=", 
           RowBox[{
            RowBox[{"Max", "[", 
             RowBox[{"0", ",", 
              RowBox[{
               RowBox[{"Min", "[", 
                RowBox[{
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{
                    RowBox[{"#", " ", "Kj"}], "-", "#2"}], ")"}], " ", "w"}], 
                 ",", 
                 RowBox[{"#", " ", "cap"}]}], "]"}], "-", "#3"}]}], "]"}], 
            "&"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"Nsupply", "=", 
           RowBox[{
            RowBox[{"Max", "[", 
             RowBox[{"0", ",", 
              RowBox[{
               RowBox[{"Min", "[", 
                RowBox[{
                 RowBox[{
                  RowBox[{
                   RowBox[{"(", 
                    RowBox[{
                    RowBox[{"#", " ", "Kj"}], "-", "#2"}], ")"}], " ", "Vf"}],
                   "-", "#3", "-", "#4"}], ",", 
                 RowBox[{"#", " ", "cap"}]}], "]"}], "-", "#5"}]}], "]"}], 
            "&"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"floExct", "=", 
           RowBox[{
            RowBox[{"Evaluate", "@", 
             RowBox[{"Min", "[", 
              RowBox[{
               RowBox[{"demand", "[", 
                RowBox[{"#", ",", "#2", ",", "#6"}], "]"}], ",", 
               RowBox[{"Nsupply", "[", 
                RowBox[{"#", ",", "#3", ",", "#4", ",", "#5", ",", "#6"}], 
                "]"}]}], "]"}]}], "&"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"gamma", "=", 
           RowBox[{
            RowBox[{"Evaluate", "@", 
             RowBox[{"Min", "[", 
              RowBox[{"1", ",", 
               RowBox[{
                RowBox[{"supply", "[", 
                 RowBox[{"L", ",", "#2", ",", "0"}], "]"}], "/", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"demand", "[", 
                   RowBox[{"L", ",", "#", ",", "0"}], "]"}], "+", "0.001"}], 
                 ")"}]}]}], "]"}]}], "&"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"density", "=", 
           RowBox[{
            RowBox[{
             RowBox[{"(", 
              RowBox[{"#", "-", "#2", "+", "#3"}], ")"}], "/", "Vf"}], 
            "&"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"Compile", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"aa", ",", "_Integer", ",", "1"}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"a21", ",", "_Real"}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"a22", ",", "_Real"}], "}"}]}], "}"}], ",", 
            RowBox[{"Module", "[", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{
                RowBox[{"a", "=", "a21"}], ",", 
                RowBox[{"b", "=", "a22"}], ",", 
                RowBox[{"k0", "=", 
                 RowBox[{"Table", "[", 
                  RowBox[{"0.", ",", 
                   RowBox[{"{", "n", "}"}]}], "]"}]}], ",", 
                RowBox[{"Fk", "=", 
                 RowBox[{"Table", "[", 
                  RowBox[{"0.", ",", 
                   RowBox[{"{", "5", "}"}], ",", 
                   RowBox[{"{", "n", "}"}]}], "]"}]}], ",", 
                RowBox[{"kr", "=", 
                 RowBox[{"Table", "[", 
                  RowBox[{"0.", ",", 
                   RowBox[{"{", 
                    RowBox[{"n", "-", "2"}], "}"}], ",", 
                   RowBox[{"{", "p", "}"}]}], "]"}]}], ",", 
                RowBox[{"Rk", "=", 
                 RowBox[{"Table", "[", 
                  RowBox[{"0.", ",", 
                   RowBox[{"{", "4", "}"}], ",", 
                   RowBox[{"{", 
                    RowBox[{"n", "-", "2"}], "}"}], ",", 
                   RowBox[{"{", "p", "}"}]}], "]"}]}], ",", 
                RowBox[{"Fq", "=", 
                 RowBox[{"Table", "[", 
                  RowBox[{"0.", ",", 
                   RowBox[{"{", "4", "}"}], ",", 
                   RowBox[{"{", 
                    RowBox[{"n", "-", "1"}], "}"}]}], "]"}]}], ",", 
                RowBox[{"Fin", "=", 
                 RowBox[{"Table", "[", 
                  RowBox[{"0.", ",", 
                   RowBox[{"{", "4", "}"}], ",", 
                   RowBox[{"{", 
                    RowBox[{"n", "-", "2"}], "}"}]}], "]"}]}], ",", 
                RowBox[{"Rq", "=", 
                 RowBox[{"Table", "[", 
                  RowBox[{"0.", ",", 
                   RowBox[{"{", "4", "}"}], ",", 
                   RowBox[{"{", 
                    RowBox[{"n", "-", "2"}], "}"}], ",", 
                   RowBox[{"{", "p", "}"}]}], "]"}]}], ",", 
                RowBox[{"Shutoff", "=", "False"}], ",", 
                RowBox[{"j", "=", "1"}], ",", "fi", ",", "qin", ",", "qr", 
                ",", "qf", ",", "qsum", ",", 
                RowBox[{"TT", "=", "0."}], ",", 
                RowBox[{"FTT", "=", "0."}], ",", 
                RowBox[{"RTT", "=", "0."}], ",", 
                RowBox[{"Tsteps", "=", 
                 RowBox[{"Quotient", "[", 
                  RowBox[{
                   RowBox[{"Length", "[", "aa", "]"}], ",", "Ssteps"}], 
                  "]"}]}], ",", "RM", ",", "RMori"}], " ", "}"}], ",", 
              RowBox[{
               RowBox[{"RM", "=", 
                RowBox[{"Table", "[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"aa", "[", 
                    RowBox[{"[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"j", "-", "1"}], ")"}], "*", "Ssteps"}], "+", 
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Floor", "[", 
                    RowBox[{"i", " ", "dx"}], "]"}], "<", "1"}], ",", " ", 
                    "1", ",", 
                    RowBox[{"Ceiling", "[", 
                    RowBox[{"i", " ", "dx"}], "]"}]}], "]"}]}], "]"}], "]"}], 
                   " ", "100"}], ",", 
                  RowBox[{"{", 
                   RowBox[{"j", ",", "Tsteps"}], "}"}], ",", 
                  RowBox[{"{", 
                   RowBox[{"i", ",", "2", ",", 
                    RowBox[{"n", "-", "1"}]}], "}"}]}], "]"}]}], ";", 
               RowBox[{"RMori", "=", " ", 
                RowBox[{"RM", "[", 
                 RowBox[{"[", "1", "]"}], "]"}]}], ";", 
               RowBox[{"kr", "=", 
                RowBox[{
                 RowBox[{
                  RowBox[{"ReplacePart", "[", 
                   RowBox[{"#", ",", 
                    RowBox[{"(", 
                    RowBox[{"a", " ", 
                    RowBox[{"delta", "/", "Vf"}]}], ")"}], ",", "1"}], "]"}], 
                  "&"}], "/@", "kr"}]}], ";", "\[IndentingNewLine]", 
               RowBox[{"RTT", "=", 
                RowBox[{"TT", "=", 
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{"Total", "@", 
                    RowBox[{"(", 
                    RowBox[{"Total", "@", "kr"}], ")"}]}], ")"}], " ", 
                  "dx"}]}]}], ";", 
               RowBox[{"AppendTo", "[", 
                RowBox[{"Rk", ",", "kr"}], "]"}], ";", "\[IndentingNewLine]", 
               RowBox[{"While", "[", 
                RowBox[{
                 RowBox[{"TT", ">", "0"}], ",", "\[IndentingNewLine]", 
                 RowBox[{
                  RowBox[{"If", "[", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"Mod", "[", 
                    RowBox[{"j", ",", "100"}], "]"}], "\[Equal]", " ", "0"}], 
                    ",", 
                    RowBox[{"RMori", "=", 
                    RowBox[{"RM", "[", 
                    RowBox[{"[", 
                    RowBox[{"Min", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Quotient", "[", 
                    RowBox[{"j", ",", "100"}], "]"}], "+", "1"}], ",", 
                    "Tsteps"}], "]"}], "]"}], "]"}]}]}], "]"}], ";", 
                  "\[IndentingNewLine]", 
                  RowBox[{"fi", "=", 
                   RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"demand", "[", 
                    RowBox[{"1", ",", 
                    RowBox[{"#", "[", 
                    RowBox[{"[", 
                    RowBox[{"-", "1"}], "]"}], "]"}], ",", "0"}], "]"}], 
                    "&"}], "/@", "kr"}], " ", 
                    RowBox[{"MapThread", "[", 
                    RowBox[{"gamma", ",", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"Take", "[", 
                    RowBox[{"k0", ",", 
                    RowBox[{"{", 
                    RowBox[{"2", ",", 
                    RowBox[{"-", "2"}]}], "}"}]}], "]"}], ",", 
                    RowBox[{"Take", "[", 
                    RowBox[{"k0", ",", 
                    RowBox[{"{", 
                    RowBox[{"3", ",", 
                    RowBox[{"-", "1"}]}], "}"}]}], "]"}]}], "}"}]}], 
                    "]"}]}]}], ";", "\[IndentingNewLine]", 
                  RowBox[{"qf", "=", 
                   RowBox[{
                    RowBox[{"Fq", "[", 
                    RowBox[{"[", 
                    RowBox[{
                    RowBox[{"Mod", "[", 
                    RowBox[{"j", ",", "4"}], "]"}], "+", "1"}], "]"}], "]"}], 
                    "=", 
                    RowBox[{"MapThread", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"floExct", "[", 
                    RowBox[{
                    "L", ",", "#1", ",", "#2", ",", "#3", ",", "#4", ",", 
                    "#5"}], "]"}], "&"}], ",", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"Most", "@", "k0"}], ",", 
                    RowBox[{"Rest", "@", 
                    RowBox[{"(", 
                    RowBox[{"Fk", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], ")"}]}], ",", 
                    RowBox[{"Total", "@", "Fq"}], ",", 
                    RowBox[{"Join", "[", 
                    RowBox[{
                    RowBox[{"Total", "@", "Fin"}], ",", 
                    RowBox[{"{", "0.", "}"}]}], "]"}], ",", 
                    RowBox[{"Join", "[", 
                    RowBox[{
                    RowBox[{"fi", " ", "dx"}], ",", 
                    RowBox[{"{", "0.", "}"}]}], "]"}]}], "}"}]}], "]"}]}]}], 
                  ";", "\[IndentingNewLine]", 
                  RowBox[{"qin", "=", 
                   RowBox[{
                    RowBox[{"Fin", "[", 
                    RowBox[{"[", 
                    RowBox[{
                    RowBox[{"Mod", "[", 
                    RowBox[{"j", ",", "4"}], "]"}], "+", "1"}], "]"}], "]"}], 
                    "=", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"fi", "-", 
                    RowBox[{"b", " ", 
                    RowBox[{"Most", "@", "qf"}]}]}], ")"}], "dx"}]}]}], ";", 
                  "\[IndentingNewLine]", 
                  RowBox[{"Fk", "=", 
                   RowBox[{"RotateLeft", "[", "Fk", "]"}]}], ";", 
                  "\[IndentingNewLine]", 
                  RowBox[{"k0", "=", 
                   RowBox[{
                    RowBox[{"Fk", "[", 
                    RowBox[{"[", 
                    RowBox[{"-", "1"}], "]"}], "]"}], "=", 
                    RowBox[{"MapThread", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Min", "[", 
                    RowBox[{
                    RowBox[{"L", " ", "Kj"}], ",", 
                    RowBox[{"#1", "+", "#2"}]}], "]"}], "&"}], ",", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"Join", "[", 
                    RowBox[{
                    RowBox[{"{", "0.", "}"}], ",", 
                    RowBox[{"density", "[", 
                    RowBox[{
                    RowBox[{"Most", "@", "qf"}], ",", 
                    RowBox[{"Rest", "@", "qf"}], ",", "qin"}], "]"}], ",", 
                    RowBox[{"{", "0.", "}"}]}], "]"}], ",", "k0"}], "}"}]}], 
                    "]"}]}]}], ";", "\[IndentingNewLine]", 
                  RowBox[{"qsum", "=", 
                   RowBox[{"Total", "@", "Rq"}]}], ";", "\[IndentingNewLine]", 
                  RowBox[{"qr", "=", 
                   RowBox[{
                    RowBox[{"Rq", "[", 
                    RowBox[{"[", 
                    RowBox[{
                    RowBox[{"Mod", "[", 
                    RowBox[{"j", ",", "4"}], "]"}], "+", "1"}], "]"}], "]"}], 
                    "=", 
                    RowBox[{"MapThread", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Join", "[", 
                    RowBox[{"#1", ",", 
                    RowBox[{"{", "#2", "}"}], ",", "#3", ",", 
                    RowBox[{"{", "#4", "}"}]}], "]"}], "&"}], ",", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"MapThread", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"floExct", "[", 
                    RowBox[{
                    "1", ",", "#1", ",", "#2", ",", "#3", ",", "0", ",", 
                    "0"}], "]"}], "&"}], ",", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"Take", "[", 
                    RowBox[{"#", ",", 
                    RowBox[{"{", 
                    RowBox[{"1", ",", 
                    RowBox[{"RML", "-", "1"}]}], "}"}]}], "]"}], "&"}], "/@", 
                    "kr"}], ",", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Take", "[", 
                    RowBox[{"#", ",", 
                    RowBox[{"{", 
                    RowBox[{"2", ",", "RML"}], "}"}]}], "]"}], "&"}], "/@", 
                    RowBox[{"Rk", "[", 
                    RowBox[{"[", "1", "]"}], "]"}]}], ",", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Take", "[", 
                    RowBox[{"#", ",", 
                    RowBox[{"{", 
                    RowBox[{"1", ",", 
                    RowBox[{"RML", "-", "1"}]}], "}"}]}], "]"}], "&"}], "/@", 
                    "qsum"}]}], "}"}], ",", "2"}], "]"}], ",", 
                    RowBox[{"MapThread", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Min", "[", 
                    RowBox[{"#1", ",", "#2"}], "]"}], "&"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"RMori", ",", 
                    RowBox[{"MapThread", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"floExct", "[", 
                    RowBox[{"1", ",", 
                    RowBox[{"#1", "[", 
                    RowBox[{"[", "RML", "]"}], "]"}], ",", 
                    RowBox[{"#2", "[", 
                    RowBox[{"[", 
                    RowBox[{"RML", "+", "1"}], "]"}], "]"}], ",", 
                    RowBox[{"#3", "[", 
                    RowBox[{"[", "RML", "]"}], "]"}], ",", "0", ",", "0"}], 
                    "]"}], "&"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"kr", ",", 
                    RowBox[{"Rk", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], ",", "qsum"}], "}"}]}], 
                    "]"}]}], "}"}]}], "]"}], ",", 
                    RowBox[{"MapThread", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"floExct", "[", 
                    RowBox[{
                    "1", ",", "#1", ",", "#2", ",", "#3", ",", "0", ",", 
                    "0"}], "]"}], "&"}], ",", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"Take", "[", 
                    RowBox[{"#", ",", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"RML", "+", "1"}], ",", 
                    RowBox[{"-", "2"}]}], "}"}]}], "]"}], "&"}], "/@", "kr"}],
                     ",", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Take", "[", 
                    RowBox[{"#", ",", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"RML", "+", "2"}], ",", 
                    RowBox[{"-", "1"}]}], "}"}]}], "]"}], "&"}], "/@", 
                    RowBox[{"Rk", "[", 
                    RowBox[{"[", "1", "]"}], "]"}]}], ",", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Take", "[", 
                    RowBox[{"#", ",", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"RML", "+", "1"}], ",", 
                    RowBox[{"-", "2"}]}], "}"}]}], "]"}], "&"}], "/@", 
                    "qsum"}]}], "}"}], ",", "2"}], "]"}], ",", "fi"}], 
                    "}"}]}], "]"}]}]}], ";", "\[IndentingNewLine]", 
                  RowBox[{"Rk", "=", 
                   RowBox[{"RotateLeft", "[", "Rk", "]"}]}], ";", 
                  "\[IndentingNewLine]", 
                  RowBox[{"kr", "=", 
                   RowBox[{
                    RowBox[{"Rk", "[", 
                    RowBox[{"[", 
                    RowBox[{"-", "1"}], "]"}], "]"}], "=", 
                    RowBox[{"MapThread", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"#1", "+", "#2"}], ")"}], "&"}], ",", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"Join", "[", 
                    RowBox[{
                    RowBox[{"{", "0.", "}"}], ",", "#"}], "]"}], "&"}], "/@", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"density", "[", 
                    RowBox[{
                    RowBox[{"Most", "@", "#"}], ",", 
                    RowBox[{"Rest", "@", "#"}], ",", "0"}], "]"}], "&"}], "/@",
                     "qr"}], ")"}]}], ",", "kr"}], "}"}]}], "]"}]}]}], ";", 
                  "\[IndentingNewLine]", 
                  RowBox[{"If", "[", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"Shutoff", "\[Equal]", "False"}], ")"}], "&&", 
                    RowBox[{"j", ">", "m"}]}], ",", 
                    RowBox[{
                    RowBox[{"Shutoff", "=", "True"}], ";", 
                    RowBox[{"kr", "=", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"ReplacePart", "[", 
                    RowBox[{"#", ",", "0", ",", "1"}], "]"}], "&"}], "/@", 
                    "kr"}]}]}]}], "]"}], ";", "\[IndentingNewLine]", 
                  RowBox[{"FTT", "+=", 
                   RowBox[{"Total", "@", "k0"}]}], ";", 
                  RowBox[{"RTT", "+=", 
                   RowBox[{
                    RowBox[{"(", 
                    RowBox[{"Total", "@", 
                    RowBox[{"(", 
                    RowBox[{"Total", "@", "kr"}], ")"}]}], ")"}], " ", 
                    "dx"}]}], ";", 
                  RowBox[{"If", "[", 
                   RowBox[{
                    RowBox[{"j", ">", "m"}], ",", 
                    RowBox[{"TT", "=", 
                    RowBox[{"Total", "@", "k0"}]}]}], "]"}], ";", 
                  RowBox[{"If", "[", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"Max", "[", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"#", "[", 
                    RowBox[{"[", 
                    RowBox[{"RML", "+", "1"}], "]"}], "]"}], "&"}], "/@", 
                    "kr"}], ")"}], "]"}], ">", 
                    RowBox[{"Kj", "-", 
                    RowBox[{"a", "/", "w"}]}]}], ",", 
                    RowBox[{
                    RowBox[{"Print", "[", "\"\<Meter Spillback\>\"", "]"}], 
                    ";", 
                    RowBox[{"RTT", "=", 
                    RowBox[{"10", "^", "10"}]}], ";", 
                    RowBox[{"Break", "[", "]"}]}]}], "]"}], ";", 
                  "\[IndentingNewLine]", 
                  RowBox[{"If", "[", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"Max", "[", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"#", "[", 
                    RowBox[{"[", "2", "]"}], "]"}], "&"}], "/@", "kr"}], 
                    ")"}], "]"}], ">", 
                    RowBox[{"Kj", "-", 
                    RowBox[{"a", "/", "w"}]}]}], ",", 
                    RowBox[{
                    RowBox[{"Print", "[", "\"\<Ramp Spillback\>\"", "]"}], 
                    ";", 
                    RowBox[{"RTT", "=", 
                    RowBox[{"10", "^", "10"}]}], ";", 
                    RowBox[{"Break", "[", "]"}]}]}], "]"}], ";", 
                  RowBox[{"j", "++"}]}]}], "]"}], ";", "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"(", 
                 RowBox[{"RTT", "+", "FTT"}], ")"}], " ", "dt", " ", 
                "dx"}]}]}], "]"}], ",", 
            RowBox[{"CompilationOptions", "\[Rule]", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"\"\<ExpressionOptimization\>\"", "\[Rule]", "True"}], 
               ",", 
               RowBox[{
               "\"\<InlineExternalDefinitions\>\"", "\[Rule]", "True"}]}], 
              "}"}]}], ",", 
            RowBox[{"Parallelization", "\[Rule]", "True"}], ",", 
            RowBox[{"RuntimeAttributes", "\[Rule]", 
             RowBox[{"{", "Listable", "}"}]}], ",", 
            RowBox[{"RuntimeOptions", "\[Rule]", "\"\<Speed\>\""}]}], 
           "]"}]}]}], "]"}]}], "]"}]}], ";"}]}]}]], "Input",
 CellChangeTimes->{{3.612023226274868*^9, 3.612023308894287*^9}, {
   3.6120289429476037`*^9, 3.6120289539439216`*^9}, {3.612101981630884*^9, 
   3.612101985198258*^9}, {3.6121025294596176`*^9, 3.6121025323335314`*^9}, {
   3.612102691318324*^9, 3.612102757763501*^9}, {3.612102791329834*^9, 
   3.6121027983044767`*^9}, {3.6121028404124985`*^9, 3.61210286945282*^9}, {
   3.612102932444417*^9, 3.6121029930439796`*^9}, {3.6121034045060186`*^9, 
   3.6121034051274333`*^9}, 3.6121034432928295`*^9, {3.6121040749284916`*^9, 
   3.612104081288724*^9}, {3.6121042874909377`*^9, 3.6121043152434034`*^9}, 
   3.612104348956001*^9, {3.6121044008935633`*^9, 3.6121044106970897`*^9}, {
   3.6121045975849314`*^9, 3.612104628338397*^9}, {3.612104758575061*^9, 
   3.6121047834015822`*^9}, 3.612105008574419*^9, {3.612107413218937*^9, 
   3.6121074173316717`*^9}, {3.612117740528376*^9, 3.612117764633855*^9}, {
   3.61211795143198*^9, 3.612117963809216*^9}, {3.6121352013952565`*^9, 
   3.61213524918606*^9}, {3.6121352912550526`*^9, 3.6121353157598896`*^9}, 
   3.612135382307171*^9, {3.6121354410803804`*^9, 3.612135445719468*^9}, 
   3.6121359386107426`*^9, {3.6121362237563663`*^9, 3.6121362344324684`*^9}, {
   3.612136283289982*^9, 3.6121362842276077`*^9}, 3.6121363797928495`*^9, {
   3.6121364357718835`*^9, 3.612136441037386*^9}, {3.612136481830531*^9, 
   3.6121365009402485`*^9}, {3.612136621901739*^9, 3.6121366224491034`*^9}, 
   3.6121366821956425`*^9, 3.6121367935613904`*^9, 3.6121374551211495`*^9, {
   3.6121377361291466`*^9, 3.6121377566678143`*^9}, 3.6121378273888736`*^9, {
   3.612137890026557*^9, 3.6121378995458922`*^9}, {3.612138006934985*^9, 
   3.612138013689479*^9}, {3.6121380689132285`*^9, 3.612138072642709*^9}, {
   3.6121381029598846`*^9, 3.612138138015211*^9}, {3.6121381791966143`*^9, 
   3.6121382000524926`*^9}, 3.612138621872572*^9, 3.612139285687533*^9, {
   3.612139829954717*^9, 3.6121398306922083`*^9}, {3.6121400019191484`*^9, 
   3.612140002896799*^9}, {3.6121403567162437`*^9, 3.6121403589967613`*^9}, {
   3.6121409501006794`*^9, 3.612140971555807*^9}, {3.612141154598349*^9, 
   3.612141157954582*^9}, {3.6121427848922844`*^9, 3.612142815617729*^9}, {
   3.612142852346074*^9, 3.6121428531345987`*^9}, {3.6121429346179204`*^9, 
   3.6121430217879267`*^9}, {3.6121434206455793`*^9, 
   3.6121435428314466`*^9}, {3.61214378929737*^9, 3.612143844818313*^9}, {
   3.6121438912922425`*^9, 3.6121439017041674`*^9}, {3.6121439588341837`*^9, 
   3.6121439631550584`*^9}, {3.6121440113821526`*^9, 3.612144035573745*^9}, {
   3.612144121678812*^9, 3.61214414550871*^9}, {3.6121442110293083`*^9, 
   3.612144211846854*^9}, {3.6121442642887526`*^9, 3.6121442651493225`*^9}, {
   3.6121445699298344`*^9, 3.6121446122790127`*^9}, {3.61214470073869*^9, 
   3.612144707414133*^9}, {3.612147894199198*^9, 3.6121479539549613`*^9}, {
   3.612147994780312*^9, 3.612148002762624*^9}, {3.612148050310264*^9, 
   3.6121480513889823`*^9}, {3.612148109704789*^9, 3.6121481107864113`*^9}, {
   3.612152927999116*^9, 3.6121530898108883`*^9}, {3.6121531215540104`*^9, 
   3.6121531583254795`*^9}, 3.6121532031142845`*^9, {3.612153380795519*^9, 
   3.6121533898235292`*^9}, 3.61215343493047*^9, {3.6121551494603176`*^9, 
   3.6121551910248127`*^9}, {3.6121552247764397`*^9, 3.612155254746627*^9}, {
   3.6121555589018607`*^9, 3.6121555661990824`*^9}, {3.612155604857193*^9, 
   3.612155640608906*^9}, {3.612155673110471*^9, 3.612155677313798*^9}, {
   3.612155762218522*^9, 3.612155827924796*^9}, 3.612156201793826*^9, {
   3.612156623817785*^9, 3.6121566491335793`*^9}, {3.6121567718212786`*^9, 
   3.612156798325864*^9}, {3.612167700162096*^9, 3.6121677150189514`*^9}, 
   3.6121681342340517`*^9, 3.612170087589526*^9, {3.612170118192828*^9, 
   3.6121701227888784`*^9}, {3.612170202886012*^9, 3.612170217228527*^9}, {
   3.612170296098846*^9, 3.612170299469082*^9}, {3.612174859074157*^9, 
   3.612174868442374*^9}, {3.612174905478945*^9, 3.6121749141927223`*^9}, {
   3.6121750252794156`*^9, 3.612175049639578*^9}, {3.612175150496484*^9, 
   3.612175173207551*^9}, {3.6121752118951516`*^9, 3.612175223370763*^9}, {
   3.612175448705247*^9, 3.6121754490604815`*^9}, {3.612175480498337*^9, 
   3.6121757635180874`*^9}, {3.612175798662401*^9, 3.612175844638901*^9}, {
   3.6121758778239155`*^9, 3.61217602008529*^9}, {3.6121760528420196`*^9, 
   3.61217606138969*^9}, 3.6121771021585574`*^9, {3.612177193988475*^9, 
   3.612177221599792*^9}, {3.6121772758577876`*^9, 3.6121773079150524`*^9}, {
   3.6121773463505497`*^9, 3.6121773723628087`*^9}, {3.612177508486109*^9, 
   3.6121775182886114`*^9}, {3.6121777079724445`*^9, 
   3.6121777098366814`*^9}, {3.61217780819393*^9, 3.612177814319993*^9}, {
   3.6121778619678545`*^9, 3.61217788217126*^9}, {3.612177951333141*^9, 
   3.6121779608964834`*^9}, 3.612178139420913*^9, {3.6121865737842283`*^9, 
   3.612186577882946*^9}, 3.6121866430231586`*^9, 3.612186820490893*^9, {
   3.6121869451756015`*^9, 3.6121869494764566`*^9}, {3.6121920487112513`*^9, 
   3.6121921851107354`*^9}, {3.6121923389197707`*^9, 3.612192410475238*^9}, {
   3.6121932949433537`*^9, 3.6121933043555984`*^9}, {3.613145258627679*^9, 
   3.6131452651820555`*^9}, 3.613146451343665*^9, {3.6131464911512527`*^9, 
   3.613146516216993*^9}, {3.613146731736936*^9, 3.613146847413198*^9}, {
   3.613146890561015*^9, 3.613146973561451*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"aa", "=", "2500."}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"bb", "=", "0.05"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"vars", "=", 
   RowBox[{"Array", "[", 
    RowBox[{"x", ",", "20"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"{", 
    RowBox[{"sol", ",", 
     RowBox[{"{", "points", "}"}]}], "}"}], "=", 
   RowBox[{"Reap", "[", 
    RowBox[{"NMinimize", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"Hold", "[", 
         RowBox[{"t", "=", 
          RowBox[{"g", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{
              RowBox[{"x", "[", "1", "]"}], ",", 
              RowBox[{"x", "[", "2", "]"}], ",", 
              RowBox[{"x", "[", "3", "]"}], ",", 
              RowBox[{"x", "[", "4", "]"}], ",", 
              RowBox[{"x", "[", "5", "]"}], ",", 
              RowBox[{"x", "[", "6", "]"}], ",", 
              RowBox[{"x", "[", "7", "]"}], ",", 
              RowBox[{"x", "[", "8", "]"}], ",", 
              RowBox[{"x", "[", "9", "]"}], ",", 
              RowBox[{"x", "[", "10", "]"}], ",", 
              RowBox[{"x", "[", "11", "]"}], ",", 
              RowBox[{"x", "[", "12", "]"}], ",", 
              RowBox[{"x", "[", "13", "]"}], ",", 
              RowBox[{"x", "[", "14", "]"}], ",", 
              RowBox[{"x", "[", "15", "]"}], ",", 
              RowBox[{"x", "[", "16", "]"}], ",", 
              RowBox[{"x", "[", "17", "]"}], ",", 
              RowBox[{"x", "[", "18", "]"}], ",", 
              RowBox[{"x", "[", "19", "]"}], ",", 
              RowBox[{"x", "[", "20", "]"}]}], "}"}], ",", "aa", ",", "bb"}], 
           "]"}]}], "]"}], ",", 
        RowBox[{
         RowBox[{"And", "@@", 
          RowBox[{"Thread", "@", 
           RowBox[{"LessEqual", "[", 
            RowBox[{"3", ",", "vars", ",", "25"}], "]"}]}]}], "&&", 
         RowBox[{"vars", "\[Element]", "Integers"}]}]}], "}"}], ",", "vars", 
      ",", 
      RowBox[{"Method", "\[Rule]", 
       RowBox[{"{", 
        RowBox[{"\"\<SimulatedAnnealing\>\"", ",", 
         RowBox[{"\"\<PerturbationScale\>\"", "\[Rule]", "2"}], ",", 
         RowBox[{"\"\<SearchPoints\>\"", "\[Rule]", "100000"}]}], "}"}]}], 
      ",", 
      RowBox[{"EvaluationMonitor", "\[RuleDelayed]", 
       RowBox[{"Sow", "[", 
        RowBox[{"{", 
         RowBox[{"Join", "[", 
          RowBox[{"vars", ",", 
           RowBox[{"{", "t", "}"}]}], "]"}], "}"}], "]"}]}]}], "]"}], "]"}]}],
   ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Export", "[", 
   RowBox[{
    RowBox[{"root", "<>", "\"\<TI\>\"", "<>", "\"\<_\>\"", "<>", 
     RowBox[{"ToString", "[", "aa", "]"}], "<>", "\"\<_\>\"", "<>", 
     RowBox[{"ToString", "[", "bb", "]"}], "<>", "\"\<.xls\>\""}], ",", 
    RowBox[{"DeleteDuplicates", "[", "points", "]"}]}], "]"}], 
  ";"}]}], "Input",
 CellChangeTimes->{{3.612151395967471*^9, 3.6121513959754753`*^9}, {
   3.6121514396665497`*^9, 3.6121514747929244`*^9}, {3.612151531150429*^9, 
   3.6121515939556665`*^9}, {3.6121516487060995`*^9, 
   3.6121517303635283`*^9}, {3.6121519920366282`*^9, 3.612151993723751*^9}, {
   3.6121520489474993`*^9, 3.612152097919014*^9}, {3.6121522070226145`*^9, 
   3.6121522209638968`*^9}, {3.6121522633561*^9, 3.6121523005760384`*^9}, {
   3.6121525334704337`*^9, 3.6121525677792835`*^9}, {3.6121526284435406`*^9, 
   3.612152631594634*^9}, {3.612152678283947*^9, 3.6121526820834775`*^9}, {
   3.612152742270525*^9, 3.6121528674848475`*^9}, {3.6121533066852036`*^9, 
   3.6121533703315554`*^9}, {3.612154093949224*^9, 3.612154109387463*^9}, {
   3.6121541717185793`*^9, 3.6121541741249466`*^9}, {3.612177977327383*^9, 
   3.6121780093005943`*^9}, {3.6121780904714456`*^9, 3.612178098123522*^9}, 
   3.612178793628908*^9, {3.61217933051195*^9, 3.6121793320899963`*^9}, {
   3.6121910514183965`*^9, 3.6121910568119745`*^9}, {3.612191815963853*^9, 
   3.6121919125819426`*^9}, {3.6121919848698983`*^9, 
   3.6121919868542175`*^9}, {3.6121927306586456`*^9, 
   3.6121927322462025`*^9}, {3.612192782470521*^9, 3.6121928081205378`*^9}, {
   3.6121930944373407`*^9, 3.612193094527402*^9}, {3.612193197076432*^9, 
   3.612193238709051*^9}}]
},
WindowSize->{822, 631},
WindowMargins->{{Automatic, 0}, {Automatic, 0}},
FrontEndVersion->"9.0 for Microsoft Windows (64-bit) (January 25, 2013)",
StyleDefinitions->"Default.nb"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[557, 20, 11358, 242, 492, "Input"],
Cell[11918, 264, 29809, 648, 1212, "Input"],
Cell[41730, 914, 4226, 92, 272, "Input"]
}
]
*)

(* End of internal cache information *)
